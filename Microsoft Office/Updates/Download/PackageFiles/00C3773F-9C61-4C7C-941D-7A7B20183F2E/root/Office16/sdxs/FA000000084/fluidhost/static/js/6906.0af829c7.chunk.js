/*! For license information please see 6906.0af829c7.chunk.js.LICENSE.txt */
(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[6906],{52820:function(e,t,r){"use strict";r.d(t,{X:function(){return y}});var n=r(74165),i=r(15671),a=r(43144),o=r(75971),s=r(77578),u=r(55759),c=r(41655),l=r(35585),h=r(30957),d="@1js/card-loop";function f(e){switch(e){case"Automation":case"SyntheticTraffic":case"Local":case"Development":case"Staging":case"Dogfood":return"Dogfood";case"Preview":case"Microsoft":return"Microsoft";default:return e}}function v(e,t){return(0,o.__awaiter)(this,void 0,void 0,(0,n.Z)().mark((function r(){return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r,n){var i=e.document;if(i.querySelector('script[src="'.concat(t,'"]')))return new Event("ScriptAlreadyLoaded");var a=i.createElement("script");a.src=t,a.async=!1,a.crossOrigin="anonymous",a.onload=r,a.onerror=function(){return n(new Error("Failed to download the script at url: ".concat(t,".")))},i.head.appendChild(a)})));case 1:case"end":return r.stop()}}),r)})))}var p=function(){function e(t){(0,i.Z)(this,e),this.audience=t.audience,this.windowContext=t.windowContext}return(0,a.Z)(e,[{key:"canLoad",value:function(e){return e.packageName===d}},{key:"load",value:function(e){return(0,o.__awaiter)(this,void 0,void 0,(0,n.Z)().mark((function t(){var r,i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.canLoad(e)){t.next=2;break}throw new Error("Incorrect code details, Check the LoopRegistrationId.");case 2:return t.next=4,this.determineCdnUrl();case 4:return r=t.sent,t.next=7,v(this.windowContext,r);case 7:if(i=this.windowContext[d]){t.next=10;break}throw new Error("Could not fetch loop module from the window object.");case 10:return t.abrupt("return",{module:i,details:e});case 11:case"end":return t.stop()}}),t,this)})))}},{key:"determineCdnUrl",value:function(){return(0,o.__awaiter)(this,void 0,void 0,(0,n.Z)().mark((function e(){var t,r,i,a,o,d,v;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f(this.audience),"1.latest",i="versionless","card-loop_cdn-config.json",a="".concat(r="https://res-1.cdn.office.net/midgard","/").concat("1.latest","/").concat("card-loop_cdn-config.json","?r=").concat((0,h.pW)()),e.prev=6,e.next=9,(0,s.q)(a,{method:"GET"},6e4,{maxRetries:3,filter:(0,u.m)({min:500,max:599}),backOffFn:(0,c.Tv)(500)});case 9:if((o=e.sent).result.ok&&o.result.status===l.W.Ok){e.next=12;break}throw o;case 12:return e.next=14,o.result.json();case 14:if((d=e.sent)[t]){e.next=19;break}throw new Error("Could not find the entry in config for ".concat(t," environment"));case 19:return v=d[t].file,e.abrupt("return","".concat(r,"/").concat(i,"/").concat(v));case 21:e.next=26;break;case 23:throw e.prev=23,e.t0=e.catch(6),new Error("Failed to fetch ".concat(a));case 26:case"end":return e.stop()}}),e,this,[[6,23]])})))}}]),e}(),y={instantiateLoopCodeLoader:function(e){return Promise.resolve(new p(e))}}},17842:function(e,t,r){"use strict";r.d(t,{j:function(){return c}});var n=r(74165),i=r(15671),a=r(43144),o=r(75971),s=r(72278),u=function(){function e(){(0,i.Z)(this,e)}return(0,a.Z)(e,[{key:"canLoad",value:function(e){return e.packageName===s.E}},{key:"load",value:function(e){return(0,o.__awaiter)(this,void 0,void 0,(0,n.Z)().mark((function t(){var i;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.canLoad(e)){t.next=2;break}throw new Error("Incompatible loop code details.");case 2:return t.next=4,Promise.all([r.e(3711),r.e(8507),r.e(8633),r.e(4492)]).then(r.bind(r,21395));case 4:return i=t.sent,t.abrupt("return",{module:i,details:e});case 6:case"end":return t.stop()}}),t,this)})))}}]),e}(),c={instantiateLoopCodeLoader:function(){return Promise.resolve(new u)}}},35585:function(e,t,r){"use strict";var n;r.d(t,{W:function(){return n}}),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.Ambiguous=300]="Ambiguous",e[e.MultipleChoices=300]="MultipleChoices",e[e.Moved=301]="Moved",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.Redirect=302]="Redirect",e[e.RedirectMethod=303]="RedirectMethod",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.RedirectKeepVerb=307]="RedirectKeepVerb",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.RequestEntityTooLarge=413]="RequestEntityTooLarge",e[e.RequestUriTooLong=414]="RequestUriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RequestedRangeNotSatisfiable=416]="RequestedRangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.Unprocessable=422]="Unprocessable",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.FetchTimeoutStatusCode=707]="FetchTimeoutStatusCode",e[e.OfflineFetchFailureStatusCode=709]="OfflineFetchFailureStatusCode",e[e.FetchFailureStatusCode=710]="FetchFailureStatusCode"}(n||(n={}))},41655:function(e,t,r){"use strict";function n(e){return function(t){return e}}r.d(t,{Tv:function(){return n}})},77578:function(e,t,r){"use strict";r.d(t,{q:function(){return c}});var n=r(74165),i=r(75971);function a(e){return new Promise((function(t){return setTimeout((function(){return t()}),e)}))}function o(e,t,r){return s(e,[],t,r)}function s(e,t,r,n){var i,o=[e(t.length).then((function(e){return i=e,!1}))];return r&&r.timeoutMs>0&&o.push(a(r.timeoutMs).then((function(){return!0}))),Promise.race(o).then((function(o){return o&&r&&(i=r.onTimeout()),!n||!n.filter(i)||t.length>=n.maxRetries?{result:i,tries:t}:a(n.backOffFn(t.length)).then((function(){return t.push(i),s(e,t,r,n)}))}))}var u=r(35585);function c(e,t){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return o((function(){return(0,i.__awaiter)(r,void 0,void 0,(0,n.Z)().mark((function r(){var i,a;return(0,n.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=performance.now(),r.prev=1,r.next=4,fetch(e,t);case 4:return(a=r.sent).durationMs=Math.round(performance.now()-i),r.abrupt("return",a);case 9:return r.prev=9,r.t0=r.catch(1),r.abrupt("return",{status:window.navigator.onLine?u.W.FetchFailureStatusCode:u.W.OfflineFetchFailureStatusCode,ok:!1,durationMs:Math.round(performance.now()-i)});case 12:case"end":return r.stop()}}),r,null,[[1,9]])})))}),{timeoutMs:a,onTimeout:function(){return{status:u.W.FetchTimeoutStatusCode,ok:!1,durationMs:a}}},arguments.length>3?arguments[3]:void 0)}},55759:function(e,t,r){"use strict";function n(e){return function(t){return!!t&&(e instanceof Array?e.includes(t.status):e.min<=e.max&&(t.status>=e.min&&t.status<=e.max))}}r.d(t,{m:function(){return n}})},30957:function(e,t,r){"use strict";function n(){return"object"===typeof window&&window.crypto&&function(){var e=new Uint8Array(31);return window.crypto.getRandomValues(e),e}()||function(){for(var e=new Array(31),t=0;t<31;t++)e[t]=Math.floor(16*Math.random());return e}()}r.d(t,{pW:function(){return i}});function i(){for(var e=n(),t=0,r="",i=0;i<36;i++)switch(i){case 8:case 13:case 18:case 23:t+=1,r+="-";break;case 14:t+=1,r+="4";break;case 19:r+=(e[i-t]%4+8).toString(16);break;default:r+=(e[i-t]%16).toString(16)}return r}},93241:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushModeExperimental=t.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(t.FlushMode||(t.FlushMode={})),function(e){e[e.Async=2]="Async"}(t.FlushModeExperimental||(t.FlushModeExperimental={})),t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},18401:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},65887:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},27806:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcDeletedBlobKey=t.gcTombstoneBlobKey=t.gcBlobPrefix=t.gcTreeKey=void 0,t.gcTreeKey="gc",t.gcBlobPrefix="__gc",t.gcTombstoneBlobKey="__tombstones",t.gcDeletedBlobKey="__deletedNodes"},49103:function(e,t,r){"use strict";t.XK=t.Bl=void 0;var n=r(93241);Object.defineProperty(t,"Bl",{enumerable:!0,get:function(){return n.VisibilityState}});var i=r(18401);var a=r(65887);var o=r(27806);var s=r(24530);Object.defineProperty(t,"XK",{enumerable:!0,get:function(){return s.CreateSummarizerNodeSource}})},24530:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={})),t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},24908:function(e,t,r){"use strict";r.d(t,{FE:function(){return c},Qp:function(){return h},VN:function(){return d},eB:function(){return l},sG:function(){return f}});var n=r(43144),i=r(15671),a=r(37762),o=r(24713),s=r(74847),u=r(89591);function c(e){var t=e.type===o.J.Handle?e.handleType:e.type;switch(t){case o.J.Blob:case o.J.Attachment:return"blob";case o.J.Tree:return"tree";default:(0,u.U)(t,"Unknown type: ".concat(t))}}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Map,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={},i={id:e.sha,blobs:{},trees:{}};n[""]=i;var o,s=(0,a.Z)(e.tree);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=r?u.path.replace(/^\.app\//,""):u.path,l=c.lastIndexOf("/"),h=c.slice(0,Math.max(0,l)),d=c.slice(l+1),f=n[h];if("tree"===u.type){var v={id:u.sha,blobs:{},commits:{},trees:{}};f.trees[decodeURIComponent(d)]=v,n[c]=v}else{if("blob"!==u.type)throw new Error("Unknown entry type!!");f.blobs[decodeURIComponent(d)]=u.sha,t.set(u.sha,"/".concat(c))}}}catch(p){s.e(p)}finally{s.f()}return i}var h=(0,n.Z)((function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"utf-8";(0,i.Z)(this,e),this.path=t,this.mode=s.m.File,this.type=s.S.Blob,this.value={contents:r,encoding:n}})),d=(0,n.Z)((function e(t,r){(0,i.Z)(this,e),this.path=t,this.value=r,this.mode=s.m.Directory,this.type=s.S.Tree})),f=(0,n.Z)((function e(t,r){(0,i.Z)(this,e),this.path=t,this.id=r,this.mode=s.m.File,this.type=s.S.Attachment,this.value={id:r}}))},74847:function(e,t,r){"use strict";var n,i;r.d(t,{S:function(){return i},m:function(){return n}}),function(e){e.File="100644",e.Executable="100755",e.Directory="040000",e.Symlink="120000"}(n||(n={})),function(e){e.Blob="Blob",e.Tree="Tree",e.Attachment="Attachment"}(i||(i={}))},86266:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushModeExperimental=t.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(t.FlushMode||(t.FlushMode={})),function(e){e[e.Async=2]="Async"}(t.FlushModeExperimental||(t.FlushModeExperimental={})),t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},45324:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},24072:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},31909:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcDeletedBlobKey=t.gcTombstoneBlobKey=t.gcBlobPrefix=t.gcTreeKey=void 0,t.gcTreeKey="gc",t.gcBlobPrefix="__gc",t.gcTombstoneBlobKey="__tombstones",t.gcDeletedBlobKey="__deletedNodes"},62861:function(e,t,r){"use strict";t.rm=t.nS=t.ZN=void 0;var n=r(86266);Object.defineProperty(t,"ZN",{enumerable:!0,get:function(){return n.FlushMode}});var i=r(45324);var a=r(24072);var o=r(31909);var s=r(22078);Object.defineProperty(t,"nS",{enumerable:!0,get:function(){return s.blobCountPropertyName}}),Object.defineProperty(t,"rm",{enumerable:!0,get:function(){return s.totalBlobSizePropertyName}})},22078:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={})),t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},58320:function(e,t,r){"use strict";r.r(t),r.d(t,{AdaptiveCardType:function(){return M.nP},CardChannelProvider:function(){return M.YR},CardDataType:function(){return M.mI},CodeDataType:function(){return M.Ql},ConnectorCardType:function(){return M.og},DateDataType:function(){return M.bO},DependencyProviderFactory:function(){return j},ErrorCardType:function(){return M.Q5},HeroCardType:function(){return M.Lb},ImageDataType:function(){return M._l},JITInstallCardType:function(){return M.Hj},LabelDataType:function(){return M.fs},LinkService:function(){return M.Mv},ListDataType:function(){return M.VT},LoginRequestType:function(){return M.Td},MetaOSProvider:function(){return M.Dl},OfficePolicyProvider:function(){return M.Uc},OptionalConnectedServicesPolicyProvider:function(){return M.U$},PersonDataType:function(){return M.mg},RichTextDataType:function(){return M.SN},SettingsProvider:function(){return M.mu},SharedFluidLoopComponentFactory:function(){return ta},SharedLoopComponentFactory:function(){return ea},SignInCardType:function(){return M.bz},TableDataType:function(){return M.nZ},TaskDataType:function(){return M.SZ},ThumbnailCardType:function(){return M.bw},TokenProvider:function(){return M.B7},URLDataType:function(){return M.en},UrlHandlerProvider:function(){return M.ih},buildAdaptiveFluidComponent:function(){return f},buildAdaptiveNonFluidComponent:function(){return h},buildShortcutsHierarchyByKeyType:function(){return g},createProxyFluidComponent:function(){return v},createProxyNonFluidComponent:function(){return d},decorateComponentWithClassInfo:function(){return ua},getShortcutsByIsOverride:function(){return b},getShortcutsByKeyType:function(){return y},getTaskSchedulerInstance:function(){return N},isKeyboardEventMatchingShortcut:function(){return m}});var n=r(15671),i=r(43144),a=r(74165),o=r(15861);function s(e,t){if(""===e)return void 0===t?"":t.absolutePath;var r=e.startsWith("/")?e.slice(1):e;return r=r.endsWith("/")?r.slice(0,-1):r,void 0===t?"/".concat(r):"".concat("/"===t.absolutePath?"":t.absolutePath,"/").concat(r)}var u=function(){function e(t,r,i){(0,n.Z)(this,e),this.value=t,this.path=r,this.routeContext=i,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=s(r,this.routeContext)}return(0,i.Z)(e,[{key:"IFluidHandle",get:function(){return this}},{key:"isAttached",get:function(){return this.routeContext.isAttached}},{key:"visible",get:function(){return this.isAttached||this.locallyVisible}},{key:"get",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.value);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}},{key:"bind",value:function(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}]),e}(),c=Symbol("isProxy");var l=function(){function e(t,r,i,a){(0,n.Z)(this,e),this.contractCache=new Map([]),this.contractAdapterFactoryMap=new Map(r.map((function(e){return[e.key,e.factory]}))),this.proxyComponent=new Proxy(t,this),i&&void 0!==a&&this.setUpProxyFluidComponentHandle(i,a)}return(0,i.Z)(e,[{key:"getProxy",value:function(){return this.proxyComponent}},{key:"getProxyState",value:function(){return void 0===this.proxyState&&(this.proxyState={proxyComponent:this.proxyComponent}),this.proxyState}},{key:"get",value:function(e,t,r){if(t===c)return!0;if(t in e){var n=this.getProxyFluidComponentHandle(t);return n||Reflect.get(e,t,r)}return this.contractGetTrap(e,t)}},{key:"getProxyFluidComponentHandle",value:function(e){return"IFluidLoadable"===e&&this.proxyIFluidLoadable?this.proxyIFluidLoadable:"IFluidHandle"!==e&&"handle"!==e||!this.proxyFluidComponentHandle?void 0:this.proxyFluidComponentHandle}},{key:"setUpProxyFluidComponentHandle",value:function(e,t){this.proxyFluidComponentHandle=new u(this.proxyComponent,t,e.objectsRoutingContext);var r=this.proxyFluidComponentHandle;this.proxyIFluidLoadable={get IFluidLoadable(){return this},get handle(){return r}}}},{key:"contractGetTrap",value:function(e,t){if(this.contractCache.has(t))return this.contractCache.get(t);var r=this.contractAdapterFactoryMap.get(t);if(r){var n=r(e,this.getProxyState());return n&&this.contractCache.set(t,n),n}}},{key:"getOwnPropertyDescriptor",value:function(e,t){if("[[Target]]"===t)return{configurable:!0,enumerable:!0,value:e}}}]),e}();function h(e,t){return t&&t.length>0?d(e,t):e}function d(e,t){return new l(e,t).getProxy()}function f(e,t,r,n){var i=function(e){var t=e;return void 0!==t[c]&&t[c]}(e);return t&&t.length>0&&!i?v(e,t,r,n):e}function v(e,t,r,n){return new l(e,t,r,n).getProxy()}var p=r(93433);function y(e,t){return e.filter((function(e){return e.keyboardShortcutDescription.type===t}))}function g(e,t){var r=void 0!==e.componentCriticalShortcuts?y(e.componentCriticalShortcuts,t):[],n=void 0!==e.hostOverrideShortcuts?y(e.hostOverrideShortcuts,t):[],i=void 0!==e.componentNormalShortcuts?y(e.componentNormalShortcuts,t):[],a=void 0!==e.hostNormalShortcuts?y(e.hostNormalShortcuts,t):[],o=void 0!==e.componentLowShortcuts?y(e.componentLowShortcuts,t):[];return[].concat((0,p.Z)(r),(0,p.Z)(n),(0,p.Z)(i),(0,p.Z)(a),(0,p.Z)(o))}function b(e,t){return e.filter((function(e){return!!e.keyboardShortcutDescription.isOverride===t}))}function m(e,t){var r=t.keyboardShortcutDescription;return r.type===e.type&&r.key===e.key&&!!r.altKey===e.altKey&&!!r.ctrlKey===e.ctrlKey&&!!r.metaKey===e.metaKey&&!!r.shiftKey===e.shiftKey}var k=["user-blocking","user-visible","background"],C=function(){function e(){var t=this;(0,n.Z)(this,e),this.channel_=new MessageChannel,this.sendPort_=this.channel_.port2,this.messages_={},this.nextMessageHandle_=1,this.channel_.port1.onmessage=function(e){return t.onMessageReceived_(e)}}return(0,i.Z)(e,[{key:"queueCallback",value:function(e){var t=this.nextMessageHandle_++;return this.messages_[t]=e,this.sendPort_.postMessage(t),t}},{key:"cancelCallback",value:function(e){delete this.messages_[e]}},{key:"onMessageReceived_",value:function(e){var t=e.data;if(t in this.messages_){var r=this.messages_[t];delete this.messages_[t],r()}}}]),e}();function S(){return S.instance_||(S.instance_=new C),S.instance_}var w=0,Z=1,x=2,I=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,n.Z)(this,e),this.callback_=t,this.callbackType_=null,this.handle_=null,this.canceled_=!1,this.schedule_(r,i)}return(0,i.Z)(e,[{key:"isIdleCallback",value:function(){return this.callbackType_===w}},{key:"cancel",value:function(){if(!this.canceled_)switch(this.canceled_=!0,this.callbackType_){case w:cancelIdleCallback(this.handle_);break;case Z:clearTimeout(this.handle_);break;case x:S().cancelCallback(this.handle_);break;default:throw new TypeError("Unknown CallbackType")}}},{key:"schedule_",value:function(e,t){var r=this;if(t&&t>0||"function"!==typeof MessageChannel)return t||(t=0),this.callbackType_=Z,void(this.handle_=setTimeout((function(){r.runCallback_()}),t));if(!k.includes(e))throw new TypeError("Invalid task priority : ".concat(e));"background"===e&&"function"===typeof requestIdleCallback?(this.handle_=requestIdleCallback((function(){r.runCallback_()})),this.callbackType_=w):(this.handle_=S().queueCallback((function(){r.runCallback_()})),this.callbackType_=x)}},{key:"runCallback_",value:function(){this.canceled_||this.callback_()}}]),e}(),T=0,P=function(){function e(){(0,n.Z)(this,e),this.head_=null,this.tail_=null}return(0,i.Z)(e,[{key:"isEmpty",value:function(){return null==this.head_}},{key:"push",value:function(e){if("object"!==typeof e)throw new TypeError("Task must be an Object");e.tq_sequence_=T++,this.isEmpty()?(e.tq_prev_=null,this.head_=e):(e.tq_prev_=this.tail_,this.tail_.tq_next_=e),e.tq_next_=null,this.tail_=e}},{key:"takeNextTask",value:function(){if(this.isEmpty())return null;var e=this.head_;return this.remove_(e),e}},{key:"merge",value:function(e,t){if("function"!==typeof t)throw new TypeError("Must provide a selector function.");if(null==e)throw new Error("sourceQueue cannot be null");for(var r=this.head_,n=null,i=e.head_;i;){var a=i;if(i=i.tq_next_,t(a)){for(e.remove_(a);r&&r.tq_sequence_<a.tq_sequence_;)n=r,r=r.tq_next_;this.insert_(a,n),n=a}}}},{key:"toArray",value:function(){for(var e=this.head_,t=[];null!==e;)t.push(e),e=e.tq_next_;return t}},{key:"insert_",value:function(e,t){if(t!=this.tail_){var r=t?t.tq_next_:this.head_;e.tq_next_=r,r.tq_prev_=e,e.tq_prev_=t,null!=t?t.tq_next_=e:this.head_=e}else this.push(e)}},{key:"remove_",value:function(e){if(null==e)throw new Error("Expected task to be non-null");e===this.head_&&(this.head_=e.tq_next_),e===this.tail_&&(this.tail_=this.tail_.tq_prev_),e.tq_next_&&(e.tq_next_.tq_prev_=e.tq_prev_),e.tq_prev_&&(e.tq_prev_.tq_next_=e.tq_next_)}}]),e}(),O=function(){function e(){var t=this;(0,n.Z)(this,e),this.queues_={},k.forEach((function(e){t.queues_[e]=new P})),this.pendingHostCallback_=null,this.signals_=new WeakMap}return(0,i.Z)(e,[{key:"postTask",value:function(e,t){if(void 0!==(t=Object.assign({},t)).signal){if(null===t.signal||!("aborted"in t.signal)||"function"!==typeof t.signal.addEventListener)return Promise.reject(new TypeError("'signal' is not a valid 'AbortSignal'"));if(t.signal&&t.signal.priority&&!k.includes(t.signal.priority))return Promise.reject(new TypeError("Invalid task priority: '".concat(t.signal.priority,"'")))}if(void 0!==t.priority&&(null===t.priority||!k.includes(t.priority)))return Promise.reject(new TypeError("Invalid task priority: '".concat(t.priority,"'")));if(void 0===t.delay&&(t.delay=0),t.delay=Number(t.delay),t.delay<0)return Promise.reject(new TypeError("'delay' must be a positive number."));var r={callback:e,options:t,resolve:null,reject:null,hostCallback:null,abortCallback:null,onTaskCompleted:function(){this.options.signal&&this.abortCallback&&(this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null)},onTaskAborted:function(){this.hostCallback&&(this.hostCallback.cancel(),this.hostCallback=null),this.options.signal.removeEventListener("abort",this.abortCallback),this.abortCallback=null,this.reject(this.options.signal.reason)},isAborted:function(){return this.options.signal&&this.options.signal.aborted}},n=new Promise((function(e,t){r.resolve=e,r.reject=t}));return this.schedule_(r),n}},{key:"schedule_",value:function(e){var t=this,r=e.options.signal;if(r){if(r.aborted)return void e.reject(r.reason);e.abortCallback=function(){e.onTaskAborted()},r.addEventListener("abort",e.abortCallback)}e.options.delay>0?e.hostCallback=new I((function(){e.hostCallback=null,t.onTaskDelayExpired_(e)}),null,e.options.delay):(this.pushTask_(e),this.scheduleHostCallbackIfNeeded_())}},{key:"onTaskDelayExpired_",value:function(e){this.pushTask_(e),this.pendingHostCallback_&&(this.pendingHostCallback_.cancel(),this.pendingHostCallback_=null),this.schedulerEntryCallback_()}},{key:"onPriorityChange_",value:function(e){var t=this.signals_.get(e);if(void 0===t)throw new Error("Attempting to change priority on an unregistered signal");if(t!==e.priority){var r=this.queues_[t];this.queues_[e.priority].merge(r,(function(t){return t.options.signal===e})),this.signals_.set(e,e.priority)}}},{key:"schedulerEntryCallback_",value:function(){this.pendingHostCallback_=null,this.runNextTask_(),this.scheduleHostCallbackIfNeeded_()}},{key:"scheduleHostCallbackIfNeeded_",value:function(){var e=this,t=this.nextTaskPriority_();null!=t&&("background"!==t&&this.pendingHostCallback_&&this.pendingHostCallback_.isIdleCallback()&&(this.pendingHostCallback_.cancel(),this.pendingHostCallback_=null),this.pendingHostCallback_||(this.pendingHostCallback_=new I((function(){e.schedulerEntryCallback_()}),t,0)))}},{key:"pushTask_",value:function(e){var t,r=this;if(t=e.options.priority?e.options.priority:e.options.signal&&e.options.signal.priority?e.options.signal.priority:"user-visible",!k.includes(t))throw new TypeError("Invalid task priority: ".concat(t));if(e.options.signal&&e.options.signal.priority){var n=e.options.signal;this.signals_.has(n)||(n.addEventListener("prioritychange",(function(){r.onPriorityChange_(n)})),this.signals_.set(n,n.priority))}this.queues_[t].push(e)}},{key:"runNextTask_",value:function(){var e=null;do{var t=this.nextTaskPriority_();if(null==t)return;e=this.queues_[t].takeNextTask()}while(e.isAborted());try{var r=e.callback();e.resolve(r)}catch(n){e.reject(n)}finally{e.onTaskCompleted()}}},{key:"nextTaskPriority_",value:function(){for(var e=0;e<k.length;e++){var t=k[e];if(!this.queues_[t].isEmpty())return t}return null}}]),e}();function D(){if("object"===typeof performance&&"function"===typeof performance.mark&&"function"===typeof performance.measure)return performance}function N(){var e,t=0,r=new Set,n=[],i="unlocked",s=new O,u=function(){if(0===r.size){var t;if("locked"===i)null===(t=D())||void 0===t||t.measure("TaskScheduler-Locked","TaskSchedulerLock"),i="unlocked",e&&(clearTimeout(e),e=void 0);for(var a=function(){var e=u[o];s.postTask(e.callback,e.options).then((function(t){return e.resolve(t)})).catch((function(t){return e.reject(t)}))},o=0,u=n;o<u.length;o++)a();n=[]}};return{get TaskScheduler(){return this},get Disposable(){return this},dispose:function(){return(0,o.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:clearTimeout(e),e=void 0;case 2:case"end":return t.stop()}}),t)})))()},lock:function(){var n;0===r.size&&(i="locked",null===(n=D())||void 0===n||n.mark("TaskSchedulerLock"),e=setTimeout((function(){r.clear(),u()}),5e3));var a=t;return t+=1,r.add(a),{release:function(){r.delete(a),u()}}},postTask:function(e,t){return"user-blocking"===(null===t||void 0===t?void 0:t.priority)||0===r.size?s.postTask(e,t):new Promise((function(r,i){n.push({callback:e,options:t,resolve:r,reject:i})}))}}}var M=r(2770),j=function(){function e(t,r){(0,n.Z)(this,e),this.ctor=t,this.optionalProviders=r}return(0,i.Z)(e,[{key:"IContainerServiceFactoryHelper",get:function(){return this}},{key:"instantiateContainerService",value:function(e){var t=e.synthesize(this.optionalProviders,void 0);return new this.ctor(t)}}]),e}(),_=r(60136),A=r(29388),E=r(4942),F=r(29439),R=r(37762),z=r(97326),B=r(27186),L=r(46115),V=r(90142),q=r(28664),H=r(92810);function G(e){var t;return"string"===typeof(null===(t=e)||void 0===t?void 0:t.tag)}function K(e,t){return Array.isArray(e)&&e.every((function(e){return U(e)}))?JSON.stringify(e):U(e)?e:(console.error("UnSupported Format of Logging Error Property for key ".concat(t,":"),e),"REDACTED (arbitrary object)")}function U(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}var J=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;return(0,n.Z)(this,r),(a=t.call(this,e)).omitPropsFromLogging=o,a._errorInstanceId=(0,H.Z)(),a.fluidErrorCode="-",o.add("omitPropsFromLogging"),o.add("_errorInstanceId"),i&&a.addTelemetryProperties(i),a}return(0,i.Z)(r,[{key:"errorInstanceId",get:function(){return this._errorInstanceId}},{key:"overwriteErrorInstanceId",value:function(e){this._errorInstanceId=e}},{key:"addTelemetryProperties",value:function(e){!function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];void 0===e[i]&&(e[i]=t[i])}}(this,e)}},{key:"getTelemetryProperties",value:function(){var e=function(e,t){for(var r={},n=0,i=Object.keys(e);n<i.length;n++){var a=i[n];if(!t.has(a)){var o=e[a];G(o)?r[a]={value:K(o.value,a),tag:o.tag}:r[a]=K(o,a)}}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}],[{key:"typeCheck",value:function(e){return"object"===typeof e&&null!==e&&("function"===typeof e.addTelemetryProperties&&"function"===typeof e.getTelemetryProperties&&"string"===typeof e.errorInstanceId)}}]),r}((0,q.Z)(Error)),W=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a;return(0,n.Z)(this,r),(a=t.call(this,e,Object.assign(Object.assign({},i),{usageError:!0}))).errorType=V.u.usageError,a}return(0,i.Z)(r)}(J),Q=r(24071);function X(e,t){return Y.apply(this,arguments)}function Y(){return Y=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readBlob(r);case 2:return n=e.sent,i=(0,Q.zT)(n,"utf8"),e.abrupt("return",JSON.parse(i));case 5:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}var $,ee=r(34977);!function(e){e[e.Shared=0]="Shared",e[e.Plain=1]="Plain"}($||($={}));var te=r(11752),re=r(61120),ne=r(57115),ie=r(62861),ae=r(5647),oe=r(1920),se=new oe.o((function(){return ce(de())})),ue={getRawConfig:function(){}},ce=function(e){return void 0!==e&&null!==e?new fe(void 0,{getRawConfig:function(t){var r,n;try{return null===(n=he(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(i){}}}):ue};function le(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function he(e){var t,r=e;if("string"===typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(vt){}if(void 0===r)return t;var n=typeof r;if(le(n))return Object.assign(Object.assign({},t),(0,E.Z)({raw:e},n,r));if(Array.isArray(r)){var i=typeof r[0];if(!le(i))return t;var a,o=(0,R.Z)(r);try{for(o.s();!(a=o.n()).done;){if(typeof a.value!==i)return t}}catch(s){o.e(s)}finally{o.f()}return Object.assign(Object.assign({},t),(0,E.Z)({raw:e},"".concat(i,"[]"),r))}return t}var de=function(){var e;try{return null!==(e=globalThis.sessionStorage)&&void 0!==e?e:void 0}catch(pt){return}},fe=function(){function e(t){(0,n.Z)(this,e),this.logger=t,this.configCache=new Map,this.orderedBaseProviders=[];for(var r=new Set,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];for(var s=[].concat(a);s.length>0;){var u=s.shift();void 0!==u&&ye(u)&&!r.has(u)&&(r.add(u),u instanceof e?s.push.apply(s,(0,p.Z)(u.orderedBaseProviders)):this.orderedBaseProviders.push(u))}}return(0,i.Z)(e,[{key:"getBoolean",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}},{key:"getNumber",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}},{key:"getString",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}},{key:"getBooleanArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}},{key:"getNumberArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}},{key:"getStringArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}},{key:"getRawConfig",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}},{key:"getCacheEntry",value:function(e){var t;if(!this.configCache.has(e)){var r,n=(0,R.Z)(this.orderedBaseProviders);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=he(null===i||void 0===i?void 0:i.getRawConfig(e));if(void 0!==a)return this.configCache.set(e,a),null===(t=this.logger)||void 0===t||t.send({category:"generic",eventName:"ConfigRead",configName:{tag:Me.CodeArtifact,value:e},configValue:{tag:Me.CodeArtifact,value:JSON.stringify(a)}}),a}}catch(o){n.e(o)}finally{n.f()}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}]),e}();function ve(e){var t=e;return ye(null===t||void 0===t?void 0:t.config)&&void 0!==(null===t||void 0===t?void 0:t.logger)}function pe(e){if(ve(e))throw new Error("Logger is already a monitoring context");for(var t=e,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return t.config=(0,ae.Z)(fe,[e].concat(n)),t.logger=e,t}function ye(e){return"function"===typeof(null===e||void 0===e?void 0:e.getRawConfig)}var ge=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)&&"function"===typeof(null===e||void 0===e?void 0:e.addTelemetryProperties)},be=function(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorInstanceId)};function me(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorType)&&"string"===typeof(null===e||void 0===e?void 0:e.message)&&ge(e)}var ke=function(e){return null!==e&&!Array.isArray(e)&&"object"===typeof e};function Ce(e,t){var r={message:"string"===typeof(null===e||void 0===e?void 0:e.message)?e.message:String(e)};if(ke(e)){var n=e.errorType,i=e.stack,a=e.name;if("string"===typeof n&&(r.errorType=n),"string"===typeof i){var o="string"===typeof a?a:void 0;r.stack=function(e,r){if(!t)return e;var n=e.split("\n");return n.shift(),void 0!==r&&n.unshift(r),n.join("\n")}(i,o)}}return r}var Se,we=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)};function Ze(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(me(e)&&function(e){var t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,H.Z)())}(e),"string"===typeof(null===(r=e)||void 0===r?void 0:r.errorType)&&"string"===typeof(null===r||void 0===r?void 0:r.message)&&be(r)&&ge(r))return e.addTelemetryProperties(null!==(t=n.props)&&void 0!==t?t:{}),e;var i=Ce(e,!1),a=i.message,o=i.stack,s=new Ae({message:a,stack:o});if("object"===typeof e&&null!==e){var u=e.canRetry,c=e.retryAfterSeconds;Object.assign(Ze,{canRetry:u,retryAfterSeconds:c})}"object"!==typeof e&&s.addTelemetryProperties({typeofError:typeof e});var l=je.typeCheck(e)?e.getTelemetryProperties():{untrustedOrigin:1};return s.addTelemetryProperties(Object.assign(Object.assign({},l),n.props)),s}function xe(){var e=new Error("<<generated stack>>");if(void 0===Se&&(Se=void 0!==e.stack),Se)return e;try{throw e}catch(t){return t}}function Ie(e,t){var r=Ce(e,!1),n=r.message,i=r.stack,a=t(n);return void 0!==i&&Te(a,i),Pe(e)&&a.addTelemetryProperties({untrustedOrigin:1}),be(e)&&(a.overwriteErrorInstanceId(e.errorInstanceId),a.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),we(e)&&a.addTelemetryProperties(e.getTelemetryProperties()),a}function Te(e,t){try{Object.assign(e,{stack:t})}catch(r){e.addTelemetryProperties({stack2:t})}}function Pe(e){return je.typeCheck(e)?e.errorType===_e&&1===e.getTelemetryProperties().untrustedOrigin:!me(e)}function Oe(e){var t;return"string"===typeof(null===(t=e)||void 0===t?void 0:t.tag)}function De(e,t){return Array.isArray(e)&&e.every((function(e){return Ne(e)}))?JSON.stringify(e):Ne(e)?e:(console.error("UnSupported Format of Logging Error Property for key ".concat(t,":"),e),"REDACTED (arbitrary object)")}function Ne(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}var Me,je=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;return(0,n.Z)(this,r),(a=t.call(this,e)).omitPropsFromLogging=o,a._errorInstanceId=(0,H.Z)(),a.fluidErrorCode="-",o.add("omitPropsFromLogging"),o.add("_errorInstanceId"),i&&a.addTelemetryProperties(i),a}return(0,i.Z)(r,[{key:"errorInstanceId",get:function(){return this._errorInstanceId}},{key:"overwriteErrorInstanceId",value:function(e){this._errorInstanceId=e}},{key:"addTelemetryProperties",value:function(e){!function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];void 0===e[i]&&(e[i]=t[i])}}(this,e)}},{key:"getTelemetryProperties",value:function(){var e=function(e,t){for(var r={},n=0,i=Object.keys(e);n<i.length;n++){var a=i[n];if(!t.has(a)){var o=e[a];Oe(o)?r[a]={value:De(o.value,a),tag:o.tag}:r[a]=De(o,a)}}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}],[{key:"typeCheck",value:function(e){return"object"===typeof e&&null!==e&&("function"===typeof e.addTelemetryProperties&&"function"===typeof e.getTelemetryProperties&&"string"===typeof e.errorInstanceId)}}]),r}((0,q.Z)(Error)),_e="genericError",Ae=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e.message)).errorType=_e,void 0!==e.stack&&Te((0,z.Z)(i),e.stack),i}return(0,i.Z)(r)}(je),Ee=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};!function(e){e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(Me||(Me={}));var Fe=function(){function e(t,r){(0,n.Z)(this,e),this.namespace=t,this.properties=r}return(0,i.Z)(e,[{key:"sendTelemetryEvent",value:function(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}},{key:"sendTelemetryEventCore",value:function(t,r){var n=function(e){for(var t=e.category,r=e.eventName,n=Ee(e,["category","eventName"]),i={category:t,eventName:r},a=0,o=Object.keys(n);a<o.length;a++){var s=o[a];i[s]=Be(n[s])}return i}(t);void 0!==r&&e.prepareErrorObject(n,r,!1),"number"===typeof n.duration&&(n.duration=e.formatTick(n.duration)),this.send(n)}},{key:"sendErrorEvent",value:function(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}},{key:"sendPerformanceEvent",value:function(e,t){var r,n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}},{key:"prepareEvent",value:function(t){var r="error"===t.category||void 0!==t.error,n=Object.assign({},t);if(void 0!==this.namespace&&(n.eventName="".concat(this.namespace).concat(e.eventNamespaceSeparator).concat(n.eventName)),this.properties){var i=[];i.push(this.properties.all),r&&i.push(this.properties.error);for(var a=0,o=i;a<o.length;a++){var s=o[a];if(void 0!==s)for(var u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];if(void 0===t[l]){var h=s[l],d="function"===typeof h?h():h;void 0!==d&&(n[l]=d)}}}}return n}}],[{key:"formatTick",value:function(e){return Math.floor(e)}},{key:"numberFromString",value:function(e){if(void 0!==e&&null!==e){var t=Number(e);return Number.isNaN(t)?e:t}}},{key:"sanitizePkgName",value:function(e){return e.replace("@","").replace("/","-")}},{key:"prepareErrorObject",value:function(e,t,r){var n=Ce(t,!0),i=n.message,a=n.errorType,o=n.stack;if(e.stack=o,e.error=i,e.errorType=a,we(t))for(var s=t.getTelemetryProperties(),u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];void 0===e[l]&&(e[l]=s[l])}void 0===e.stack&&r&&(e.stack=xe().stack)}}]),e}();Fe.eventNamespaceSeparator=":";var Re=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a){var o;return(0,n.Z)(this,r),(o=t.call(this,i,a)).baseLogger=e,ve(e)&&pe((0,z.Z)(o),new fe((0,z.Z)(o),e.config)),o}return(0,i.Z)(r,[{key:"send",value:function(e){this.baseLogger.send(this.prepareEvent(e))}}],[{key:"create",value:function(e,t,n){if(e instanceof r){for(var i={},a=0,o=[e.properties,n];a<o.length;a++){var s=o[a];void 0!==s&&(void 0!==s.all&&(i.all=Object.assign(Object.assign({},i.all),s.all)),void 0!==s.error&&(i.error=Object.assign(Object.assign({},i.error),s.error)))}var u=void 0===e.namespace?t:void 0===t?e.namespace:"".concat(e.namespace).concat(Fe.eventNamespaceSeparator).concat(t);return new r(e.baseLogger,u,i)}return new r(e||new ze,t,n)}}]),r}(Fe),ze=function(){function e(){(0,n.Z)(this,e)}return(0,i.Z)(e,[{key:"send",value:function(e){}}]),e}();function Be(e){return Oe(e)?{value:Le(e.value),tag:e.tag}:Le(e)}function Le(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"object":return JSON.stringify(e);default:return console.error("convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ".concat(typeof e,")")),"INVALID PROPERTY (typed as ".concat(typeof e,")")}}var Ve,qe=r(9070),He=function(){function e(t,r,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Map;(0,n.Z)(this,e),this.eventBase=t,this.logger=r,this.sampleThreshold=i,this.includeAggregateMetrics=a,this.perBucketProperties=o,this.disposed=!1,this.measurementsMap=new Map}return(0,i.Z)(e,[{key:"measure",value:function(e){var t,r,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=qe.S.now(),o=e(),s=qe.S.now()-a,u=this.measurementsMap.get(i);return void 0===u&&(u={count:0,duration:-1},this.measurementsMap.set(i,u)),u.count++,u.duration=s,this.includeAggregateMetrics&&(u.totalDuration=(null!==(t=u.totalDuration)&&void 0!==t?t:0)+s,u.minDuration=Math.min(null!==(r=u.minDuration)&&void 0!==r?r:s,s),u.maxDuration=Math.max(null!==(n=u.maxDuration)&&void 0!==n?n:0,s)),u.count>=this.sampleThreshold&&this.flushBucket(i),o}},{key:"flushBucket",value:function(e){var t=this.measurementsMap.get(e);if(void 0!==t&&0!==t.count){var r=this.perBucketProperties.get(e),n=Object.assign(Object.assign(Object.assign({},this.eventBase),r),t);this.logger.sendPerformanceEvent(n),this.measurementsMap.delete(e)}}},{key:"dispose",value:function(e){var t=this;this.measurementsMap.forEach((function(e,r){return t.flushBucket(r)}))}}]),e}(),Ge=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this)).errorHandler=e,i}return(0,i.Z)(r,[{key:"emit",value:function(e){try{for(var t,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return(t=(0,te.Z)((0,re.Z)(r.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}catch(V){return this.errorHandler(e,V),!0}}}]),r}(L.L),Ke=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).errorType=V.u.dataProcessingError,i.canRetry=!1,i}return(0,i.Z)(r,null,[{key:"create",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.wrapIfUnrecognized(e,t,n);return a.addTelemetryProperties(i),a}},{key:"wrapIfUnrecognized",value:function(e,t,n){var i=Ze(e,{props:Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===n?void 0:Ue(n))});if(Pe(i)||i.errorType===_e){var a=Ie(i,(function(e){return new r(e)}));return a.addTelemetryProperties(i.getTelemetryProperties()),a}return i}}]),r}(je),Ue=function(e){return{messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp}};function Je(e,t){if(""===e)return void 0===t?"":t.absolutePath;var r=e.startsWith("/")?e.slice(1):e;return r=r.endsWith("/")?r.slice(0,-1):r,void 0===t?"/".concat(r):"".concat("/"===t.absolutePath?"":t.absolutePath,"/").concat(r)}!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.IdAllocation="idAllocation"}(Ve||(Ve={}));var We;!function(e){e.wait="wait",e.viaHandle="viaHandle"}(We||(We={}));var Qe;!function(e){e.lz4="lz4"}(Qe||(Qe={}));var Xe;ie.ZN.TurnBased,Qe.lz4;!function(e){e.FluidDataStoreOp="component",e.Attach="attach",e.ChunkedOp="chunkedOp",e.BlobAttach="blobAttach",e.Rejoin="rejoin",e.Alias="alias",e.Operation="op"}(Xe||(Xe={}));function Ye(e){if(null!==e&&"object"===typeof e&&!0===e.errorFromRequestFluidObject){var t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack},headers:t.underlyingResponseHeaders}}var r=xe();return{mimeType:"text/plain",status:500,value:"".concat(e),get stack(){var t;return null!==(t=null===e||void 0===e?void 0:e.stack)&&void 0!==t?t:r.stack}}}function $e(e,t){var r=e.value,n=xe(),i={errorFromRequestFluidObject:!0,message:r,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:n.stack},underlyingResponseHeaders:e.headers};return i}var et=function(e){return function(e,t,r,n){var i;(0,B.h)(200!==e,411);var a=null===(i=r.url)||void 0===i?void 0:i.split("?")[0],o=xe();return{mimeType:"text/plain",status:e,value:void 0===a?t:"".concat(t,": ").concat(a),get stack(){return o.stack},headers:n}}(404,"not found",e)};var tt=function(){function e(t,r){(0,n.Z)(this,e),this.absolutePath=t,this.routeContext=r,this.isAttached=!0,(0,B.h)(t.startsWith("/"),413)}return(0,i.Z)(e,[{key:"IFluidRouter",get:function(){return this}},{key:"IFluidHandleContext",get:function(){return this}},{key:"IFluidHandle",get:function(){return this}},{key:"get",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.objectP&&(t={url:this.absolutePath,headers:(0,E.Z)({},We.viaHandle,!0)},this.objectP=this.routeContext.resolveHandle(t).then((function(e){if("fluid/object"===e.mimeType)return e.value;throw $e(e)}))),e.abrupt("return",this.objectP);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){}},{key:"bind",value:function(e){e.attachGraph()}},{key:"request",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.get();case 3:return r=e.sent,n=r.IFluidRouter,e.abrupt("return",void 0!==n?n.request(t):et(t));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",Ye(e.t0));case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),rt=function(){function e(t,r){var i=this;for((0,n.Z)(this,e),this.context=t,this.handleParsedCb=r,this.encodeValue=function(e,t){var r=null===e||void 0===e?void 0:e.IFluidHandle;return void 0!==r?i.serializeHandle(r,t):e},this.decodeValue=function(e){if(function(e){return"__fluid_handle__"===(null===e||void 0===e?void 0:e.type)}(e)){var t=e.url.startsWith("/")?e.url:Je(e.url,i.context),r=new tt(t,i.root);return i.handleParsedCb(r),r}return e},this.root=this.context;void 0!==this.root.routeContext;)this.root=this.root.routeContext}return(0,i.Z)(e,[{key:"IFluidSerializer",get:function(){return this}},{key:"encode",value:function(e,t){return e&&"object"===typeof e?this.recursivelyReplace(e,this.encodeValue,t):e}},{key:"decode",value:function(e){return e&&"object"===typeof e?this.recursivelyReplace(e,this.decodeValue):e}},{key:"stringify",value:function(e,t){var r=this;return JSON.stringify(e,(function(e,n){return r.encodeValue(n,t)}))}},{key:"parse",value:function(e){var t=this;return JSON.parse(e,(function(e,r){return t.decodeValue(r)}))}},{key:"recursivelyReplace",value:function(e,t,r){var n,i=t(e,r);if(i!==e)return i;for(var a=0,o=Object.keys(e);a<o.length;a++){var s=o[a],u=e[s];if(u&&"object"===typeof u){var c=this.recursivelyReplace(u,t,r);c!==u&&((n=null!==n&&void 0!==n?n:Array.isArray(e)?(0,p.Z)(e):Object.assign({},e))[s]=c)}}return null!==n&&void 0!==n?n:e}},{key:"serializeHandle",value:function(e,t){return t.bind(e),{type:"__fluid_handle__",url:e.absolutePath}}}]),e}(),nt=function(){function e(t,r,i){(0,n.Z)(this,e),this.value=t,this.path=r,this.routeContext=i,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=Je(r,this.routeContext)}return(0,i.Z)(e,[{key:"IFluidHandle",get:function(){return this}},{key:"isAttached",get:function(){return this.routeContext.isAttached}},{key:"visible",get:function(){return this.isAttached||this.locallyVisible}},{key:"get",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.value);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}},{key:"bind",value:function(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}]),e}(),it=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a){var o;return(0,n.Z)(this,r),(o=t.call(this,e,i,a)).value=e,o}return(0,i.Z)(r,[{key:"isAttached",get:function(){return this.value.isAttached()}},{key:"attachGraph",value:function(){this.value.bindToContext(),(0,te.Z)((0,re.Z)(r.prototype),"attachGraph",this).call(this)}}]),r}(nt),at=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).serializedRoutes=new Set,e}return(0,i.Z)(r,[{key:"getSerializedRoutes",value:function(){return Array.from(this.serializedRoutes)}},{key:"serializeHandle",value:function(e,t){return this.serializedRoutes.add(e.absolutePath),(0,te.Z)((0,re.Z)(r.prototype),"serializeHandle",this).call(this,e,t)}}]),r}(rt),ot=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a){var o,s;(0,n.Z)(this,r),(o=t.call(this,(function(e,t){return o.eventListenerErrorHandler(e,t)}))).id=e,o.runtime=i,o.attributes=a,o._connected=!1,o._isBoundToContext=!1,(0,B.h)(!e.includes("/"),772),o.handle=new it((0,z.Z)(o),e,i.IFluidHandleContext),o.logger=Re.create(i.logger,void 0,{all:{sharedObjectId:(0,H.Z)(),ddsType:{value:o.attributes.type,tag:Me.CodeArtifact}}}),o.mc=ve(s=o.logger)?s:pe(s,se.value);var u=o.setUpSampledTelemetryHelpers(),c=(0,F.Z)(u,2);return o.opProcessingHelper=c[0],o.callbacksHelper=c[1],o.attachListeners(),o}return(0,i.Z)(r,[{key:"IFluidLoadable",get:function(){return this}},{key:"connected",get:function(){return this._connected}},{key:"setUpSampledTelemetryHelpers",value:function(){var e,t,r=this;(0,B.h)(void 0!==this.mc&&void 0!==this.logger,841);var n=new He({eventName:"ddsOpProcessing",category:"performance"},this.logger,null!==(e=this.mc.config.getNumber("Fluid.SharedObject.OpProcessingTelemetrySampling"))&&void 0!==e?e:1e3,!0,new Map([["local",{localOp:!0}],["remote",{localOp:!1}]])),i=new He({eventName:"ddsEventCallbacks",category:"performance"},this.logger,null!==(t=this.mc.config.getNumber("Fluid.SharedObject.DdsCallbacksTelemetrySampling"))&&void 0!==t?t:1e3,!0);return this.runtime.once("dispose",(function(){r.callbacksHelper.dispose(),r.opProcessingHelper.dispose()})),[n,i]}},{key:"closeWithError",value:function(e){void 0===this.closeError&&(this.closeError=e)}},{key:"verifyNotClosed",value:function(){if(void 0!==this.closeError)throw this.closeError}},{key:"eventListenerErrorHandler",value:function(e,t){var r=Ke.wrapIfUnrecognized(t,"SharedObjectEventListenerException");throw r.addTelemetryProperties({emittedEventName:String(e)}),this.closeWithError(r),r}},{key:"attachListeners",value:function(){var e=this;this.isAttached()||this.runtime.once("attaching",(function(){e.didAttach()}))}},{key:"load",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.runtime.attachState!==ne.m.Detached&&(this.services=t),e.next=3,this.loadCore(t.objectStorage);case 3:this.runtime.attachState!==ne.m.Detached&&this.attachDeltaHandler();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeLocal",value:function(){this.initializeLocalCore()}},{key:"bindToContext",value:function(){this._isBoundToContext||(this._isBoundToContext=!0,this.runtime.bindChannel(this))}},{key:"connect",value:function(e){this.services=e,this.attachDeltaHandler()}},{key:"isAttached",value:function(){return void 0!==this.services&&this.runtime.attachState!==ne.m.Detached}},{key:"handleDecoded",value:function(e){var t,r,n;this.isAttached()&&(null===(n=null===(t=this.services)||void 0===t?void 0:(r=t.deltaConnection).addedGCOutboundReference)||void 0===n||n.call(r,this.handle,e))}},{key:"initializeLocalCore",value:function(){}},{key:"didAttach",value:function(){}},{key:"submitLocalMessage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.verifyNotClosed(),this.isAttached()&&this.services.deltaConnection.submit(e,t)}},{key:"dirty",value:function(){this.isAttached()&&this.services.deltaConnection.dirty()}},{key:"onConnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){this.submitLocalMessage(e,t)}},{key:"newAckBasedPromise",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){r=function(){return i(new Error("FluidDataStoreRuntime disposed while this ack-based Promise was pending"))},n.runtime.disposed?r():(n.runtime.on("dispose",r),t(e,i))})).finally((function(){n.runtime.off("dispose",r)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"attachDeltaHandler",value:function(){var e=this;(0,B.h)(void 0!==this.services,122),this._isBoundToContext=!0,this.didAttach(),this.services.deltaConnection.attach({process:function(t,r,n){e.process(t,r,n)},setConnectionState:function(t){e.setConnectionState(t)},reSubmit:function(t,r){e.reSubmit(t,r)},applyStashedOp:function(t){return e.applyStashedOp(t)},rollback:function(t,r){e.rollback(t,r)}}),this.setConnectionState(this.services.deltaConnection.connected)}},{key:"setConnectionState",value:function(e){this._connected!==e&&(this._connected=e,e?this.onConnect():this.onDisconnect())}},{key:"process",value:function(e,t,r){var n=this;this.verifyNotClosed(),this.emitInternal("pre-op",e,t,this),this.opProcessingHelper.measure((function(){n.processCore(e,t,r)}),t?"local":"remote"),this.emitInternal("op",e,t,this)}},{key:"reSubmit",value:function(e,t){this.reSubmitCore(e,t)}},{key:"rollback",value:function(e,t){throw new Error("rollback not supported")}},{key:"emit",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.callbacksHelper.measure((function(){return t.runtime.ensureNoDataModelChanges((function(){var n;return(n=(0,te.Z)((0,re.Z)(r.prototype),"emit",t)).call.apply(n,[t,e].concat(i))}))}))}},{key:"emitInternal",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return(t=(0,te.Z)((0,re.Z)(r.prototype),"emit",this)).call.apply(t,[this,e].concat(i))}}]),r}(Ge),st=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a,o){var s;return(0,n.Z)(this,r),(s=t.call(this,e,i,a)).telemetryContextPrefix=o,s._isGCing=!1,s._serializer=new rt(s.runtime.channelsRoutingContext,(function(e){return s.handleDecoded(e)})),s}return(0,i.Z)(r,[{key:"serializer",get:function(){return(0,B.h)(!this._isGCing,117),this._serializer}},{key:"getAttachSummary",value:function(){var e=arguments.length>2?arguments[2]:void 0,t=this.summarizeCore(this.serializer,e);return this.incrementTelemetryMetric(ie.nS,t.stats.blobNodeCount,e),this.incrementTelemetryMetric(ie.rm,t.stats.totalBlobSize,e),t}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.length>0&&void 0!==i[0]&&i[0],i.length>1&&void 0!==i[1]&&i[1],t=i.length>2?i[2]:void 0,r=i.length>3?i[3]:void 0,n=this.summarizeCore(this.serializer,t,r),this.incrementTelemetryMetric(ie.nS,n.stats.blobNodeCount,t),this.incrementTelemetryMetric(ie.rm,n.stats.totalBlobSize,t),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e,t=this;(0,B.h)(!this._isGCing,120),this._isGCing=!0;try{var r=new at(this.runtime.channelsRoutingContext,(function(e){return t.handleDecoded(e)}));this.processGCDataCore(r),e={gcNodes:{"/":r.getSerializedRoutes()}},(0,B.h)(this._isGCing,121)}finally{this._isGCing=!1}return e}},{key:"processGCDataCore",value:function(e){this.summarizeCore(e)}},{key:"incrementTelemetryMetric",value:function(e,t,r){var n,i=null!==(n=null===r||void 0===r?void 0:r.get(this.telemetryContextPrefix,e))&&void 0!==n?n:0;null===r||void 0===r||r.set(this.telemetryContextPrefix,e,i+t)}}]),r}(ot),ut=r(24713);function ct(){for(var e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0,a=r;i<a.length;i++){var o=a[i];e.treeNodeCount+=o.treeNodeCount,e.blobNodeCount+=o.blobNodeCount,e.handleNodeCount+=o.handleNodeCount,e.totalBlobSize+=o.totalBlobSize,e.unreferencedBlobSize+=o.unreferencedBlobSize}return e}function lt(e){return"string"===typeof e?function(e){for(var t=e.length,r=e.length-1;r>=0;r--){var n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t}(e):e.byteLength}var ht=function(){function e(){(0,n.Z)(this,e),this.attachmentCounter=0,this.summaryTree={},this.summaryStats=ct(),this.summaryStats.treeNodeCount++}return(0,i.Z)(e,[{key:"summary",get:function(){return{type:ut.J.Tree,tree:Object.assign({},this.summaryTree)}}},{key:"stats",get:function(){return Object.assign({},this.summaryStats)}},{key:"addBlob",value:function(e,t){!function(e,t,r){var n={type:ut.J.Blob,content:r};e.summary.tree[t]=n,e.stats.blobNodeCount++,e.stats.totalBlobSize+=lt(r)}({summary:{type:ut.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}},{key:"addHandle",value:function(e,t,r){this.summaryTree[e]={type:ut.J.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}},{key:"addWithStats",value:function(e,t){this.summaryTree[e]=t.summary,this.summaryStats=ct(this.summaryStats,t.stats)}},{key:"addAttachment",value:function(e){this.summaryTree[this.attachmentCounter++]={id:e,type:ut.J.Attachment}}},{key:"getSummaryTree",value:function(){return{summary:this.summary,stats:this.stats}}}]),e}();var dt=r(5982);function ft(e,t,r){var n=e.makeSerialized(t,r);return{type:n.type,value:n.value&&JSON.parse(n.value)}}var vt,pt,yt=function(){function e(t){(0,n.Z)(this,e),this.value=t}return(0,i.Z)(e,[{key:"type",get:function(){return $[$.Plain]}},{key:"makeSerialized",value:function(e,t){var r=function(e,t,r){return void 0!==e?t.stringify(e,r):e}(this.value,e,t);return{type:this.type,value:r}}}]),e}(),gt=function(){function e(t){(0,n.Z)(this,e),this.serializer=t}return(0,i.Z)(e,[{key:"fromSerializable",value:function(e){if(e.type===$[$.Shared]){e.type=$[$.Plain];var t={type:"__fluid_handle__",url:e.value};e.value=t}var r,n,i=(r=e.value,n=this.serializer,void 0!==r?n.parse(JSON.stringify(r)):r);return new yt(i)}},{key:"fromInMemory",value:function(e){return new yt(e)}}]),e}(),bt="2.0.0-internal.4.3.0",mt=dt.posix,kt="header",Ct=function(){function e(){(0,n.Z)(this,e)}return(0,i.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){var o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new St(r,t,i),e.next=3,o.load(n);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"create",value:function(t,r){var n=new St(r,t,e.Attributes);return n.initializeLocal(),n}}]),e}();Ct.Type="https://graph.microsoft.com/types/directory",Ct.Attributes={type:Ct.Type,snapshotFormatVersion:"0.1",packageVersion:bt};var St=function(e,t){(0,_.Z)(s,e);var r=(0,A.Z)(s);function s(e,t,i){var a;return(0,n.Z)(this,s),(a=r.call(this,e,t,i,"fluid_directory_"))[vt]="SharedDirectory",a.root=new Tt(0,new Set,(0,z.Z)(a),a.runtime,a.serializer,mt.sep),a.messageHandlers=new Map,a.localValueMaker=new gt(a.serializer),a.setMessageHandlers(),a.root.on("containedValueChanged",(function(e,t){a.emit("containedValueChanged",e,t,(0,z.Z)(a))})),a.root.on("subDirectoryCreated",(function(e,t){a.emit("subDirectoryCreated",e,t,(0,z.Z)(a))})),a.root.on("subDirectoryDeleted",(function(e,t){a.emit("subDirectoryDeleted",e,t,(0,z.Z)(a))})),a}return(0,i.Z)(s,[{key:"absolutePath",get:function(){return this.root.absolutePath}},{key:"get",value:function(e){return this.root.get(e)}},{key:"set",value:function(e,t){return this.root.set(e,t),this}},{key:"dispose",value:function(e){this.root.dispose(e)}},{key:"disposed",get:function(){return this.root.disposed}},{key:"delete",value:function(e){return this.root.delete(e)}},{key:"clear",value:function(){this.root.clear()}},{key:"has",value:function(e){return this.root.has(e)}},{key:"size",get:function(){return this.root.size}},{key:"forEach",value:function(e){this.root.forEach(e)}},{key:t,value:function(){return this.root[Symbol.iterator]()}},{key:"entries",value:function(){return this.root.entries()}},{key:"countSubDirectory",value:function(){return this.root.countSubDirectory()}},{key:"keys",value:function(){return this.root.keys()}},{key:"values",value:function(){return this.root.values()}},{key:"createSubDirectory",value:function(e){return this.root.createSubDirectory(e)}},{key:"getSubDirectory",value:function(e){return this.root.getSubDirectory(e)}},{key:"hasSubDirectory",value:function(e){return this.root.hasSubDirectory(e)}},{key:"deleteSubDirectory",value:function(e){return this.root.deleteSubDirectory(e)}},{key:"subdirectories",value:function(){return this.root.subdirectories()}},{key:"getWorkingDirectory",value:function(e){var t=this.makeAbsolute(e);if(t===mt.sep)return this.root;var r,n=this.root,i=t.slice(1).split(mt.sep),a=(0,R.Z)(i);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(!(n=n.getSubDirectory(o)))return}}catch(s){a.e(s)}finally{a.f()}return n}},{key:"summarizeCore",value:function(e,t){return this.serializeDirectory(this.root,e)}},{key:"submitDirectoryMessage",value:function(e,t){this.submitLocalMessage(e,t)}},{key:"onDisconnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){var r=e,n=this.messageHandlers.get(r.type);(0,B.h)(void 0!==n,13),n.submit(r,t)}},{key:"loadCore",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(t,kt);case 2:if(r=e.sent,n=r,!Array.isArray(n.blobs)){e.next=10;break}return this.populate(n.content),e.next=8,Promise.all(n.blobs.map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(r){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(t,r);case 2:n=e.sent,i.populate(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:e.next=11;break;case 10:this.populate(r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"populate",value:function(e){var t=[];for(t.push([this.root,e]);t.length>0;){var r=t.pop(),n=(0,F.Z)(r,2),i=n[0],a=n[1];if(a.subdirectories)for(var o=0,s=Object.entries(a.subdirectories);o<s.length;o++){var u=(0,F.Z)(s[o],2),c=u[0],l=u[1],h=i.getSubDirectory(c);if(!h){var d=l.ci;h=new Tt(void 0!==d?d.csn:0,void 0!==d?new Set(d.ccIds):new Set,this,this.runtime,this.serializer,mt.join(i.absolutePath,c)),i.populateSubDirectory(c,h)}t.push([h,l])}if(a.storage)for(var f=0,v=Object.entries(a.storage);f<v.length;f++){var p=(0,F.Z)(v[f],2),y=p[0],g=p[1],b=this.makeLocal(y,i.absolutePath,g);i.populateStorage(y,b)}}}},{key:"processCore",value:function(e,t,r){if(e.type===ee.Cs.Operation){var n=e.contents,i=this.messageHandlers.get(n.type);(0,B.h)(void 0!==i,14),i.process(e,n,t,r)}}},{key:"rollback",value:function(e,t){var r=e,n=this.getWorkingDirectory(r.path);n&&n.rollback(r,t)}},{key:"makeAbsolute",value:function(e){return mt.resolve(mt.sep,e)}},{key:"makeLocal",value:function(e,t,r){return(0,B.h)(r.type===$[$.Plain]||r.type===$[$.Shared],484),this.localValueMaker.fromSerializable(r)}},{key:"isSubDirectoryDeletePending",value:function(e){var t=this.makeAbsolute(e);if(t===mt.sep)return!1;for(var r=this.root,n=t.split(mt.sep),i=1;i<n.length;){var a=n[i];if(r.isSubDirectoryDeletePending(a))return!0;if(void 0===(r=r.getSubDirectory(a)))return!0;i+=1}return!1}},{key:"setMessageHandlers",value:function(){var e=this;this.messageHandlers.set("clear",{process:function(t,r,n,i){var a=e.getWorkingDirectory(r.path);a&&!e.isSubDirectoryDeletePending(r.path)&&a.processClearMessage(t,r,n,i)},submit:function(t,r){var n=e.getWorkingDirectory(t.path);n&&n.resubmitClearMessage(t,r)},applyStashedOp:function(t){var r=e.getWorkingDirectory(t.path);if(r)return r.applyStashedClearMessage(t)}}),this.messageHandlers.set("delete",{process:function(t,r,n,i){var a=e.getWorkingDirectory(r.path);a&&!e.isSubDirectoryDeletePending(r.path)&&a.processDeleteMessage(t,r,n,i)},submit:function(t,r){var n=e.getWorkingDirectory(t.path);n&&n.resubmitKeyMessage(t,r)},applyStashedOp:function(t){var r=e.getWorkingDirectory(t.path);if(r)return r.applyStashedDeleteMessage(t)}}),this.messageHandlers.set("set",{process:function(t,r,n,i){var a=e.getWorkingDirectory(r.path);if(a&&!e.isSubDirectoryDeletePending(r.path)){var o=n?void 0:e.makeLocal(r.key,r.path,r.value);a.processSetMessage(t,r,o,n,i)}},submit:function(t,r){var n=e.getWorkingDirectory(t.path);n&&n.resubmitKeyMessage(t,r)},applyStashedOp:function(t){var r=e.getWorkingDirectory(t.path);if(r){var n=e.makeLocal(t.key,t.path,t.value);return r.applyStashedSetMessage(t,n)}}}),this.messageHandlers.set("createSubDirectory",{process:function(t,r,n,i){var a=e.getWorkingDirectory(r.path);a&&!e.isSubDirectoryDeletePending(r.path)&&a.processCreateSubDirectoryMessage(t,r,n,i)},submit:function(t,r){var n=e.getWorkingDirectory(t.path);n&&n.resubmitSubDirectoryMessage(t,r)},applyStashedOp:function(t){var r=e.getWorkingDirectory(t.path);if(r)return r.applyStashedCreateSubDirMessage(t)}}),this.messageHandlers.set("deleteSubDirectory",{process:function(t,r,n,i){var a=e.getWorkingDirectory(r.path);a&&!e.isSubDirectoryDeletePending(r.path)&&a.processDeleteSubDirectoryMessage(t,r,n,i)},submit:function(t,r){var n=e.getWorkingDirectory(t.path);n&&n.resubmitSubDirectoryMessage(t,r)},applyStashedOp:function(t){var r=e.getWorkingDirectory(t.path);if(r)return r.applyStashedDeleteSubDirMessage(t)}})}},{key:"applyStashedOp",value:function(e){var t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.applyStashedOp(e)}},{key:"serializeDirectory",value:function(e,t,r){var n=new ht,i=0,a=[],o=[],s={};for(o.push([e,s]);o.length>0;){var u=o.pop(),c=(0,F.Z)(u,2),l=c[0],h=c[1];h.ci=l.getSerializableCreateInfo();var d,f=(0,R.Z)(l.getSerializedStorage(t));try{for(f.s();!(d=f.n()).done;){var v=(0,F.Z)(d.value,2),p=v[0],y=v[1];h.storage||(h.storage={});var g={type:y.type,value:y.value&&JSON.parse(y.value)};if(y.value&&y.value.length>=8192){var b={},m=b;if(l.absolutePath!==mt.sep){var k,C=(0,R.Z)(l.absolutePath.slice(1).split(mt.sep));try{for(C.s();!(k=C.n()).done;){var S=k.value,w={};m.subdirectories=(0,E.Z)({},S,w),m=w}}catch(M){C.e(M)}finally{C.f()}}m.storage=(0,E.Z)({},p,g);var Z="blob".concat(i);i++,a.push(Z),n.addBlob(Z,JSON.stringify(b))}else h.storage[p]=g}}catch(M){f.e(M)}finally{f.f()}var x,I=(0,R.Z)(l.subdirectories());try{for(I.s();!(x=I.n()).done;){var T=(0,F.Z)(x.value,2),P=T[0],O=T[1];h.subdirectories||(h.subdirectories={});var D={};h.subdirectories[P]=D,o.push([O,D])}}catch(M){I.e(M)}finally{I.f()}}var N={blobs:a,content:s};return n.addBlob(kt,JSON.stringify(N)),n.getSummaryTree()}}],[{key:"create",value:function(e,t){return e.createChannel(t,Ct.Type)}},{key:"getFactory",value:function(){return new Ct}}]),s}(st,(vt=Symbol.toStringTag,Symbol.iterator));function wt(e){return void 0!==e&&"number"===typeof e.pendingMessageId&&"edit"===e.type}function Zt(e){return void 0!==e&&"clear"===e.type&&"number"===typeof e.pendingMessageId&&"object"===typeof e.previousStorage}function xt(e){return void 0!==e&&"number"===typeof e.pendingMessageId&&("createSubDir"===e.type||"deleteSubDir"===e.type)}function It(e){(0,B.h)(null!==e,1711)}var Tt=function(e,t){(0,_.Z)(o,e);var r=(0,A.Z)(o);function o(e,t,i,a,s,u){var c;return(0,n.Z)(this,o),(c=r.call(this)).sequenceNumber=e,c.clientIds=t,c.directory=i,c.runtime=a,c.serializer=s,c.absolutePath=u,c._deleted=!1,c[pt]="SubDirectory",c._storage=new Map,c._subdirectories=new Map,c.pendingKeys=new Map,c.pendingSubDirectories=new Map,c.pendingDeleteSubDirectoriesCount=new Map,c.pendingMessageId=-1,c.pendingClearMessageIds=[],c}return(0,i.Z)(o,[{key:"dispose",value:function(e){this._deleted=!0,this.emit("disposed",this)}},{key:"undispose",value:function(){this._deleted=!1,this.emit("undisposed",this)}},{key:"disposed",get:function(){return this._deleted}},{key:"throwIfDisposed",value:function(){if(this._deleted)throw new W("Cannot access Disposed subDirectory")}},{key:"has",value:function(e){return this.throwIfDisposed(),this._storage.has(e)}},{key:"get",value:function(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}},{key:"set",value:function(e,t){if(this.throwIfDisposed(),void 0===e||null===e)throw new Error("Undefined and null keys are not supported");var r=this.directory.localValueMaker.fromInMemory(t),n=ft(r,this.serializer,this.directory.handle),i=this.setCore(e,r,!0);if(!this.directory.isAttached())return this;var a={key:e,path:this.absolutePath,type:"set",value:n};return this.submitKeyMessage(a,i),this}},{key:"countSubDirectory",value:function(){return this._subdirectories.size}},{key:"createSubDirectory",value:function(e){var t;if(this.throwIfDisposed(),void 0===e||null===e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(mt.sep))throw new Error("SubDirectory name may not contain ".concat(mt.sep));var r=this.createSubDirectoryCore(e,!0,-1,null!==(t=this.runtime.clientId)&&void 0!==t?t:"detached"),n=this._subdirectories.get(e);if((0,B.h)(void 0!==n,1450),!this.directory.isAttached())return n;if(r){var i={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};this.submitCreateSubDirectoryMessage(i)}return n}},{key:"getSubDirectory",value:function(e){return this.throwIfDisposed(),this._subdirectories.get(e)}},{key:"hasSubDirectory",value:function(e){return this.throwIfDisposed(),this._subdirectories.has(e)}},{key:"deleteSubDirectory",value:function(e){this.throwIfDisposed();var t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return void 0!==t;if(void 0!==t){var r={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};this.submitDeleteSubDirectoryMessage(r,t)}return void 0!==t}},{key:"subdirectories",value:function(){return this.throwIfDisposed(),this._subdirectories.entries()}},{key:"getWorkingDirectory",value:function(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}},{key:"isSubDirectoryDeletePending",value:function(e){var t=this.pendingDeleteSubDirectoriesCount.get(e);return void 0!==t&&t>0}},{key:"delete",value:function(e){this.throwIfDisposed();var t=this.deleteCore(e,!0);if(!this.directory.isAttached())return void 0!==t;var r={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(r,t),void 0!==t}},{key:"clear",value:function(){if(this.throwIfDisposed(),this.directory.isAttached()){var e=new Map(this._storage);this.clearCore(!0);var t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}else this.clearCore(!0)}},{key:"forEach",value:function(e){this.throwIfDisposed(),this._storage.forEach((function(t,r,n){e(t.value,r,n)}))}},{key:"size",get:function(){return this.throwIfDisposed(),this._storage.size}},{key:"entries",value:function(){this.throwIfDisposed();var e=this._storage.entries();return(0,E.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}}},Symbol.iterator,(function(){return this}))}},{key:"keys",value:function(){return this.throwIfDisposed(),this._storage.keys()}},{key:"values",value:function(){this.throwIfDisposed();var e=this._storage.values();return(0,E.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}}},Symbol.iterator,(function(){return this}))}},{key:t,value:function(){return this.throwIfDisposed(),this.entries()}},{key:"processClearMessage",value:function(e,t,r,n){if(this.throwIfDisposed(),this.isMessageForCurrentInstanceOfSubDirectory(e))if(r){(0,B.h)(Zt(n),15);var i=this.pendingClearMessageIds.shift();(0,B.h)(i===n.pendingMessageId,810)}else this.clearExceptPendingKeys(!1)}},{key:"applyStashedClearMessage",value:function(e){this.throwIfDisposed();var t=new Map(this._storage);this.clearExceptPendingKeys(!0);var r=++this.pendingMessageId;return this.pendingClearMessageIds.push(r),{type:"clear",pendingMessageId:r,previousStorage:t}}},{key:"processDeleteMessage",value:function(e,t,r,n){this.throwIfDisposed(),this.isMessageForCurrentInstanceOfSubDirectory(e)&&this.needProcessStorageOperation(t,r,n)&&this.deleteCore(t.key,r)}},{key:"applyStashedDeleteMessage",value:function(e){this.throwIfDisposed();var t=this.deleteCore(e.key,!0);return{type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t}}},{key:"processSetMessage",value:function(e,t,r,n,i){this.throwIfDisposed(),this.isMessageForCurrentInstanceOfSubDirectory(e)&&this.needProcessStorageOperation(t,n,i)&&this.setCore(t.key,r,n)}},{key:"applyStashedSetMessage",value:function(e,t){this.throwIfDisposed();var r=this.setCore(e.key,t,!0);return{type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:r}}},{key:"processCreateSubDirectoryMessage",value:function(e,t,r,n){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,r,n)&&(It(e.clientId),this.createSubDirectoryCore(t.subdirName,r,e.sequenceNumber,e.clientId))}},{key:"applyStashedCreateSubDirMessage",value:function(e){var t;return this.throwIfDisposed(),this.createSubDirectoryCore(e.subdirName,!0,-1,null!==(t=this.runtime.clientId)&&void 0!==t?t:"detached"),{type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e)}}},{key:"processDeleteSubDirectoryMessage",value:function(e,t,r,n){this.throwIfDisposed(),this.isMessageForCurrentInstanceOfSubDirectory(e)&&this.needProcessSubDirectoryOperation(e,t,r,n)&&this.deleteSubDirectoryCore(t.subdirName,r)}},{key:"applyStashedDeleteSubDirMessage",value:function(e){this.throwIfDisposed();var t=this.deleteSubDirectoryCore(e.subdirName,!0);return{type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t}}},{key:"submitClearMessage",value:function(e,t){this.throwIfDisposed();var r=++this.pendingMessageId;this.pendingClearMessageIds.push(r);var n={type:"clear",pendingMessageId:r,previousStorage:t};this.directory.submitDirectoryMessage(e,n)}},{key:"resubmitClearMessage",value:function(e,t){(0,B.h)(Zt(t),811);var r=this.pendingClearMessageIds.shift();(0,B.h)(r===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}},{key:"getKeyMessageId",value:function(e){var t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return void 0!==r?r.push(t):this.pendingKeys.set(e.key,[t]),t}},{key:"submitKeyMessage",value:function(e,t){this.throwIfDisposed();var r={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,r)}},{key:"resubmitKeyMessage",value:function(e,t){(0,B.h)(wt(t),813);var r=this.pendingKeys.get(e.key);(0,B.h)(void 0!==r&&r[0]===t.pendingMessageId,814),r.shift(),0===r.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}},{key:"getSubDirMessageId",value:function(e){var t,r=++this.pendingMessageId,n=this.pendingSubDirectories.get(e.subdirName);if(void 0!==n?n.push(r):this.pendingSubDirectories.set(e.subdirName,[r]),"deleteSubDirectory"===e.type){var i=null!==(t=this.pendingDeleteSubDirectoriesCount.get(e.subdirName))&&void 0!==t?t:0;this.pendingDeleteSubDirectoriesCount.set(e.subdirName,i+1)}return r}},{key:"submitCreateSubDirectoryMessage",value:function(e){this.throwIfDisposed();var t={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e)};this.directory.submitDirectoryMessage(e,t)}},{key:"submitDeleteSubDirectoryMessage",value:function(e,t){this.throwIfDisposed();var r={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,r)}},{key:"resubmitSubDirectoryMessage",value:function(e,t){(0,B.h)(xt(t),815);var r=this.pendingSubDirectories.get(e.subdirName);(0,B.h)(void 0!==r&&r[0]===t.pendingMessageId,816),r.shift(),0===r.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}},{key:"getSerializedStorage",value:(0,a.Z)().mark((function e(t){var r,n,i,o,s,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.throwIfDisposed(),r=(0,R.Z)(this._storage),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=12;break}return i=(0,F.Z)(n.value,2),o=i[0],s=i[1],u=s.makeSerialized(t,this.directory.handle),c=[o,u],e.next=10,c;case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,this,[[2,14,17,20]])}))},{key:"getSerializableCreateInfo",value:function(){return this.throwIfDisposed(),{csn:this.sequenceNumber,ccIds:Array.from(this.clientIds)}}},{key:"populateStorage",value:function(e,t){this.throwIfDisposed(),this._storage.set(e,t)}},{key:"populateSubDirectory",value:function(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}},{key:"getLocalValue",value:function(e){return this.throwIfDisposed(),this._storage.get(e)}},{key:"rollbackPendingMessageId",value:function(e,t,r){var n=e.get(t),i=null===n||void 0===n?void 0:n.pop();if(!n||i!==r)throw new Error("Rollback op does not match last pending");0===n.length&&e.delete(t)}},{key:"rollback",value:function(e,t){if(void 0===(r=t)||"number"!==typeof r.pendingMessageId||"edit"!==r.type&&"deleteSubDir"!==r.type&&("clear"!==r.type||"object"!==typeof r.previousStorage)&&"createSubDir"!==r.type)throw new Error("Invalid localOpMetadata");var r;if("clear"===e.type&&"clear"===t.type){var n,i=(0,R.Z)(t.previousStorage.entries());try{for(i.s();!(n=i.n()).done;){var a=(0,F.Z)(n.value,2),o=a[0],s=a[1];this.setCore(o,s,!0)}}catch(l){i.e(l)}finally{i.f()}var u=this.pendingClearMessageIds.pop();if(void 0===u||u!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);var c=this.pendingDeleteSubDirectoriesCount.get(e.subdirName);(0,B.h)(void 0!==c&&c>0,1451),this.pendingDeleteSubDirectoriesCount.set(e.subdirName,c-1),1===c&&this.pendingDeleteSubDirectoriesCount.delete(e.subdirName)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}},{key:"makeAbsolute",value:function(e){return mt.resolve(this.absolutePath,e)}},{key:"needProcessStorageOperation",value:function(e,t,r){if(this.pendingClearMessageIds.length>0){if(t){(0,B.h)(void 0!==r&&wt(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],16);var n=this.pendingClearMessageIds[0],i=this.pendingKeys.get(e.key);if(void 0!==i){for(var a=0;i[a]<n;)a+=1;var o=i.splice(a);0===o.length?this.pendingKeys.delete(e.key):this.pendingKeys.set(e.key,o)}}return!1}if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,B.h)(void 0!==r&&wt(r),17);var s=this.pendingKeys.get(e.key);(0,B.h)(void 0!==s&&s[0]===r.pendingMessageId,817),s.shift(),0===s.length&&this.pendingKeys.delete(e.key)}return!1}return!t}},{key:"isMessageForCurrentInstanceOfSubDirectory",value:function(e){return null!==e.clientId&&this.clientIds.has(e.clientId)||this.clientIds.has("detached")||-1!==this.sequenceNumber&&this.sequenceNumber<=e.referenceSequenceNumber}},{key:"needProcessSubDirectoryOperation",value:function(e,t,r,n){var i=this.pendingSubDirectories.get(t.subdirName);if(It(e.clientId),void 0!==i){if(r){(0,B.h)(xt(n),18);var a=this.pendingSubDirectories.get(t.subdirName);if((0,B.h)(void 0!==a&&a[0]===n.pendingMessageId,818),a.shift(),0===a.length&&this.pendingSubDirectories.delete(t.subdirName),"deleteSubDirectory"===t.type){var o=this.pendingDeleteSubDirectoriesCount.get(t.subdirName);(0,B.h)(void 0!==o&&o>0,1452),this.pendingDeleteSubDirectoriesCount.set(t.subdirName,o-1),1===o&&this.pendingDeleteSubDirectoriesCount.delete(t.subdirName)}}else if("deleteSubDirectory"===t.type){var s=this._subdirectories.get(t.subdirName);s&&(s.clearExceptPendingKeys(r),s.sequenceNumber=-1,s.clientIds.clear())}if("createSubDirectory"===t.type){var u=this._subdirectories.get(t.subdirName);-1===(null===u||void 0===u?void 0:u.sequenceNumber)&&(u.sequenceNumber=e.sequenceNumber),void 0!==u&&!u.clientIds.has(e.clientId)&&u.sequenceNumber<=e.sequenceNumber&&u.clientIds.add(e.clientId)}return!1}return!r}},{key:"clearExceptPendingKeys",value:function(e){var t,r=new Map,n=(0,R.Z)(this.pendingKeys);try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,1)[0],a=this._storage.get(i);void 0!==a&&r.set(i,a)}}catch(h){n.e(h)}finally{n.f()}this.clearCore(e);var o,s=(0,R.Z)(r.entries());try{for(s.s();!(o=s.n()).done;){var u=(0,F.Z)(o.value,2),c=u[0],l=u[1];this.setCore(c,l,!0)}}catch(h){s.e(h)}finally{s.f()}}},{key:"clearCore",value:function(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}},{key:"deleteCore",value:function(e,t){var r=this._storage.get(e),n=null===r||void 0===r?void 0:r.value;if(this._storage.delete(e)){var i={key:e,path:this.absolutePath,previousValue:n};this.directory.emit("valueChanged",i,t,this.directory);var a={key:e,previousValue:n};this.emit("containedValueChanged",a,t,this)}return r}},{key:"setCore",value:function(e,t,r){var n=this._storage.get(e),i=null===n||void 0===n?void 0:n.value;this._storage.set(e,t);var a={key:e,path:this.absolutePath,previousValue:i};this.directory.emit("valueChanged",a,r,this.directory);var o={key:e,previousValue:i};return this.emit("containedValueChanged",o,r,this),n}},{key:"createSubDirectoryCore",value:function(e,t,r,n){var i=this._subdirectories.get(e);if(void 0===i){var a=mt.join(this.absolutePath,e),s=new o(r,new Set([n]),this.directory,this.runtime,this.serializer,a);return this.registerEventsOnSubDirectory(s,e),this._subdirectories.set(e,s),this.emit("subDirectoryCreated",e,t,this),!0}return i.clientIds.add(n),!1}},{key:"registerEventsOnSubDirectory",value:function(e,t){var r=this;e.on("subDirectoryCreated",(function(e,n){r.emit("subDirectoryCreated",mt.join(t,e),n,r)})),e.on("subDirectoryDeleted",(function(e,n){r.emit("subDirectoryDeleted",mt.join(t,e),n,r)}))}},{key:"deleteSubDirectoryCore",value:function(e,t){var r=this._subdirectories.get(e);return void 0!==r&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(r),this.emit("subDirectoryDeleted",e,t,this)),r}},{key:"disposeSubDirectoryTree",value:function(e){if(e){var t,r=e.subdirectories(),n=(0,R.Z)(r);try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=(i[0],i[1]);this.disposeSubDirectoryTree(a)}}catch(o){n.e(o)}finally{n.f()}"function"===typeof e.dispose&&e.dispose()}}},{key:"undeleteSubDirectoryTree",value:function(e){var t,r=(0,R.Z)(this._subdirectories.entries());try{for(r.s();!(t=r.n()).done;){var n=(0,F.Z)(t.value,2),i=(n[0],n[1]);this.undeleteSubDirectoryTree(i)}}catch(a){r.e(a)}finally{r.f()}e.undispose()}}]),o}(L.L,(pt=Symbol.toStringTag,Symbol.iterator));function Pt(e){return void 0!==e&&"number"===typeof e.pendingMessageId&&("add"===e.type||"edit"===e.type)}function Ot(e){return void 0!==e&&"clear"===e.type&&"number"===typeof e.pendingMessageId}function Dt(e,t,r){return{type:"clear",pendingMessageId:t,previousMap:r}}function Nt(e,t,r){return r?{type:"edit",pendingMessageId:t,previousValue:r}:{type:"add",pendingMessageId:t}}var Mt,jt=function(e){function t(e,r,i,a,o){(0,n.Z)(this,t),this.serializer=e,this.handle=r,this.submitMessage=i,this.isAttached=a,this.eventEmitter=o,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new gt(e),this.messageHandlers=this.getMessageHandlers()}return(0,i.Z)(t,[{key:"size",get:function(){return this.data.size}},{key:"keys",value:function(){return this.data.keys()}},{key:"entries",value:function(){var e=this.data.entries();return(0,E.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}}},Symbol.iterator,(function(){return this}))}},{key:"values",value:function(){var e=this.data.values();return(0,E.Z)({next:function(){var t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}}},Symbol.iterator,(function(){return this}))}},{key:e,value:function(){return this.entries()}},{key:"forEach",value:function(e){this.data.forEach((function(t,r,n){e(t.value,r,n)}))}},{key:"get",value:function(e){var t=this.data.get(e);return void 0===t?void 0:t.value}},{key:"has",value:function(e){return this.data.has(e)}},{key:"set",value:function(e,t){if(void 0===e||null===e)throw new Error("Undefined and null keys are not supported");var r=this.localValueMaker.fromInMemory(t),n=ft(r,this.serializer,this.handle),i=this.setCore(e,r,!0);if(this.isAttached()){var a={key:e,type:"set",value:n};this.submitMapKeyMessage(a,i)}}},{key:"delete",value:function(e){var t=this.deleteCore(e,!0);if(!this.isAttached())return void 0!==t;var r={key:e,type:"delete"};return this.submitMapKeyMessage(r,t),void 0!==t}},{key:"clear",value:function(){var e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),this.isAttached()){this.submitMapClearMessage({type:"clear"},e)}}},{key:"getSerializedStorage",value:function(e){var t,r={},n=(0,R.Z)(this.data.entries());try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=i[0],o=i[1];r[a]=o.makeSerialized(e,this.handle)}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"getSerializableStorage",value:function(e){var t,r={},n=(0,R.Z)(this.data.entries());try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=i[0],o=i[1];r[a]=ft(o,e,this.handle)}}catch(s){n.e(s)}finally{n.f()}return r}},{key:"serialize",value:function(e){return JSON.stringify(this.getSerializableStorage(e))}},{key:"populateFromSerializable",value:function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=(0,F.Z)(r[t],2),i=n[0],a=n[1],o={key:i,value:this.makeLocal(i,a)};this.data.set(o.key,o.value)}}},{key:"populate",value:function(e){this.populateFromSerializable(JSON.parse(e))}},{key:"trySubmitMessage",value:function(e,t){var r=this.messageHandlers.get(e.type);return void 0!==r&&(r.submit(e,t),!0)}},{key:"tryApplyStashedOp",value:function(e){var t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.applyStashedOp(e)}},{key:"tryProcessMessage",value:function(e,t,r){var n=this.messageHandlers.get(e.type);return void 0!==n&&(n.process(e,t,r),!0)}},{key:"rollback",value:function(e,t){if(void 0===(r=t)||"number"!==typeof r.pendingMessageId||"add"!==r.type&&"edit"!==r.type&&"clear"!==r.type)throw new Error("Invalid localOpMetadata");var r;if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");var n,i=(0,R.Z)(t.previousMap.entries());try{for(i.s();!(n=i.n()).done;){var a=(0,F.Z)(n.value,2),o=a[0],s=a[1];this.setCore(o,s,!0)}}catch(h){i.e(h)}finally{i.f()}var u=this.pendingClearMessageIds.pop();if(void 0===u||u!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}var c=this.pendingKeys.get(e.key),l=null===c||void 0===c?void 0:c.pop();if(!c||l!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===c.length&&this.pendingKeys.delete(e.key)}}},{key:"setCore",value:function(e,t,r){var n=this.data.get(e),i=null===n||void 0===n?void 0:n.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:i},r,this.eventEmitter),n}},{key:"clearCore",value:function(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}},{key:"deleteCore",value:function(e,t){var r=this.data.get(e),n=null===r||void 0===r?void 0:r.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:n},t,this.eventEmitter),r}},{key:"clearExceptPendingKeys",value:function(){var e,t=new Map,r=(0,R.Z)(this.pendingKeys.keys());try{for(r.s();!(e=r.n()).done;){var n=e.value;t.set(n,this.data.get(n))}}catch(c){r.e(c)}finally{r.f()}this.clearCore(!1);var i,a=(0,R.Z)(t.entries());try{for(a.s();!(i=a.n()).done;){var o=(0,F.Z)(i.value,2),s=o[0],u=o[1];this.setCore(s,u,!0)}}catch(c){a.e(c)}finally{a.f()}}},{key:"makeLocal",value:function(e,t){if(t.type===$[$.Plain]||t.type===$[$.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}},{key:"needProcessKeyOperation",value:function(e,t,r){if(this.pendingClearMessageIds.length>0)return t&&(0,B.h)(void 0!==r&&Pt(r)&&r.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){(0,B.h)(void 0!==r&&Pt(r),20);var n=this.pendingKeys.get(e.key);(0,B.h)(void 0!==n&&n[0]===r.pendingMessageId,762),n.shift(),0===n.length&&this.pendingKeys.delete(e.key)}return!1}return!t}},{key:"getMessageHandlers",value:function(){var e=this,t=new Map;return t.set("clear",{process:function(t,r,n){if(r){(0,B.h)(Ot(n),21);var i=e.pendingClearMessageIds.shift();(0,B.h)(i===n.pendingMessageId,763)}else e.pendingKeys.size>0?e.clearExceptPendingKeys():e.clearCore(r)},submit:function(t,r){(0,B.h)(Ot(r),764);var n=e.pendingClearMessageIds.shift();(0,B.h)(n===r.pendingMessageId,765),e.submitMapClearMessage(t,r.previousMap)},applyStashedOp:function(t){var r=new Map(e.data);return e.clearCore(!0),Dt(0,e.getMapClearMessageId(),r)}}),t.set("delete",{process:function(t,r,n){e.needProcessKeyOperation(t,r,n)&&e.deleteCore(t.key,r)},submit:function(t,r){e.resubmitMapKeyMessage(t,r)},applyStashedOp:function(t){var r=e.deleteCore(t.key,!0);return Nt(0,e.getMapKeyMessageId(t),r)}}),t.set("set",{process:function(t,r,n){if(e.needProcessKeyOperation(t,r,n)){var i=e.makeLocal(t.key,t.value);e.setCore(t.key,i,r)}},submit:function(t,r){e.resubmitMapKeyMessage(t,r)},applyStashedOp:function(t){var r=e.makeLocal(t.key,t.value),n=e.setCore(t.key,r,!0);return Nt(0,e.getMapKeyMessageId(t),n)}}),t}},{key:"getMapClearMessageId",value:function(){var e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}},{key:"submitMapClearMessage",value:function(e,t){var r=Dt(0,this.getMapClearMessageId(),t);this.submitMessage(e,r)}},{key:"getMapKeyMessageId",value:function(e){var t=++this.pendingMessageId,r=this.pendingKeys.get(e.key);return void 0!==r?r.push(t):this.pendingKeys.set(e.key,[t]),t}},{key:"submitMapKeyMessage",value:function(e,t){var r=Nt(0,this.getMapKeyMessageId(e),t);this.submitMessage(e,r)}},{key:"resubmitMapKeyMessage",value:function(e,t){(0,B.h)(Pt(t),766);var r=this.pendingKeys.get(e.key);(0,B.h)(void 0!==r&&r[0]===t.pendingMessageId,767),r.shift(),0===r.length&&this.pendingKeys.delete(e.key);var n=this.getMapKeyMessageId(e),i="edit"===t.type?{type:"edit",pendingMessageId:n,previousValue:t.previousValue}:{type:"add",pendingMessageId:n};this.submitMessage(e,i)}}]),t}(Symbol.iterator),_t="header",At=function(){function e(){(0,n.Z)(this,e)}return(0,i.Z)(e,[{key:"type",get:function(){return e.Type}},{key:"attributes",get:function(){return e.Attributes}},{key:"load",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){var o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new Et(r,t,i),e.next=3,o.load(n);case 3:return e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"create",value:function(t,r){var n=new Et(r,t,e.Attributes);return n.initializeLocal(),n}}]),e}();At.Type="https://graph.microsoft.com/types/map",At.Attributes={type:At.Type,snapshotFormatVersion:"0.2",packageVersion:bt};var Et=function(e,t){(0,_.Z)(s,e);var r=(0,A.Z)(s);function s(e,t,i){var a;return(0,n.Z)(this,s),(a=r.call(this,e,t,i,"fluid_map_"))[Mt]="SharedMap",a.kernel=new jt(a.serializer,a.handle,(function(e,t){return a.submitLocalMessage(e,t)}),(function(){return a.isAttached()}),(0,z.Z)(a)),a}return(0,i.Z)(s,[{key:"keys",value:function(){return this.kernel.keys()}},{key:"entries",value:function(){return this.kernel.entries()}},{key:"values",value:function(){return this.kernel.values()}},{key:t,value:function(){return this.kernel.entries()}},{key:"size",get:function(){return this.kernel.size}},{key:"forEach",value:function(e){this.kernel.forEach(e)}},{key:"get",value:function(e){return this.kernel.get(e)}},{key:"has",value:function(e){return this.kernel.has(e)}},{key:"set",value:function(e,t){return this.kernel.set(e,t),this}},{key:"delete",value:function(e){return this.kernel.delete(e)}},{key:"clear",value:function(){this.kernel.clear()}},{key:"summarizeCore",value:function(e,t){for(var r=0,n=0,i={},a=[],o=new ht,s=this.kernel.getSerializedStorage(e),u=0,c=Object.keys(s);u<c.length;u++){var l=c[u],h=s[l];if(h.value&&h.value.length>=8192){var d="blob".concat(n);n++,a.push(d);var f=(0,E.Z)({},l,{type:h.type,value:JSON.parse(h.value)});o.addBlob(d,JSON.stringify(f))}else{if(r+=h.type.length+21,h.value&&(r+=h.value.length),r>16384){var v="blob".concat(n);n++,a.push(v),o.addBlob(v,JSON.stringify(i)),i={},r=0}i[l]={type:h.type,value:void 0===h.value?void 0:JSON.parse(h.value)}}}var p={blobs:a,content:i};return o.addBlob(_t,JSON.stringify(p)),o.getSummaryTree()}},{key:"loadCore",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(t,_t);case 2:if(r=e.sent,n=r,!Array.isArray(n.blobs)){e.next=10;break}return this.kernel.populateFromSerializable(n.content),e.next=8,Promise.all(n.blobs.map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(r){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,X(t,r);case 2:n=e.sent,i.kernel.populateFromSerializable(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:e.next=11;break;case 10:this.kernel.populateFromSerializable(r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDisconnect",value:function(){}},{key:"reSubmitCore",value:function(e,t){this.kernel.trySubmitMessage(e,t)}},{key:"applyStashedOp",value:function(e){return this.kernel.tryApplyStashedOp(e)}},{key:"processCore",value:function(e,t,r){e.type===ee.Cs.Operation&&this.kernel.tryProcessMessage(e.contents,t,r)}},{key:"rollback",value:function(e,t){this.kernel.rollback(e,t)}}],[{key:"create",value:function(e,t){return e.createChannel(t,At.Type)}},{key:"getFactory",value:function(){return new At}}]),s}(st,(Mt=Symbol.toStringTag,Symbol.iterator)),Ft=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)&&"function"===typeof(null===e||void 0===e?void 0:e.addTelemetryProperties)},Rt=function(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorInstanceId)};function zt(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorType)&&"string"===typeof(null===e||void 0===e?void 0:e.message)&&Ft(e)}var Bt=function(e){return null!==e&&!Array.isArray(e)&&"object"===typeof e};function Lt(e,t){var r={message:"string"===typeof(null===e||void 0===e?void 0:e.message)?e.message:String(e)};if(Bt(e)){var n=e.errorType,i=e.stack,a=e.name;if("string"===typeof n&&(r.errorType=n),"string"===typeof i){var o="string"===typeof a?a:void 0;r.stack=function(e,r){if(!t)return e;var n=e.split("\n");return n.shift(),void 0!==r&&n.unshift(r),n.join("\n")}(i,o)}}return r}var Vt,qt=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)};function Ht(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(zt(e)&&function(e){var t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,H.Z)())}(e),"string"===typeof(null===(r=e)||void 0===r?void 0:r.errorType)&&"string"===typeof(null===r||void 0===r?void 0:r.message)&&Rt(r)&&Ft(r))return e.addTelemetryProperties(null!==(t=n.props)&&void 0!==t?t:{}),e;var i=Lt(e,!1),a=i.message,o=i.stack,s=new rr({message:a,stack:o});if("object"===typeof e&&null!==e){var u=e.canRetry,c=e.retryAfterSeconds;Object.assign(Ht,{canRetry:u,retryAfterSeconds:c})}"object"!==typeof e&&s.addTelemetryProperties({typeofError:typeof e});var l=er.typeCheck(e)?e.getTelemetryProperties():{untrustedOrigin:1};return s.addTelemetryProperties(Object.assign(Object.assign({},l),n.props)),s}function Gt(){var e=new Error("<<generated stack>>");if(void 0===Vt&&(Vt=void 0!==e.stack),Vt)return e;try{throw e}catch(t){return t}}function Kt(){return Gt().stack}function Ut(e,t){var r=Lt(e,!1),n=r.message,i=r.stack,a=t(n);return void 0!==i&&Jt(a,i),Wt(e)&&a.addTelemetryProperties({untrustedOrigin:1}),Rt(e)&&(a.overwriteErrorInstanceId(e.errorInstanceId),a.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),qt(e)&&a.addTelemetryProperties(e.getTelemetryProperties()),a}function Jt(e,t){try{Object.assign(e,{stack:t})}catch(r){e.addTelemetryProperties({stack2:t})}}function Wt(e){return er.typeCheck(e)?e.errorType===tr&&1===e.getTelemetryProperties().untrustedOrigin:!zt(e)}function Qt(e){var t;return"string"===typeof(null===(t=e)||void 0===t?void 0:t.tag)}function Xt(e,t){return Array.isArray(e)&&e.every((function(e){return Yt(e)}))?JSON.stringify(e):Yt(e)?e:(console.error("UnSupported Format of Logging Error Property for key ".concat(t,":"),e),"REDACTED (arbitrary object)")}function Yt(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}var $t,er=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;return(0,n.Z)(this,r),(a=t.call(this,e)).omitPropsFromLogging=o,a._errorInstanceId=(0,H.Z)(),a.fluidErrorCode="-",o.add("omitPropsFromLogging"),o.add("_errorInstanceId"),i&&a.addTelemetryProperties(i),a}return(0,i.Z)(r,[{key:"errorInstanceId",get:function(){return this._errorInstanceId}},{key:"overwriteErrorInstanceId",value:function(e){this._errorInstanceId=e}},{key:"addTelemetryProperties",value:function(e){!function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];void 0===e[i]&&(e[i]=t[i])}}(this,e)}},{key:"getTelemetryProperties",value:function(){var e=function(e,t){for(var r={},n=0,i=Object.keys(e);n<i.length;n++){var a=i[n];if(!t.has(a)){var o=e[a];Qt(o)?r[a]={value:Xt(o.value,a),tag:o.tag}:r[a]=Xt(o,a)}}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}],[{key:"typeCheck",value:function(e){return"object"===typeof e&&null!==e&&("function"===typeof e.addTelemetryProperties&&"function"===typeof e.getTelemetryProperties&&"string"===typeof e.errorInstanceId)}}]),r}((0,q.Z)(Error)),tr="genericError",rr=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e.message)).errorType=tr,void 0!==e.stack&&Jt((0,z.Z)(i),e.stack),i}return(0,i.Z)(r)}(er),nr=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a;return(0,n.Z)(this,r),(a=t.call(this,e,Object.assign(Object.assign({},i),{usageError:!0}))).errorType=V.u.usageError,a}return(0,i.Z)(r)}(er),ir=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a;return(0,n.Z)(this,r),(a=t.call(this,e,Object.assign(Object.assign({},i),{dataProcessingError:1}))).errorType=V.u.dataCorruptionError,a.canRetry=!1,a}return(0,i.Z)(r)}(er),ar=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).errorType=V.u.dataProcessingError,i.canRetry=!1,i}return(0,i.Z)(r,null,[{key:"create",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.wrapIfUnrecognized(e,t,n);return a.addTelemetryProperties(i),a}},{key:"wrapIfUnrecognized",value:function(e,t,n){var i=Ht(e,{props:Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===n?void 0:or(n))});if(Wt(i)||i.errorType===tr){var a=Ut(i,(function(e){return new r(e)}));return a.addTelemetryProperties(i.getTelemetryProperties()),a}return i}}]),r}(er),or=function(e){return{messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp}},sr=r(69163),ur=r(89591),cr=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};!function(e){e.CodeArtifact="CodeArtifact",e.UserData="UserData"}($t||($t={}));var lr=function(){function e(t,r){(0,n.Z)(this,e),this.namespace=t,this.properties=r}return(0,i.Z)(e,[{key:"sendTelemetryEvent",value:function(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}},{key:"sendTelemetryEventCore",value:function(t,r){var n=function(e){for(var t=e.category,r=e.eventName,n=cr(e,["category","eventName"]),i={category:t,eventName:r},a=0,o=Object.keys(n);a<o.length;a++){var s=o[a];i[s]=fr(n[s])}return i}(t);void 0!==r&&e.prepareErrorObject(n,r,!1),"number"===typeof n.duration&&(n.duration=e.formatTick(n.duration)),this.send(n)}},{key:"sendErrorEvent",value:function(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}},{key:"sendPerformanceEvent",value:function(e,t){var r,n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}},{key:"prepareEvent",value:function(t){var r="error"===t.category||void 0!==t.error,n=Object.assign({},t);if(void 0!==this.namespace&&(n.eventName="".concat(this.namespace).concat(e.eventNamespaceSeparator).concat(n.eventName)),this.properties){var i=[];i.push(this.properties.all),r&&i.push(this.properties.error);for(var a=0,o=i;a<o.length;a++){var s=o[a];if(void 0!==s)for(var u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];if(void 0===t[l]){var h=s[l],d="function"===typeof h?h():h;void 0!==d&&(n[l]=d)}}}}return n}}],[{key:"formatTick",value:function(e){return Math.floor(e)}},{key:"numberFromString",value:function(e){if(void 0!==e&&null!==e){var t=Number(e);return Number.isNaN(t)?e:t}}},{key:"sanitizePkgName",value:function(e){return e.replace("@","").replace("/","-")}},{key:"prepareErrorObject",value:function(e,t,r){var n=Lt(t,!0),i=n.message,a=n.errorType,o=n.stack;if(e.stack=o,e.error=i,e.errorType=a,qt(t))for(var s=t.getTelemetryProperties(),u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];void 0===e[l]&&(e[l]=s[l])}void 0===e.stack&&r&&(e.stack=Kt())}}]),e}();lr.eventNamespaceSeparator=":";var hr=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a){var o;return(0,n.Z)(this,r),(o=t.call(this,i,a)).baseLogger=e,Sr(e)&&wr((0,z.Z)(o),new Cr((0,z.Z)(o),e.config)),o}return(0,i.Z)(r,[{key:"send",value:function(e){this.baseLogger.send(this.prepareEvent(e))}}],[{key:"create",value:function(e,t,n){if(e instanceof r){for(var i={},a=0,o=[e.properties,n];a<o.length;a++){var s=o[a];void 0!==s&&(void 0!==s.all&&(i.all=Object.assign(Object.assign({},i.all),s.all)),void 0!==s.error&&(i.error=Object.assign(Object.assign({},i.error),s.error)))}var u=void 0===e.namespace?t:void 0===t?e.namespace:"".concat(e.namespace).concat(lr.eventNamespaceSeparator).concat(t);return new r(e.baseLogger,u,i)}return new r(e||new dr,t,n)}}]),r}(lr),dr=function(){function e(){(0,n.Z)(this,e)}return(0,i.Z)(e,[{key:"send",value:function(e){}}]),e}();function fr(e){return Qt(e)?{value:vr(e.value),tag:e.tag}:vr(e)}function vr(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"object":return JSON.stringify(e);default:return console.error("convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ".concat(typeof e,")")),"INVALID PROPERTY (typed as ".concat(typeof e,")")}}var pr=new oe.o((function(){return gr(kr())})),yr={getRawConfig:function(){}},gr=function(e){return void 0!==e&&null!==e?new Cr(void 0,{getRawConfig:function(t){var r,n;try{return null===(n=mr(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(i){}}}):yr};function br(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function mr(e){var t,r=e;if("string"===typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(vt){}if(void 0===r)return t;var n=typeof r;if(br(n))return Object.assign(Object.assign({},t),(0,E.Z)({raw:e},n,r));if(Array.isArray(r)){var i=typeof r[0];if(!br(i))return t;var a,o=(0,R.Z)(r);try{for(o.s();!(a=o.n()).done;){if(typeof a.value!==i)return t}}catch(s){o.e(s)}finally{o.f()}return Object.assign(Object.assign({},t),(0,E.Z)({raw:e},"".concat(i,"[]"),r))}return t}var kr=function(){var e;try{return null!==(e=globalThis.sessionStorage)&&void 0!==e?e:void 0}catch(pt){return}},Cr=function(){function e(t){(0,n.Z)(this,e),this.logger=t,this.configCache=new Map,this.orderedBaseProviders=[];for(var r=new Set,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];for(var s=[].concat(a);s.length>0;){var u=s.shift();void 0!==u&&Zr(u)&&!r.has(u)&&(r.add(u),u instanceof e?s.push.apply(s,(0,p.Z)(u.orderedBaseProviders)):this.orderedBaseProviders.push(u))}}return(0,i.Z)(e,[{key:"getBoolean",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}},{key:"getNumber",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}},{key:"getString",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}},{key:"getBooleanArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}},{key:"getNumberArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}},{key:"getStringArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}},{key:"getRawConfig",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}},{key:"getCacheEntry",value:function(e){var t;if(!this.configCache.has(e)){var r,n=(0,R.Z)(this.orderedBaseProviders);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=mr(null===i||void 0===i?void 0:i.getRawConfig(e));if(void 0!==a)return this.configCache.set(e,a),null===(t=this.logger)||void 0===t||t.send({category:"generic",eventName:"ConfigRead",configName:{tag:$t.CodeArtifact,value:e},configValue:{tag:$t.CodeArtifact,value:JSON.stringify(a)}}),a}}catch(o){n.e(o)}finally{n.f()}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}]),e}();function Sr(e){var t=e;return Zr(null===t||void 0===t?void 0:t.config)&&void 0!==(null===t||void 0===t?void 0:t.logger)}function wr(e){if(Sr(e))throw new Error("Logger is already a monitoring context");for(var t=e,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return t.config=(0,ae.Z)(Cr,[e].concat(n)),t.logger=e,t}function Zr(e){return"function"===typeof(null===e||void 0===e?void 0:e.getRawConfig)}var xr=r(74847),Ir=r(24908);function Tr(e,t,r){var n,i=[],a=(0,R.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s="".concat(e).concat(o.path);if(o.type===xr.S.Blob){var u=o.value,c=(0,Q.k8)(u.contents,u.encoding),l=(0,H.Z)();r.set(l,c);var h={mode:xr.m[o.mode],path:s,sha:l,size:0,type:"blob",url:""};i.push(h)}else if(o.type===xr.S.Tree){(0,B.h)(o.type===xr.S.Tree,257);var d=o.value,f={mode:xr.m[o.mode],path:s,sha:"",size:-1,type:"tree",url:""};i.push(f);var v=Tr("".concat(s,"/"),d.entries,r);i.push.apply(i,(0,p.Z)(v))}}}catch(y){a.e(y)}finally{a.f()}return i}function Pr(e,t){return{sha:"",tree:Tr("",e,t),url:""}}var Or=r(49103);function Dr(e,t){if(""===e)return void 0===t?"":t.absolutePath;var r=e.startsWith("/")?e.slice(1):e;return r=r.endsWith("/")?r.slice(0,-1):r,void 0===t?"/".concat(r):"".concat("/"===t.absolutePath?"":t.absolutePath,"/").concat(r)}var Nr=function(){function e(t){(0,n.Z)(this,e),this.request=t;var r=this.request.url.indexOf("?");this.query=r>=0?this.request.url.substring(r):""}return(0,i.Z)(e,[{key:"url",get:function(){return this.request.url}},{key:"headers",get:function(){return this.request.headers}},{key:"pathParts",get:function(){return void 0===this.requestPathParts&&(this.requestPathParts=e.getPathParts(this.url)),this.requestPathParts}},{key:"isLeaf",value:function(e){return""===this.query&&this.pathParts.length===e}},{key:"createSubRequest",value:function(e){var t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:"/".concat(this.query),headers:this.headers};var r="/".concat(this.pathParts.slice(e).join("/"));return{url:""===this.query?r:"".concat(r,"/").concat(this.query),headers:this.headers}}}],[{key:"getPathParts",value:function(e){var t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((function(e,t){return void 0!==t&&t.length>0&&e.push(decodeURIComponent(t)),e}),[])}},{key:"create",value:function(t){return t instanceof e?t:new e(t)}}]),e}();function Mr(e){if(null!==e&&"object"===typeof e&&!0===e.errorFromRequestFluidObject){var t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack},headers:t.underlyingResponseHeaders}}var r=Gt();return{mimeType:"text/plain",status:500,value:"".concat(e),get stack(){var t;return null!==(t=null===e||void 0===e?void 0:e.stack)&&void 0!==t?t:r.stack}}}function jr(e,t){var r=e.value,n=Gt(),i={errorFromRequestFluidObject:!0,message:r,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:n.stack},underlyingResponseHeaders:e.headers};return i}function _r(e,t){return Ar.apply(this,arguments)}function Ar(){return(Ar=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"===typeof r?{url:r}:r,e.next=3,t.request(n);case 3:if(200===(i=e.sent).status&&"fluid/object"===i.mimeType){e.next=6;break}throw jr(i);case 6:return(0,B.h)(i.value,410),e.abrupt("return",i.value);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Er=function(e){return Fr(404,"not found",e)};function Fr(e,t,r,n){var i;(0,B.h)(200!==e,411);var a=null===(i=r.url)||void 0===i?void 0:i.split("?")[0],o=Gt();return{mimeType:"text/plain",status:e,value:void 0===a?t:"".concat(t,": ").concat(a),get stack(){return o.stack},headers:n}}var Rr=r(29930);function zr(){for(var e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0,a=r;i<a.length;i++){var o=a[i];e.treeNodeCount+=o.treeNodeCount,e.blobNodeCount+=o.blobNodeCount,e.handleNodeCount+=o.handleNodeCount,e.totalBlobSize+=o.totalBlobSize,e.unreferencedBlobSize+=o.unreferencedBlobSize}return e}function Br(e){return"string"===typeof e?function(e){for(var t=e.length,r=e.length-1;r>=0;r--){var n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t}(e):e.byteLength}function Lr(e,t,r){var n={type:ut.J.Blob,content:r};e.summary.tree[t]=n,e.stats.blobNodeCount++,e.stats.totalBlobSize+=Br(r)}var Vr=function(){function e(){(0,n.Z)(this,e),this.attachmentCounter=0,this.summaryTree={},this.summaryStats=zr(),this.summaryStats.treeNodeCount++}return(0,i.Z)(e,[{key:"summary",get:function(){return{type:ut.J.Tree,tree:Object.assign({},this.summaryTree)}}},{key:"stats",get:function(){return Object.assign({},this.summaryStats)}},{key:"addBlob",value:function(e,t){Lr({summary:{type:ut.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}},{key:"addHandle",value:function(e,t,r){this.summaryTree[e]={type:ut.J.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}},{key:"addWithStats",value:function(e,t){this.summaryTree[e]=t.summary,this.summaryStats=zr(this.summaryStats,t.stats)}},{key:"addAttachment",value:function(e){this.summaryTree[this.attachmentCounter++]={id:e,type:ut.J.Attachment}}},{key:"getSummaryTree",value:function(){return{summary:this.summary,stats:this.stats}}}]),e}();function qr(e){for(var t=new Vr,r=0,n=Object.entries(e.blobs);r<n.length;r++){var i=(0,F.Z)(n[r],2),a=i[0],o=i[1],s=void 0;if(void 0!==e.blobsContents){var u=e.blobsContents[o];void 0!==u&&(s=(0,Q.zT)(u,"utf-8"))}else void 0!==e.blobs[o]&&(s=(0,Rr.fW)(e.blobs[o]));void 0!==s&&t.addBlob(a,s)}for(var c=0,l=Object.entries(e.trees);c<l.length;c++){var h=(0,F.Z)(l[c],2),d=h[0],f=qr(h[1]);t.addWithStats(d,f)}var v=t.getSummaryTree();return v.summary.unreferenced=e.unreferenced,v}function Hr(e){for(var t=[],r=0,n=Object.entries(e.tree);r<n.length;r++){var i=(0,F.Z)(n[r],2),a=i[0],o=i[1];switch(o.type){case ut.J.Blob:var s=void 0,u="utf-8";"string"===typeof o.content?s=o.content:(s=(0,Q.IN)(o.content,"base64"),u="base64"),t.push(new Ir.Qp(a,s,u));break;case ut.J.Tree:t.push(new Ir.VN(a,Hr(o)));break;case ut.J.Attachment:t.push(new Ir.sG(a,o.id));break;case ut.J.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,ur.U)(o,"Unexpected summary tree type")}}return{entries:t,unreferenced:e.unreferenced}}function Gr(e){return e.replace(/\/+$/g,"")}var Kr=function(){function e(){(0,n.Z)(this,e),this.gcNodesSet={}}return(0,i.Z)(e,[{key:"gcNodes",get:function(){for(var e={},t=0,r=Object.entries(this.gcNodesSet);t<r.length;t++){var n=(0,F.Z)(r[t],2),i=n[0],a=n[1];e[i]=(0,p.Z)(a)}return e}},{key:"addNode",value:function(e,t){this.gcNodesSet[e]=new Set(t)}},{key:"prefixAndAddNodes",value:function(e,t){for(var r=0,n=Object.entries(t);r<n.length;r++){var i=(0,F.Z)(n[r],2),a=i[0],o=i[1],s=a.replace(/^\/+/g,"");s=Gr(s="/".concat(e,"/").concat(s)),this.gcNodesSet[s]=new Set(o)}}},{key:"addNodes",value:function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=(0,F.Z)(r[t],2),i=n[0],a=n[1];this.gcNodesSet[i]=new Set(a)}}},{key:"addRouteToAllNodes",value:function(e){for(var t=0,r=Object.values(this.gcNodesSet);t<r.length;t++){r[t].add(e)}}},{key:"getGCData",value:function(){return{gcNodes:this.gcNodes}}}]),e}();function Ur(e,t){return Jr.apply(this,arguments)}function Jr(){return Jr=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readBlob(r);case 2:return n=e.sent,i=(0,Q.zT)(n,"utf8"),e.abrupt("return",JSON.parse(i));case 5:case"end":return e.stop()}}),e)}))),Jr.apply(this,arguments)}function Wr(e){var t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}var Qr=function(){function e(t,r,i,a){(0,n.Z)(this,e),this.tree=t,this.storage=r,this.logger=i,this.extraBlobs=a,this.flattenedTree={},void 0!==t&&e.flattenTree("",t,this.flattenedTree)}return(0,i.Z)(e,[{key:"contains",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.flattenedTree[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdForPath(t);case 2:if(r=e.sent,void 0===(n=void 0!==this.extraBlobs?this.extraBlobs.get(r):void 0)){e.next=6;break}return e.abrupt("return",n);case 6:return(i=this.storage.readBlob(r)).catch((function(e){return o.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e)})),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.tree,i=Wr(t);void 0!==n&&i.length>0;)o=i.shift(),n=n.trees[o];if(void 0!==n&&0===i.length){e.next=5;break}throw new Error("path does not exist");case 5:return e.abrupt("return",Object.keys(null!==(r=null===n||void 0===n?void 0:n.blobs)&&void 0!==r?r:{}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdForPath",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.flattenedTree[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"flattenTree",value:function(t,r,n){for(var i in r.trees)e.flattenTree("".concat(t).concat(i,"/"),r.trees[i],n);for(var a in r.blobs)n["".concat(t).concat(a)]=r.blobs[a]}}]),e}(),Xr=function(){function e(t,r,i,a){(0,n.Z)(this,e),this._connected=t,this.submit=r,this.dirty=i,this.addedGCOutboundReference=a}return(0,i.Z)(e,[{key:"handler",get:function(){return(0,B.h)(!!this._handler,375),this._handler}},{key:"connected",get:function(){return this._connected}},{key:"attach",value:function(e){(0,B.h)(void 0===this._handler,376),this._handler=e}},{key:"setConnectionState",value:function(e){this._connected=e,this.handler.setConnectionState(e)}},{key:"process",value:function(e,t,r){try{this.handler.process(e,t,r)}catch(V){throw ar.wrapIfUnrecognized(V,"channelDeltaConnectionFailedToProcessMessage",e)}}},{key:"reSubmit",value:function(e,t){this.handler.reSubmit(e,t)}},{key:"rollback",value:function(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}},{key:"applyStashedOp",value:function(e){return this.handler.applyStashedOp(e)}}]),e}(),Yr=".attributes";function $r(e,t,r,n,i,a,o,s){return{deltaConnection:new Xr(e,(function(e,r){return t(e,r)}),r,n),objectStorage:new Qr(o,i,a,s)}}function en(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,i=e.getAttachSummary(t,r,n);return Lr(i,Yr,JSON.stringify(e.attributes)),i}function tn(e){return rn.apply(this,arguments)}function rn(){return rn=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o,s,u=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]&&u[1],n=u.length>2&&void 0!==u[2]&&u[2],i=u.length>3?u[3]:void 0,o=u.length>4?u[4]:void 0,e.next=6,t.summarize(r,n,i,o);case 6:return Lr(s=e.sent,Yr,JSON.stringify(t.attributes)),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)}))),rn.apply(this,arguments)}function nn(e,t,r,n,i){return an.apply(this,arguments)}function an(){return(an=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o){var s,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.objectStorage.contains(Yr);case 2:if(!e.sent){e.next=6;break}return e.next=5,Ur(r.objectStorage,Yr);case 5:s=e.sent;case 6:if(void 0!==(u=s?s.type:o)){e.next=9;break}throw new ir("channelTypeNotAvailable",{channelId:{value:n,tag:$t.CodeArtifact},dataStoreId:{value:t.id,tag:$t.CodeArtifact},dataStorePackagePath:t.packagePath.join("/"),channelFactoryType:o});case 9:if(void 0!==(c=i.get(u))){e.next=12;break}throw new ir("channelFactoryNotRegisteredForGivenType",{channelId:{value:n,tag:$t.CodeArtifact},dataStoreId:{value:t.id,tag:$t.CodeArtifact},dataStorePackagePath:t.packagePath.join("/"),channelFactoryType:u});case 12:return s=null!==s&&void 0!==s?s:c.attributes,e.abrupt("return",{factory:c,attributes:s});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(e,t,r,n,i,a){return sn.apply(this,arguments)}function sn(){return(sn=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o,s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==r.snapshotFormatVersion&&r.snapshotFormatVersion!==n.attributes.snapshotFormatVersion&&o.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:r.type,tag:$t.CodeArtifact},channelSnapshotVersion:{value:"".concat(r.snapshotFormatVersion,"@").concat(r.packageVersion),tag:$t.CodeArtifact},channelCodeVersion:{value:"".concat(n.attributes.snapshotFormatVersion,"@").concat(n.attributes.packageVersion),tag:$t.CodeArtifact}}),e.abrupt("return",n.load(t,s,i,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var un=r(58121),cn=r.n(un),ln=function(){function e(t,r,i,a,o){(0,n.Z)(this,e),this.id=t,this.runtime=r,this.services=i,this.channelP=a,this._channel=o,this.globallyVisible=!1,this.pending=[],(0,B.h)(!this.id.includes("/"),783)}return(0,i.Z)(e,[{key:"getChannel",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._channel){e.next=2;break}return e.abrupt("return",this.channelP.then((function(e){return t._channel=e})));case 2:return e.abrupt("return",this.channelP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isLoaded",get:function(){return void 0!==this._channel}},{key:"setConnectionState",value:function(e,t){this.globallyVisible&&this.isLoaded&&this.services.value.deltaConnection.setConnectionState(e)}},{key:"processOp",value:function(e,t,r){(0,B.h)(this.globallyVisible,723),this.isLoaded?this.services.value.deltaConnection.process(e,t,r):((0,B.h)(!1===t,393),this.pending.push(e))}},{key:"reSubmit",value:function(e,t){(0,B.h)(this.isLoaded,394),(0,B.h)(this.globallyVisible,724),this.services.value.deltaConnection.reSubmit(e,t)}},{key:"rollback",value:function(e,t){(0,B.h)(this.isLoaded,750),(0,B.h)(this.globallyVisible,751),this.services.value.deltaConnection.rollback(e,t)}},{key:"applyStashedOp",value:function(){throw new Error("no stashed ops on local channel")}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i,o=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1&&void 0!==o[1]&&o[1],n=o.length>2?o[2]:void 0,e.next=5,this.getChannel();case 5:return i=e.sent,e.abrupt("return",tn(i,t,r,n));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAttachSummary",value:function(e){return(0,B.h)(void 0!==this._channel,397),en(this._channel,!0,!1,e)}},{key:"makeVisible",value:function(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&((0,B.h)(!!this._channel,402),this._channel.connect(this.services.value)),this.globallyVisible=!0}},{key:"getGCData",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.getChannel();case 3:return r=e.sent,e.abrupt("return",r.getGCData(t));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e){}}]),e}(),hn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,s,u,c,l,h,d,f,v){var p;return(0,n.Z)(this,r),(p=t.call(this,e,s,new oe.o((function(){var e=new Map,t=cn()(p.snapshotTree);return p.isSnapshotInOldFormatAndCollectBlobs(t,e)&&p.sanitizeSnapshot(t),$r(u.connected,h,p.dirtyFn,f,c,l,t,e)})),new sr.d((0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,o,c,h,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,nn(u,p.services.value,p.id,i);case 3:return t=e.sent,r=t.attributes,n=t.factory,e.next=8,on(s,r,n,p.services.value,l,p.id);case 8:o=e.sent,c=(0,R.Z)(p.pending);try{for(c.s();!(h=c.n()).done;)d=h.value,p.services.value.deltaConnection.process(d,!1,void 0)}catch(a){c.e(a)}finally{c.f()}return e.abrupt("return",o);case 14:throw e.prev=14,e.t0=e.catch(0),ar.wrapIfUnrecognized(e.t0,"rehydratedLocalChannelContextFailedToLoadChannel",void 0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))))).snapshotTree=v,p.dirtyFn=function(){d(e)},p}return(0,i.Z)(r,[{key:"isSnapshotInOldFormatAndCollectBlobs",value:function(e,t){var r=!1,n=e.blobsContents;Object.entries(n).forEach((function(n){var i=(0,F.Z)(n,2),a=i[0],o=i[1];t.set(a,o),void 0!==e.blobs[a]&&(r=!0)}));for(var i=0,a=Object.values(e.trees);i<a.length;i++){var o=a[i];r=r||this.isSnapshotInOldFormatAndCollectBlobs(o,t)}return r}},{key:"sanitizeSnapshot",value:function(e){var t,r=new Map(Object.entries(e.blobs)),n=(0,R.Z)(r.entries());try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=i[0],o=i[1];void 0===r.get(o)&&delete e.blobs[a]}}catch(l){n.e(l)}finally{n.f()}for(var s=0,u=Object.values(e.trees);s<u.length;s++){var c=u[s];this.sanitizeSnapshot(c)}}}]),r}(ln),dn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a,o,s,u,c,l,h,d){var f;(0,n.Z)(this,r),(0,B.h)(void 0!==a,521);var v=i.get(a);if(void 0===v)throw new Error("Channel Factory ".concat(a," not registered"));var p=v.create(o,e);return(f=t.call(this,e,o,new oe.o((function(){return $r(s.connected,l,f.dirtyFn,d,u,c)})),Promise.resolve(p),p)).channel=p,f.dirtyFn=function(){h(e)},f}return(0,i.Z)(r)}(ln),fn=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;(0,n.Z)(this,e),this.threshold=t,this.logger=r,this.thresholdMultiple=i}return(0,i.Z)(e,[{key:"send",value:function(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}},{key:"sendIfMultiple",value:function(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}]),e}(),vn=function(){function e(t,r,i,s,u,c,l,h,d,f,v,p){var y=this;(0,n.Z)(this,e),this.id=l,this.isLoaded=!1,this.pending=[],(0,B.h)(!this.id.includes("/"),784),this.subLogger=hr.create(t.logger,"RemoteChannelContext"),this.services=$r(r.connected,s,(function(){return u(y.id)}),c,i,this.subLogger,h,f),this.channelP=new sr.d((0,o.Z)((0,a.Z)().mark((function e(){var n,i,o,s,u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nn(r,y.services,y.id,d,p);case 2:return n=e.sent,i=n.attributes,o=n.factory,e.next=7,on(t,i,o,y.services,y.subLogger,y.id);case 7:s=e.sent,(0,B.h)(void 0!==y.pending,575),u=(0,R.Z)(y.pending);try{for(u.s();!(c=u.n()).done;)l=c.value,y.services.deltaConnection.process(l,!1,void 0)}catch(a){u.e(a)}finally{u.f()}return y.thresholdOpsCounter.send("ProcessPendingOps",y.pending.length),y.channel=s,y.pending=void 0,y.isLoaded=!0,y.services.deltaConnection.setConnectionState(r.connected),e.abrupt("return",y.channel);case 17:case"end":return e.stop()}}),e)}))));var g=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.summarizeInternal(t,r,n,i));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}();this.summarizerNode=v(g,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.getGCDataInternal(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.thresholdOpsCounter=new fn(e.pendingOpsCountThreshold,this.subLogger)}return(0,i.Z)(e,[{key:"getChannel",value:function(){return this.channelP}},{key:"setConnectionState",value:function(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}},{key:"applyStashedOp",value:function(e){return(0,B.h)(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}},{key:"processOp",value:function(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):((0,B.h)(!t,405),(0,B.h)(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}},{key:"reSubmit",value:function(e,t){(0,B.h)(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}},{key:"rollback",value:function(e,t){(0,B.h)(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],r=!(i.length>1&&void 0!==i[1])||i[1],n=i.length>2?i[2]:void 0,e.abrupt("return",this.summarizerNode.summarize(t,r,n));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"summarizeInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){var o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChannel();case 2:return o=e.sent,e.next=5,tn(o,t,r,n,i);case 5:return s=e.sent,e.abrupt("return",Object.assign(Object.assign({},s),{id:this.id}));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.abrupt("return",this.summarizerNode.getGCData(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCDataInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.getChannel();case 3:return r=e.sent,e.abrupt("return",r.getGCData(t));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e){this.summarizerNode.updateUsedRoutes([""])}}]),e}();vn.pendingOpsCountThreshold=1e3;var pn,yn=function(){function e(t,r,i){(0,n.Z)(this,e),this.value=t,this.path=r,this.routeContext=i,this.pendingHandlesToMakeVisible=new Set,this.locallyVisible=!1,this.absolutePath=Dr(r,this.routeContext)}return(0,i.Z)(e,[{key:"IFluidHandle",get:function(){return this}},{key:"isAttached",get:function(){return this.routeContext.isAttached}},{key:"visible",get:function(){return this.isAttached||this.locallyVisible}},{key:"get",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.value);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachGraph",value:function(){this.visible||(this.locallyVisible=!0,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.routeContext.attachGraph())}},{key:"bind",value:function(e){this.visible?e.attachGraph():this.pendingHandlesToMakeVisible.add(e)}}]),e}();!function(e){e.Attach="attach",e.ChannelOp="op"}(pn||(pn={}));var gn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,s,u){var c,l,h;(0,n.Z)(this,r),(c=t.call(this)).dataStoreContext=e,c.sharedObjectRegistry=i,c._disposed=!1,c.contexts=new Map,c.contextsDeferred=new Map,c.pendingAttach=new Map,c.deferredAttached=new sr.B,c.localChannelContextQueue=new Map,c.notBoundedChannelContextSet=new Set,c.pendingHandlesToMakeVisible=new Set,(0,B.h)(!e.id.includes("/"),782),c.mc=Sr(h=hr.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:(0,H.Z)()}}))?h:wr(h,pr.value),c.id=e.id,c.options=e.options,c.deltaManager=e.deltaManager,c.quorum=e.getQuorum(),c.audience=e.getAudience();var d=e.baseSnapshot;if(void 0!==(null===d||void 0===d?void 0:d.trees)&&Object.keys(d.trees).forEach((function(t){if("_search"!==t){var r;e.isLocalDataStore?(r=new hn(t,c.sharedObjectRegistry,(0,z.Z)(c),c.dataStoreContext,c.dataStoreContext.storage,c.logger,(function(e,r){return c.submitChannelOp(t,e,r)}),(function(e){return c.setChannelDirty(e)}),(function(e,t){return c.addedGCOutboundReference(e,t)}),d.trees[t]),e.attachState!==ne.m.Detached?r.makeVisible():c.localChannelContextQueue.set(t,r)):r=new vn((0,z.Z)(c),e,e.storage,(function(e,r){return c.submitChannelOp(t,e,r)}),(function(e){return c.setChannelDirty(e)}),(function(e,t){return c.addedGCOutboundReference(e,t)}),t,d.trees[t],c.sharedObjectRegistry,void 0,c.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:Or.XK.FromSummary}));var n=new sr.B;n.resolve(r),c.contexts.set(t,r),c.contextsDeferred.set(t,n)}})),u){var f=new sr.d((0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u((0,z.Z)(c)));case 1:case"end":return e.stop()}}),e)}))));c.entryPoint=new yn(f,"",c.objectsRoutingContext)}return c.attachListener(),c._attachState=e.attachState,c.visibilityState=s?e.attachState===ne.m.Detached?Or.Bl.LocallyVisible:Or.Bl.GloballyVisible:Or.Bl.NotVisible,s&&c.deferredAttached.resolve(),c.localChangesTelemetryCount=null!==(l=c.mc.config.getNumber("Fluid.Telemetry.LocalChangesTelemetryCount"))&&void 0!==l?l:10,c}return(0,i.Z)(r,[{key:"IFluidRouter",get:function(){return this}},{key:"connected",get:function(){return this.dataStoreContext.connected}},{key:"clientId",get:function(){return this.dataStoreContext.clientId}},{key:"clientDetails",get:function(){return this.dataStoreContext.clientDetails}},{key:"isAttached",get:function(){return this.attachState!==ne.m.Detached}},{key:"attachState",get:function(){return this._attachState}},{key:"absolutePath",get:function(){return Dr(this.id,this.routeContext)}},{key:"routeContext",get:function(){return this.dataStoreContext.IFluidHandleContext}},{key:"idCompressor",get:function(){return this.dataStoreContext.idCompressor}},{key:"IFluidHandleContext",get:function(){return this}},{key:"rootRoutingContext",get:function(){return this}},{key:"channelsRoutingContext",get:function(){return this}},{key:"objectsRoutingContext",get:function(){return this}},{key:"disposed",get:function(){return this._disposed}},{key:"logger",get:function(){return this.mc.logger}},{key:"ensureNoDataModelChanges",value:function(e){return void 0===this.dataStoreContext.ensureNoDataModelChanges?e():this.dataStoreContext.ensureNoDataModelChanges(e)}},{key:"dispose",value:function(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}},{key:"resolveHandle",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=Nr.create(t),"_channels"!==(n=r.pathParts[0])&&"_custom"!==n){e.next=5;break}return e.abrupt("return",this.request(r.createSubRequest(1)));case 5:if(!this.contextsDeferred.has(n)||!r.isLeaf(1)){e.next=20;break}return e.prev=6,e.next=9,this.contextsDeferred.get(n).promise;case 9:return i=e.sent,e.next=12,i.getChannel();case 12:return o=e.sent,e.abrupt("return",{mimeType:"fluid/object",status:200,value:o});case 16:return e.prev=16,e.t0=e.catch(6),this.mc.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},e.t0),e.abrupt("return",Fr(500,"Failed to get Channel: ".concat(e.t0),t));case 20:return e.abrupt("return",Er(t));case 23:return e.prev=23,e.t1=e.catch(0),e.abrupt("return",Mr(e.t1));case 26:case"end":return e.stop()}}),e,this,[[0,23],[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannel",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),this.contextsDeferred.has(t)||this.contextsDeferred.set(t,new sr.B),e.next=4,this.contextsDeferred.get(t).promise;case 4:return r=e.sent,e.next=7,r.getChannel();case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,H.Z)(),r=arguments.length>1?arguments[1]:void 0;if(t.includes("/"))throw new nr("Id cannot contain slashes: ".concat(t));this.verifyNotClosed(),(0,B.h)(!this.contexts.has(t),377),this.notBoundedChannelContextSet.add(t);var n=new dn(t,this.sharedObjectRegistry,r,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(function(r,n){return e.submitChannelOp(t,r,n)}),(function(t){return e.setChannelDirty(t)}),(function(t,r){return e.addedGCOutboundReference(t,r)}));if(this.contexts.set(t,n),this.contextsDeferred.has(t))this.contextsDeferred.get(t).resolve(n);else{var i=new sr.B;i.resolve(n),this.contextsDeferred.set(t,i)}return this.identifyLocalChangeInSummarizer("DDSCreatedInSummarizer",t,r),n.channel}},{key:"bindChannel",value:function(e){(0,B.h)(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}},{key:"makeVisibleAndAttachGraph",value:function(){this.visibilityState===Or.Bl.NotVisible&&(this.visibilityState=Or.Bl.LocallyVisible,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.dataStoreContext.makeLocallyVisible())}},{key:"attachGraph",value:function(){this.makeVisibleAndAttachGraph()}},{key:"bindToContext",value:function(){this.makeVisibleAndAttachGraph()}},{key:"bind",value:function(e){this.visibilityState===Or.Bl.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}},{key:"setConnectionState",value:function(e,t){this.verifyNotClosed();var r,n=(0,R.Z)(this.contexts);try{for(n.s();!(r=n.n()).done;){(0,F.Z)(r.value,2)[1].setConnectionState(e,t)}}catch(i){n.e(i)}finally{n.f()}!function(e,t,r,n,i){try{r?t.emit("connected",n):t.emit("disconnected",i)}catch(V){e.sendErrorEvent({eventName:"RaiseConnectedEventError"},V)}}(this.logger,this,e,t)}},{key:"getQuorum",value:function(){return this.quorum}},{key:"getAudience",value:function(){return this.audience}},{key:"uploadBlob",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),e.abrupt("return",this.dataStoreContext.uploadBlob(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"process",value:function(e,t,r){var n=this;this.verifyNotClosed();try{switch(e.type){case pn.Attach:var i=e.contents,a=i.id;if(t)(0,B.h)(this.pendingAttach.has(a),380),this.pendingAttach.delete(a);else{(0,B.h)(!this.contexts.has(a),381);var o=new Map,s=function(e,t){var r=Pr(e,t);return(0,Ir.eB)(r)}(i.snapshot.entries,o),u=new vn(this,this.dataStoreContext,this.dataStoreContext.storage,(function(e,t){return n.submitChannelOp(a,e,t)}),(function(e){return n.setChannelDirty(e)}),(function(e,t){return n.addedGCOutboundReference(e,t)}),a,s,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(a,{type:Or.XK.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),i.type);if(this.contexts.set(a,u),this.contextsDeferred.has(a))this.contextsDeferred.get(a).resolve(u);else{var c=new sr.B;c.resolve(u),this.contextsDeferred.set(a,c)}}break;case pn.ChannelOp:this.processChannelOp(e,t,r)}this.emit("op",e)}catch(V){throw ar.wrapIfUnrecognized(V,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}},{key:"processSignal",value:function(e,t){this.emit("signal",e,t)}},{key:"isChannelAttached",value:function(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}},{key:"getOutboundRoutes",value:function(){var e,t=[],r=(0,R.Z)(this.contexts);try{for(r.s();!(e=r.n()).done;){var n=(0,F.Z)(e.value,1)[0];t.push("".concat(this.absolutePath,"/").concat(n))}}catch(i){r.e(i)}finally{r.f()}return t}},{key:"updateGCNodes",value:function(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}},{key:"getGCData",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n=this,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],r=new Kr,e.next=4,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,F.Z)(e,2),r=t[0];t[1];return n.isChannelAttached(r)})).map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(n){var i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,F.Z)(n,2),o=i[0],s=i[1],e.next=3,s.getGCData(t);case 3:u=e.sent,r.prefixAndAddNodes(o,u.gcNodes);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return this.updateGCNodes(r),e.abrupt("return",r.getGCData());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e){var t,r,n=function(e){var t,r=e.filter((function(e){return""!==e&&"/"!==e})),n=new Map,i=(0,R.Z)(r);try{for(i.s();!(t=i.n()).done;){var a=t.value;(0,B.h)(a.startsWith("/"),1504);var o=a.split("/")[1],s=a.slice(o.length+1),u=n.get(o);void 0!==u?u.push(s):n.set(o,[s])}}catch(c){i.e(c)}finally{i.f()}return n}(e),i=(0,R.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,F.Z)(r.value,1)[0];(0,B.h)(this.contexts.has(a),382)}}catch(l){i.e(l)}finally{i.f()}var o,s=(0,R.Z)(this.contexts);try{for(s.s();!(o=s.n()).done;){var u=(0,F.Z)(o.value,2),c=u[0];u[1].updateUsedRoutes(null!==(t=n.get(c))&&void 0!==t?t:[])}}catch(l){s.e(l)}finally{s.f()}}},{key:"addedGCOutboundReference",value:function(e,t){var r,n;null===(n=(r=this.dataStoreContext).addedGCOutboundReference)||void 0===n||n.call(r,e,t)}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i,s=this,u=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]&&u[0],r=!(u.length>1&&void 0!==u[1])||u[1],n=u.length>2?u[2]:void 0,i=new Vr,e.next=6,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,F.Z)(e,2),r=t[0],n=(t[1],s.isChannelAttached(r));return(0,B.h)(n,383),n})).map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(o){var s,u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,F.Z)(o,2),u=s[0],c=s[1],e.next=3,c.summarize(t,r,n);case 3:l=e.sent,i.addWithStats(u,l);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",i.getSummaryTree());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAttachSummary",value:function(e){this.attachGraph();var t,r=new Vr,n=(0,R.Z)(this.contexts);try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=i[0],o=i[1];if(!(o instanceof ln))throw new er("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(a)){var s=void 0;if(o.isLoaded){var u=o.getAttachSummary(e);(0,B.h)(u.summary.type===ut.J.Tree,384),s={stats:u.stats,summary:u.summary}}else(0,B.h)(!!this.dataStoreContext.baseSnapshot,385),s=qr(this.dataStoreContext.baseSnapshot.trees[a]);r.addWithStats(a,s)}}}catch(c){n.e(c)}finally{n.f()}return r.getSummaryTree()}},{key:"submitMessage",value:function(e,t,r){this.submit(e,t,r)}},{key:"submitSignal",value:function(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}},{key:"waitAttached",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deferredAttached.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachChannel",value:function(e){if(this.verifyNotClosed(),!e.handle.isAttached){e.handle.attachGraph(),(0,B.h)(this.isAttached,386),(0,B.h)(this.visibilityState===Or.Bl.GloballyVisible,720);var t=Hr(en(e,!0,!1).summary),r={id:e.id,snapshot:t,type:e.attributes.type};this.pendingAttach.set(e.id,r),this.submit(pn.Attach,r),this.contexts.get(e.id).makeVisible()}}},{key:"submitChannelOp",value:function(e,t,r){var n={address:e,contents:t};this.submit(pn.ChannelOp,n,r)}},{key:"submit",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}},{key:"reSubmit",value:function(e,t,r){switch(this.verifyNotClosed(),e){case pn.ChannelOp:var n=t,i=this.contexts.get(n.address);(0,B.h)(!!i,387),i.reSubmit(n.contents,r);break;case pn.Attach:this.submit(e,t,r);break;default:(0,ur.U)(e)}}},{key:"rollback",value:function(e,t,r){if(this.verifyNotClosed(),e!==pn.ChannelOp)throw new er("Can't rollback ".concat(e," message"));var n=t,i=this.contexts.get(n.address);(0,B.h)(!!i,749),i.rollback(n.contents,r)}},{key:"applyStashedOp",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,n=this.contexts.get(r.address),(0,B.h)(!!n,388),e.next=5,n.getChannel();case 5:return e.abrupt("return",n.applyStashedOp(r.contents));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelDirty",value:function(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}},{key:"processChannelOp",value:function(e,t,r){this.verifyNotClosed();var n=e.contents,i=Object.assign(Object.assign({},e),{contents:n.contents}),a=this.contexts.get(n.address);return(0,B.h)(!!a,389),a.processOp(i,t,r),a}},{key:"attachListener",value:function(){var e=this;this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",(function(){e.attachGraph(),e._attachState=ne.m.Attaching,(0,B.h)(e.visibilityState===Or.Bl.LocallyVisible,721),e.visibilityState=Or.Bl.GloballyVisible,e.localChannelContextQueue.forEach((function(e){e.makeVisible()})),e.localChannelContextQueue.clear(),e.deferredAttached.resolve(),e.emit("attaching")})),this.dataStoreContext.once("attached",(function(){(0,B.h)(e.visibilityState===Or.Bl.GloballyVisible,722),e._attachState=ne.m.Attached,e.emit("attached")}))}},{key:"verifyNotClosed",value:function(){if(this._disposed)throw new er("Runtime is closed")}},{key:"identifyLocalChangeInSummarizer",value:function(e,t,r){var n;"summarizer"!==this.clientDetails.type||this.localChangesTelemetryCount<=0||(this.mc.logger.sendTelemetryEvent({eventName:e,channelType:r,channelId:{value:t,tag:$t.CodeArtifact},fluidDataStoreId:{value:this.id,tag:$t.CodeArtifact},fluidDataStorePackagePath:(n=this.dataStoreContext.packagePath,n?{value:n.join("/"),tag:$t.CodeArtifact}:void 0),stack:Kt()}),this.localChangesTelemetryCount--)}}],[{key:"load",value:function(e,t,n){return new r(e,t,n,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",_r(t,"/"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]),r}(L.L),bn=function(e){return function(t){(0,_.Z)(s,t);var r=(0,A.Z)(s);function s(){return(0,n.Z)(this,s),r.apply(this,arguments)}return(0,i.Z)(s,[{key:"request",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(r){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,te.Z)((0,re.Z)(s.prototype),"request",this).call(this,r);case 2:if(404!==(n=t.sent).status){t.next=5;break}return t.abrupt("return",e(r,this));case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),s}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:gn)},mn=function(){function e(t){(0,n.Z)(this,e),this.map=new Map;var r,i=(0,R.Z)(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(this.map.has(a[0]))throw new nr("Duplicate entry names exist");this.map.set(a[0],a[1])}}catch(o){i.e(o)}finally{i.f()}}return(0,i.Z)(e,[{key:"IFluidDataStoreRegistry",get:function(){return this}},{key:"get",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.map.has(t)){e.next=2;break}return e.abrupt("return",this.map.get(t));case 2:return e.abrupt("return",void 0);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),kn="IFluidDependencySynthesizer",Cn=function(){function e(){(0,n.Z)(this,e),this.providers=new Map;for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];this.parents=r.filter((function(e){return void 0!==e}))}return(0,i.Z)(e,[{key:"IFluidDependencySynthesizer",get:function(){return this}},{key:"register",value:function(e,t){if(this.providers.has(e))throw new Error("Attempting to register a provider of type ".concat(String(e)," that already exists"));this.providers.set(e,t)}},{key:"unregister",value:function(e){this.providers.has(e)&&this.providers.delete(e)}},{key:"synthesize",value:function(e,t){var r=this,n={};return this.generateRequired(n,t),this.generateOptional(n,e),Object.defineProperty(n,kn,{get:function(){return r}}),n}},{key:"has",value:function(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some((function(t){return t.has(e)}))}},{key:"getProvider",value:function(t){if(this.has(t)){if(this.providers.has(t))return this.providers.get(t);var r,n=(0,R.Z)(this.parents);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i instanceof e)return i.getProvider(t);var a=i;if(void 0!==(null===a||void 0===a?void 0:a.getProvider))return a.getProvider(t)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"generateRequired",value:function(e,t){if(void 0!==t)for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r],a=this.resolveProvider(i);if(void 0===a)throw new Error("Object attempted to be created without registered required provider ".concat(String(i)));Object.defineProperty(e,i,a)}}},{key:"generateOptional",value:function(e,t){var r;if(void 0!==t)for(var n=0,i=Object.keys(t);n<i.length;n++){var s=i[n],u=null!==(r=this.resolveProvider(s))&&void 0!==r?r:{get:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};Object.defineProperty(e,s,u)}}},{key:"resolveProvider",value:function(e){var t=this.providers.get(e);if(void 0!==t)return"function"===typeof t?{get:function(){if(t&&"function"===typeof t)return Promise.resolve(this[kn]).then(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t(r));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(t){return null===t||void 0===t?void 0:t[e]}))}}:{get:function(){if(t)return Promise.resolve(t).then((function(t){if(t)return t[e]}))}};var r,n=(0,R.Z)(this.parents);try{for(n.s();!(r=n.n()).done;){var i=r.value,s=(0,E.Z)({},e,e),u=i.synthesize(s,{}),c=Object.getOwnPropertyDescriptor(u,e);if(void 0!==c)return c}}catch(l){n.e(l)}finally{n.f()}}}]),e}();function Sn(e,t,r,n,i,a,o){return wn.apply(this,arguments)}function wn(){return wn=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,s,u,c){var l,h,d,f,v,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=s,l=bn(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=r.entryPoint)||void 0===n?void 0:n.get();case 2:return i=e.sent,(0,B.h)(void 0!==i,1128),(0,B.h)(void 0!==(null===i||void 0===i?void 0:i.IFluidRouter),1129),e.abrupt("return",null===i||void 0===i?void 0:i.IFluidRouter.request(t));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),l),h=new l(r,n,u,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,B.h)(void 0!==p,1130),e.next=3,p.finishInitialization(!0);case 3:return e.abrupt("return",p);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d=r.scope,f=new Cn(d.IFluidDependencySynthesizer),v=f.synthesize(i,{}),p=new t({runtime:h,context:r,providers:v,initProps:c}),u){e.next=10;break}return e.next=10,p.finishInitialization(u);case 10:return e.abrupt("return",{instance:p,runtime:h});case 11:case"end":return e.stop()}}),e)}))),wn.apply(this,arguments)}var Zn=function(){function e(t,r,i,a,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:gn;if((0,n.Z)(this,e),this.type=t,this.ctor=r,this.optionalProviders=a,this.runtimeClass=s,""===this.type)throw new Error("undefined type member");void 0!==o&&(this.registry=new mn(o)),this.sharedObjectRegistry=new Map(i.map((function(e){return[e.type,e]})))}return(0,i.Z)(e,[{key:"IFluidDataStoreFactory",get:function(){return this}},{key:"IFluidDataStoreRegistry",get:function(){return this.registry}},{key:"registryEntry",get:function(){return[this.type,Promise.resolve(this)]}},{key:"instantiateDataStore",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sn(this.ctor,t,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,r);case 2:return n=e.sent,i=n.runtime,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createChildInstance",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createNonRootInstanceCore(t.containerRuntime,[].concat((0,p.Z)(t.packagePath),[this.type]),r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createPeerInstance",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createNonRootInstanceCore(t.containerRuntime,t.packagePath,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createInstance",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.createNonRootInstanceCore(t,[this.type],r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createRootInstance",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.createDetachedRootDataStore([this.type],t),e.abrupt("return",this.createInstanceCore(i,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"createNonRootInstanceCore",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.createDetachedDataStore(r),e.abrupt("return",this.createInstanceCore(i,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"createInstanceCore",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Sn(this.ctor,t,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,r);case 2:return n=e.sent,i=n.instance,o=n.runtime,e.next=7,t.attachRuntime(this,o);case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),xn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:gn;(0,n.Z)(this,r);var c=(0,p.Z)(a);return a.find((function(e){return e.type===Ct.Type}))||c.push(St.getFactory()),a.find((function(e){return e.type===At.Type}))||c.push(Et.getFactory()),t.call(this,e,i,c,o,s,u)}return(0,i.Z)(r)}(Zn);function In(e,t){return""===t.url||"/"===t.url||t.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:e}:Er(t)}var Tn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this))._disposed=!1,i.runtime=e.runtime,i.context=e.context,i.providers=e.providers,i.initProps=e.initProps,(0,B.h)(void 0===i.runtime._dataObject,189),i.runtime._dataObject=(0,z.Z)(i),i.runtime.once("dispose",(function(){i._disposed=!0,i.dispose()})),i}return(0,i.Z)(r,[{key:"disposed",get:function(){return this._disposed}},{key:"id",get:function(){return this.runtime.id}},{key:"IFluidRouter",get:function(){return this}},{key:"IFluidLoadable",get:function(){return this}},{key:"IFluidHandle",get:function(){return this.handle}},{key:"handle",get:function(){return(0,B.h)(void 0!==this.runtime.entryPoint,1131),this.runtime.entryPoint}},{key:"request",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",In(this,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"finishInitialization",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.initializeP){e.next=2;break}return e.abrupt("return",this.initializeP);case 2:return this.initializeP=this.initializeInternal(t),e.abrupt("return",this.initializeP);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initializeInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.preInitialize();case 2:if(!t){e.next=8;break}return(0,B.h)(void 0===this.initProps,190),e.next=6,this.initializingFromExisting();case 6:e.next=10;break;case 8:return e.next=10,this.initializingFirstTime(null!==(r=this.context.createProps)&&void 0!==r?r:this.initProps);case 10:return e.next=12,this.hasInitialized();case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFluidObjectFromDirectory",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n){var i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n?n(t,r):r.get(t),!(o=null===i||void 0===i?void 0:i.IFluidHandle)){e.next=4;break}return e.abrupt("return",o.get());case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"preInitialize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"initializingFirstTime",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"initializingFromExisting",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"hasInitialized",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){(0,te.Z)((0,re.Z)(r.prototype),"dispose",this).call(this)}}],[{key:"getDataObject",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=t.entryPoint)||void 0===r?void 0:r.get();case 2:return n=e.sent,(0,B.h)(void 0!==n,188),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),r}(r(1987)._),Pn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).rootDirectoryId="root",e}return(0,i.Z)(r,[{key:"root",get:function(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}},{key:"initializeInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}this.internalRoot=St.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext(),e.next=9;break;case 5:return e.next=7,this.runtime.getChannel(this.rootDirectoryId);case 7:this.internalRoot=e.sent,this.internalRoot.attributes.type===At.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"});case 9:return e.next=11,(0,te.Z)((0,re.Z)(r.prototype),"initializeInternal",this).call(this,t);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUninitializedErrorString",value:function(e){return"".concat(e," must be initialized before being accessed.")}}]),r}(Tn),On=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)&&"function"===typeof(null===e||void 0===e?void 0:e.addTelemetryProperties)},Dn=function(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorInstanceId)};function Nn(e){return"string"===typeof(null===e||void 0===e?void 0:e.errorType)&&"string"===typeof(null===e||void 0===e?void 0:e.message)&&On(e)}var Mn=function(e){return null!==e&&!Array.isArray(e)&&"object"===typeof e};function jn(e,t){var r={message:"string"===typeof(null===e||void 0===e?void 0:e.message)?e.message:String(e)};if(Mn(e)){var n=e.errorType,i=e.stack,a=e.name;if("string"===typeof n&&(r.errorType=n),"string"===typeof i){var o="string"===typeof a?a:void 0;r.stack=function(e,r){if(!t)return e;var n=e.split("\n");return n.shift(),void 0!==r&&n.unshift(r),n.join("\n")}(i,o)}}return r}var _n,An=function(e){return"function"===typeof(null===e||void 0===e?void 0:e.getTelemetryProperties)};function En(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Nn(e)&&function(e){var t=e;void 0===t.errorInstanceId&&(t.errorInstanceId=(0,H.Z)())}(e),"string"===typeof(null===(r=e)||void 0===r?void 0:r.errorType)&&"string"===typeof(null===r||void 0===r?void 0:r.message)&&Dn(r)&&On(r))return e.addTelemetryProperties(null!==(t=n.props)&&void 0!==t?t:{}),e;var i=jn(e,!1),a=i.message,o=i.stack,s=new Jn({message:a,stack:o});if("object"===typeof e&&null!==e){var u=e.canRetry,c=e.retryAfterSeconds;Object.assign(En,{canRetry:u,retryAfterSeconds:c})}"object"!==typeof e&&s.addTelemetryProperties({typeofError:typeof e});var l=Kn.typeCheck(e)?e.getTelemetryProperties():{untrustedOrigin:1};return s.addTelemetryProperties(Object.assign(Object.assign({},l),n.props)),s}function Fn(){var e=new Error("<<generated stack>>");if(void 0===_n&&(_n=void 0!==e.stack),_n)return e;try{throw e}catch(t){return t}}function Rn(){return Fn().stack}function zn(e,t){var r=jn(e,!1),n=r.message,i=r.stack,a=t(n);return void 0!==i&&Bn(a,i),Ln(e)&&a.addTelemetryProperties({untrustedOrigin:1}),Dn(e)&&(a.overwriteErrorInstanceId(e.errorInstanceId),a.addTelemetryProperties({innerErrorInstanceId:e.errorInstanceId})),An(e)&&a.addTelemetryProperties(e.getTelemetryProperties()),a}function Bn(e,t){try{Object.assign(e,{stack:t})}catch(r){e.addTelemetryProperties({stack2:t})}}function Ln(e){return Kn.typeCheck(e)?e.errorType===Un&&1===e.getTelemetryProperties().untrustedOrigin:!Nn(e)}function Vn(e){var t;return"string"===typeof(null===(t=e)||void 0===t?void 0:t.tag)}function qn(e,t){return Array.isArray(e)&&e.every((function(e){return Hn(e)}))?JSON.stringify(e):Hn(e)?e:(console.error("UnSupported Format of Logging Error Property for key ".concat(t,":"),e),"REDACTED (arbitrary object)")}function Hn(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return!0;default:return!1}}var Gn,Kn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set;return(0,n.Z)(this,r),(a=t.call(this,e)).omitPropsFromLogging=o,a._errorInstanceId=(0,H.Z)(),a.fluidErrorCode="-",o.add("omitPropsFromLogging"),o.add("_errorInstanceId"),i&&a.addTelemetryProperties(i),a}return(0,i.Z)(r,[{key:"errorInstanceId",get:function(){return this._errorInstanceId}},{key:"overwriteErrorInstanceId",value:function(e){this._errorInstanceId=e}},{key:"addTelemetryProperties",value:function(e){!function(e,t){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];void 0===e[i]&&(e[i]=t[i])}}(this,e)}},{key:"getTelemetryProperties",value:function(){var e=function(e,t){for(var r={},n=0,i=Object.keys(e);n<i.length;n++){var a=i[n];if(!t.has(a)){var o=e[a];Vn(o)?r[a]={value:qn(o.value,a),tag:o.tag}:r[a]=qn(o,a)}}return r}(this,this.omitPropsFromLogging);return Object.assign(Object.assign({},e),{stack:this.stack,message:this.message,errorInstanceId:this._errorInstanceId})}}],[{key:"typeCheck",value:function(e){return"object"===typeof e&&null!==e&&("function"===typeof e.addTelemetryProperties&&"function"===typeof e.getTelemetryProperties&&"string"===typeof e.errorInstanceId)}}]),r}((0,q.Z)(Error)),Un="genericError",Jn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e.message)).errorType=Un,void 0!==e.stack&&Bn((0,z.Z)(i),e.stack),i}return(0,i.Z)(r)}(Kn),Wn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a;return(0,n.Z)(this,r),(a=t.call(this,e,Object.assign(Object.assign({},i),{usageError:!0}))).errorType=V.u.usageError,a}return(0,i.Z)(r)}(Kn),Qn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i){var a;return(0,n.Z)(this,r),(a=t.call(this,e,Object.assign(Object.assign({},i),{dataProcessingError:1}))).errorType=V.u.dataCorruptionError,a.canRetry=!1,a}return(0,i.Z)(r)}(Kn),Xn=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).errorType=V.u.dataProcessingError,i.canRetry=!1,i}return(0,i.Z)(r,null,[{key:"create",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.wrapIfUnrecognized(e,t,n);return a.addTelemetryProperties(i),a}},{key:"wrapIfUnrecognized",value:function(e,t,n){var i=En(e,{props:Object.assign({dataProcessingError:1,dataProcessingCodepath:t},void 0===n?void 0:Yn(n))});if(Ln(i)||i.errorType===Un){var a=zn(i,(function(e){return new r(e)}));return a.addTelemetryProperties(i.getTelemetryProperties()),a}return i}}]),r}(Kn),Yn=function(e){return{messageClientId:e.clientId,messageSequenceNumber:e.sequenceNumber,messageClientSequenceNumber:e.clientSequenceNumber,messageReferenceSequenceNumber:e.referenceSequenceNumber,messageMinimumSequenceNumber:e.minimumSequenceNumber,messageTimestamp:e.timestamp}},$n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};!function(e){e.CodeArtifact="CodeArtifact",e.UserData="UserData"}(Gn||(Gn={}));var ei=function(){function e(t,r){(0,n.Z)(this,e),this.namespace=t,this.properties=r}return(0,i.Z)(e,[{key:"sendTelemetryEvent",value:function(e,t){var r;this.sendTelemetryEventCore(Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"generic"}),t)}},{key:"sendTelemetryEventCore",value:function(t,r){var n=function(e){for(var t=e.category,r=e.eventName,n=$n(e,["category","eventName"]),i={category:t,eventName:r},a=0,o=Object.keys(n);a<o.length;a++){var s=o[a];i[s]=ni(n[s])}return i}(t);void 0!==r&&e.prepareErrorObject(n,r,!1),"number"===typeof n.duration&&(n.duration=e.formatTick(n.duration)),this.send(n)}},{key:"sendErrorEvent",value:function(e,t){this.sendTelemetryEventCore(Object.assign(Object.assign({error:e.eventName},e),{category:"error"}),t)}},{key:"sendPerformanceEvent",value:function(e,t){var r,n=Object.assign(Object.assign({},e),{category:null!==(r=e.category)&&void 0!==r?r:"performance"});this.sendTelemetryEventCore(n,t)}},{key:"prepareEvent",value:function(t){var r="error"===t.category||void 0!==t.error,n=Object.assign({},t);if(void 0!==this.namespace&&(n.eventName="".concat(this.namespace).concat(e.eventNamespaceSeparator).concat(n.eventName)),this.properties){var i=[];i.push(this.properties.all),r&&i.push(this.properties.error);for(var a=0,o=i;a<o.length;a++){var s=o[a];if(void 0!==s)for(var u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];if(void 0===t[l]){var h=s[l],d="function"===typeof h?h():h;void 0!==d&&(n[l]=d)}}}}return n}}],[{key:"formatTick",value:function(e){return Math.floor(e)}},{key:"numberFromString",value:function(e){if(void 0!==e&&null!==e){var t=Number(e);return Number.isNaN(t)?e:t}}},{key:"sanitizePkgName",value:function(e){return e.replace("@","").replace("/","-")}},{key:"prepareErrorObject",value:function(e,t,r){var n=jn(t,!0),i=n.message,a=n.errorType,o=n.stack;if(e.stack=o,e.error=i,e.errorType=a,An(t))for(var s=t.getTelemetryProperties(),u=0,c=Object.keys(s);u<c.length;u++){var l=c[u];void 0===e[l]&&(e[l]=s[l])}void 0===e.stack&&r&&(e.stack=Rn())}}]),e}();ei.eventNamespaceSeparator=":";var ti=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a){var o;return(0,n.Z)(this,r),(o=t.call(this,i,a)).baseLogger=e,di(e)&&fi((0,z.Z)(o),new hi((0,z.Z)(o),e.config)),o}return(0,i.Z)(r,[{key:"send",value:function(e){this.baseLogger.send(this.prepareEvent(e))}}],[{key:"create",value:function(e,t,n){if(e instanceof r){for(var i={},a=0,o=[e.properties,n];a<o.length;a++){var s=o[a];void 0!==s&&(void 0!==s.all&&(i.all=Object.assign(Object.assign({},i.all),s.all)),void 0!==s.error&&(i.error=Object.assign(Object.assign({},i.error),s.error)))}var u=void 0===e.namespace?t:void 0===t?e.namespace:"".concat(e.namespace).concat(ei.eventNamespaceSeparator).concat(t);return new r(e.baseLogger,u,i)}return new r(e||new ri,t,n)}}]),r}(ei),ri=function(){function e(){(0,n.Z)(this,e)}return(0,i.Z)(e,[{key:"send",value:function(e){}}]),e}();function ni(e){return Vn(e)?{value:ii(e.value),tag:e.tag}:ii(e)}function ii(e){switch(typeof e){case"string":case"number":case"boolean":case"undefined":return e;case"object":return JSON.stringify(e);default:return console.error("convertToBasePropertyTypeUntagged: INVALID PROPERTY (typed as ".concat(typeof e,")")),"INVALID PROPERTY (typed as ".concat(typeof e,")")}}var ai=new oe.o((function(){return si(li())})),oi={getRawConfig:function(){}},si=function(e){return void 0!==e&&null!==e?new hi(void 0,{getRawConfig:function(t){var r,n;try{return null===(n=ci(null!==(r=e.getItem(t))&&void 0!==r?r:void 0))||void 0===n?void 0:n.raw}catch(i){}}}):oi};function ui(e){switch(e){case"boolean":case"number":case"string":return!0;default:return!1}}function ci(e){var t,r=e;if("string"===typeof e)try{r=JSON.parse(e),t={raw:e,string:e}}catch(vt){}if(void 0===r)return t;var n=typeof r;if(ui(n))return Object.assign(Object.assign({},t),(0,E.Z)({raw:e},n,r));if(Array.isArray(r)){var i=typeof r[0];if(!ui(i))return t;var a,o=(0,R.Z)(r);try{for(o.s();!(a=o.n()).done;){if(typeof a.value!==i)return t}}catch(s){o.e(s)}finally{o.f()}return Object.assign(Object.assign({},t),(0,E.Z)({raw:e},"".concat(i,"[]"),r))}return t}var li=function(){var e;try{return null!==(e=globalThis.sessionStorage)&&void 0!==e?e:void 0}catch(pt){return}},hi=function(){function e(t){(0,n.Z)(this,e),this.logger=t,this.configCache=new Map,this.orderedBaseProviders=[];for(var r=new Set,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];for(var s=[].concat(a);s.length>0;){var u=s.shift();void 0!==u&&vi(u)&&!r.has(u)&&(r.add(u),u instanceof e?s.push.apply(s,(0,p.Z)(u.orderedBaseProviders)):this.orderedBaseProviders.push(u))}}return(0,i.Z)(e,[{key:"getBoolean",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.boolean}},{key:"getNumber",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.number}},{key:"getString",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.string}},{key:"getBooleanArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["boolean[]"]}},{key:"getNumberArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["number[]"]}},{key:"getStringArray",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t["string[]"]}},{key:"getRawConfig",value:function(e){var t;return null===(t=this.getCacheEntry(e))||void 0===t?void 0:t.raw}},{key:"getCacheEntry",value:function(e){var t;if(!this.configCache.has(e)){var r,n=(0,R.Z)(this.orderedBaseProviders);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=ci(null===i||void 0===i?void 0:i.getRawConfig(e));if(void 0!==a)return this.configCache.set(e,a),null===(t=this.logger)||void 0===t||t.send({category:"generic",eventName:"ConfigRead",configName:{tag:Gn.CodeArtifact,value:e},configValue:{tag:Gn.CodeArtifact,value:JSON.stringify(a)}}),a}}catch(o){n.e(o)}finally{n.f()}this.configCache.set(e,{raw:void 0})}return this.configCache.get(e)}}]),e}();function di(e){var t=e;return vi(null===t||void 0===t?void 0:t.config)&&void 0!==(null===t||void 0===t?void 0:t.logger)}function fi(e){if(di(e))throw new Error("Logger is already a monitoring context");for(var t=e,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return t.config=(0,ae.Z)(hi,[e].concat(n)),t.logger=e,t}function vi(e){return"function"===typeof(null===e||void 0===e?void 0:e.getRawConfig)}function pi(e,t,r){var n,i=[],a=(0,R.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s="".concat(e).concat(o.path);if(o.type===xr.S.Blob){var u=o.value,c=(0,Q.k8)(u.contents,u.encoding),l=(0,H.Z)();r.set(l,c);var h={mode:xr.m[o.mode],path:s,sha:l,size:0,type:"blob",url:""};i.push(h)}else if(o.type===xr.S.Tree){(0,B.h)(o.type===xr.S.Tree,257);var d=o.value,f={mode:xr.m[o.mode],path:s,sha:"",size:-1,type:"tree",url:""};i.push(f);var v=pi("".concat(s,"/"),d.entries,r);i.push.apply(i,(0,p.Z)(v))}}}catch(y){a.e(y)}finally{a.f()}return i}function yi(e,t){return{sha:"",tree:pi("",e,t),url:""}}var gi=r(96969),bi=function(){function e(t){(0,n.Z)(this,e),this.request=t;var r=this.request.url.indexOf("?");this.query=r>=0?this.request.url.substring(r):""}return(0,i.Z)(e,[{key:"url",get:function(){return this.request.url}},{key:"headers",get:function(){return this.request.headers}},{key:"pathParts",get:function(){return void 0===this.requestPathParts&&(this.requestPathParts=e.getPathParts(this.url)),this.requestPathParts}},{key:"isLeaf",value:function(e){return""===this.query&&this.pathParts.length===e}},{key:"createSubRequest",value:function(e){var t=this.pathParts.length;if(e<0||e>t)throw new Error("incorrect sub-request");if(e===t&&this.url.includes("?"))return{url:"/".concat(this.query),headers:this.headers};var r="/".concat(this.pathParts.slice(e).join("/"));return{url:""===this.query?r:"".concat(r,"/").concat(this.query),headers:this.headers}}}],[{key:"getPathParts",value:function(e){var t=e.indexOf("?");return e.substring(0,t<0?e.length:t).split("/").reduce((function(e,t){return void 0!==t&&t.length>0&&e.push(decodeURIComponent(t)),e}),[])}},{key:"create",value:function(t){return t instanceof e?t:new e(t)}}]),e}();function mi(e){if(null!==e&&"object"===typeof e&&!0===e.errorFromRequestFluidObject){var t=e;return{mimeType:"text/plain",status:t.code,value:t.message,get stack(){return t.stack},headers:t.underlyingResponseHeaders}}var r=Fn();return{mimeType:"text/plain",status:500,value:"".concat(e),get stack(){var t;return null!==(t=null===e||void 0===e?void 0:e.stack)&&void 0!==t?t:r.stack}}}function ki(e,t){var r=e.value,n=Fn(),i={errorFromRequestFluidObject:!0,message:r,name:"Error",code:e.status,get stack(){var t;return null!==(t=e.stack)&&void 0!==t?t:n.stack},underlyingResponseHeaders:e.headers};return i}function Ci(e,t){return Si.apply(this,arguments)}function Si(){return(Si=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="string"===typeof r?{url:r}:r,e.next=3,t.request(n);case 3:if(200===(i=e.sent).status&&"fluid/object"===i.mimeType){e.next=6;break}throw ki(i);case 6:return(0,B.h)(i.value,410),e.abrupt("return",i.value);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var wi=function(e){return Zi(404,"not found",e)};function Zi(e,t,r,n){var i;(0,B.h)(200!==e,411);var a=null===(i=r.url)||void 0===i?void 0:i.split("?")[0],o=Fn();return{mimeType:"text/plain",status:e,value:void 0===a?t:"".concat(t,": ").concat(a),get stack(){return o.stack},headers:n}}function xi(){for(var e={treeNodeCount:0,blobNodeCount:0,handleNodeCount:0,totalBlobSize:0,unreferencedBlobSize:0},t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var i=0,a=r;i<a.length;i++){var o=a[i];e.treeNodeCount+=o.treeNodeCount,e.blobNodeCount+=o.blobNodeCount,e.handleNodeCount+=o.handleNodeCount,e.totalBlobSize+=o.totalBlobSize,e.unreferencedBlobSize+=o.unreferencedBlobSize}return e}function Ii(e){return"string"===typeof e?function(e){for(var t=e.length,r=e.length-1;r>=0;r--){var n=e.charCodeAt(r);n>127&&n<=2047?t++:n>2047&&n<=65535&&(t+=2),n>=56320&&n<=57343&&r--}return t}(e):e.byteLength}function Ti(e,t,r){var n={type:ut.J.Blob,content:r};e.summary.tree[t]=n,e.stats.blobNodeCount++,e.stats.totalBlobSize+=Ii(r)}var Pi=function(){function e(){(0,n.Z)(this,e),this.attachmentCounter=0,this.summaryTree={},this.summaryStats=xi(),this.summaryStats.treeNodeCount++}return(0,i.Z)(e,[{key:"summary",get:function(){return{type:ut.J.Tree,tree:Object.assign({},this.summaryTree)}}},{key:"stats",get:function(){return Object.assign({},this.summaryStats)}},{key:"addBlob",value:function(e,t){Ti({summary:{type:ut.J.Tree,tree:this.summaryTree},stats:this.summaryStats},e,t)}},{key:"addHandle",value:function(e,t,r){this.summaryTree[e]={type:ut.J.Handle,handleType:t,handle:r},this.summaryStats.handleNodeCount++}},{key:"addWithStats",value:function(e,t){this.summaryTree[e]=t.summary,this.summaryStats=xi(this.summaryStats,t.stats)}},{key:"addAttachment",value:function(e){this.summaryTree[this.attachmentCounter++]={id:e,type:ut.J.Attachment}}},{key:"getSummaryTree",value:function(){return{summary:this.summary,stats:this.stats}}}]),e}();function Oi(e){for(var t=new Pi,r=0,n=Object.entries(e.blobs);r<n.length;r++){var i=(0,F.Z)(n[r],2),a=i[0],o=i[1],s=void 0;if(void 0!==e.blobsContents){var u=e.blobsContents[o];void 0!==u&&(s=(0,Q.zT)(u,"utf-8"))}else void 0!==e.blobs[o]&&(s=(0,Rr.fW)(e.blobs[o]));void 0!==s&&t.addBlob(a,s)}for(var c=0,l=Object.entries(e.trees);c<l.length;c++){var h=(0,F.Z)(l[c],2),d=h[0],f=Oi(h[1]);t.addWithStats(d,f)}var v=t.getSummaryTree();return v.summary.unreferenced=e.unreferenced,v}function Di(e){for(var t=[],r=0,n=Object.entries(e.tree);r<n.length;r++){var i=(0,F.Z)(n[r],2),a=i[0],o=i[1];switch(o.type){case ut.J.Blob:var s=void 0,u="utf-8";"string"===typeof o.content?s=o.content:(s=(0,Q.IN)(o.content,"base64"),u="base64"),t.push(new Ir.Qp(a,s,u));break;case ut.J.Tree:t.push(new Ir.VN(a,Di(o)));break;case ut.J.Attachment:t.push(new Ir.sG(a,o.id));break;case ut.J.Handle:throw new Error("Should not have Handle type in summary tree");default:(0,ur.U)(o,"Unexpected summary tree type")}}return{entries:t,unreferenced:e.unreferenced}}function Ni(e){return e.replace(/\/+$/g,"")}var Mi=function(){function e(){(0,n.Z)(this,e),this.gcNodesSet={}}return(0,i.Z)(e,[{key:"gcNodes",get:function(){for(var e={},t=0,r=Object.entries(this.gcNodesSet);t<r.length;t++){var n=(0,F.Z)(r[t],2),i=n[0],a=n[1];e[i]=(0,p.Z)(a)}return e}},{key:"addNode",value:function(e,t){this.gcNodesSet[e]=new Set(t)}},{key:"prefixAndAddNodes",value:function(e,t){for(var r=0,n=Object.entries(t);r<n.length;r++){var i=(0,F.Z)(n[r],2),a=i[0],o=i[1],s=a.replace(/^\/+/g,"");s=Ni(s="/".concat(e,"/").concat(s)),this.gcNodesSet[s]=new Set(o)}}},{key:"addNodes",value:function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=(0,F.Z)(r[t],2),i=n[0],a=n[1];this.gcNodesSet[i]=new Set(a)}}},{key:"addRouteToAllNodes",value:function(e){for(var t=0,r=Object.values(this.gcNodesSet);t<r.length;t++){r[t].add(e)}}},{key:"getGCData",value:function(){return{gcNodes:this.gcNodes}}}]),e}();function ji(e,t){return _i.apply(this,arguments)}function _i(){return _i=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.readBlob(r);case 2:return n=e.sent,i=(0,Q.zT)(n,"utf8"),e.abrupt("return",JSON.parse(i));case 5:case"end":return e.stop()}}),e)}))),_i.apply(this,arguments)}function Ai(e){var t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}var Ei=function(){function e(t,r,i,a){(0,n.Z)(this,e),this.tree=t,this.storage=r,this.logger=i,this.extraBlobs=a,this.flattenedTree={},void 0!==t&&e.flattenTree("",t,this.flattenedTree)}return(0,i.Z)(e,[{key:"contains",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0!==this.flattenedTree[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readBlob",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdForPath(t);case 2:if(r=e.sent,void 0===(n=void 0!==this.extraBlobs?this.extraBlobs.get(r):void 0)){e.next=6;break}return e.abrupt("return",n);case 6:return(i=this.storage.readBlob(r)).catch((function(e){return o.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e)})),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"list",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=this.tree,i=Ai(t);void 0!==n&&i.length>0;)o=i.shift(),n=n.trees[o];if(void 0!==n&&0===i.length){e.next=5;break}throw new Error("path does not exist");case 5:return e.abrupt("return",Object.keys(null!==(r=null===n||void 0===n?void 0:n.blobs)&&void 0!==r?r:{}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIdForPath",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.flattenedTree[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"flattenTree",value:function(t,r,n){for(var i in r.trees)e.flattenTree("".concat(t).concat(i,"/"),r.trees[i],n);for(var a in r.blobs)n["".concat(t).concat(a)]=r.blobs[a]}}]),e}(),Fi=function(){function e(t,r,i,a){(0,n.Z)(this,e),this._connected=t,this.submit=r,this.dirty=i,this.addedGCOutboundReference=a}return(0,i.Z)(e,[{key:"handler",get:function(){return(0,B.h)(!!this._handler,375),this._handler}},{key:"connected",get:function(){return this._connected}},{key:"attach",value:function(e){(0,B.h)(void 0===this._handler,376),this._handler=e}},{key:"setConnectionState",value:function(e){this._connected=e,this.handler.setConnectionState(e)}},{key:"process",value:function(e,t,r){try{this.handler.process(e,t,r)}catch(V){throw Xn.wrapIfUnrecognized(V,"channelDeltaConnectionFailedToProcessMessage",e)}}},{key:"reSubmit",value:function(e,t){this.handler.reSubmit(e,t)}},{key:"rollback",value:function(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}},{key:"applyStashedOp",value:function(e){return this.handler.applyStashedOp(e)}}]),e}(),Ri=".attributes";function zi(e,t,r,n,i,a,o,s){return{deltaConnection:new Fi(e,(function(e,r){return t(e,r)}),r,n),objectStorage:new Ei(o,i,a,s)}}function Bi(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,i=e.getAttachSummary(t,r,n);return Ti(i,Ri,JSON.stringify(e.attributes)),i}function Li(e){return Vi.apply(this,arguments)}function Vi(){return Vi=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o,s,u=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]&&u[1],n=u.length>2&&void 0!==u[2]&&u[2],i=u.length>3?u[3]:void 0,o=u.length>4?u[4]:void 0,e.next=6,t.summarize(r,n,i,o);case 6:return Ti(s=e.sent,Ri,JSON.stringify(t.attributes)),e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)}))),Vi.apply(this,arguments)}function qi(e,t,r,n,i){return Hi.apply(this,arguments)}function Hi(){return(Hi=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o){var s,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.objectStorage.contains(Ri);case 2:if(!e.sent){e.next=6;break}return e.next=5,ji(r.objectStorage,Ri);case 5:s=e.sent;case 6:if(void 0!==(u=s?s.type:o)){e.next=9;break}throw new Qn("channelTypeNotAvailable",{channelId:{value:n,tag:Gn.CodeArtifact},dataStoreId:{value:t.id,tag:Gn.CodeArtifact},dataStorePackagePath:t.packagePath.join("/"),channelFactoryType:o});case 9:if(void 0!==(c=i.get(u))){e.next=12;break}throw new Qn("channelFactoryNotRegisteredForGivenType",{channelId:{value:n,tag:Gn.CodeArtifact},dataStoreId:{value:t.id,tag:Gn.CodeArtifact},dataStorePackagePath:t.packagePath.join("/"),channelFactoryType:u});case 12:return s=null!==s&&void 0!==s?s:c.attributes,e.abrupt("return",{factory:c,attributes:s});case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gi(e,t,r,n,i,a){return Ki.apply(this,arguments)}function Ki(){return(Ki=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i,o,s){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==r.snapshotFormatVersion&&r.snapshotFormatVersion!==n.attributes.snapshotFormatVersion&&o.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:r.type,tag:Gn.CodeArtifact},channelSnapshotVersion:{value:"".concat(r.snapshotFormatVersion,"@").concat(r.packageVersion),tag:Gn.CodeArtifact},channelCodeVersion:{value:"".concat(n.attributes.snapshotFormatVersion,"@").concat(n.attributes.packageVersion),tag:Gn.CodeArtifact}}),e.abrupt("return",n.load(t,s,i,r));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ui,Ji=function(){function e(t,r,i,a,o){(0,n.Z)(this,e),this.id=t,this.runtime=r,this.services=i,this.channelP=a,this._channel=o,this.globallyVisible=!1,this.pending=[],(0,B.h)(!this.id.includes("/"),783)}return(0,i.Z)(e,[{key:"getChannel",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this._channel){e.next=2;break}return e.abrupt("return",this.channelP.then((function(e){return t._channel=e})));case 2:return e.abrupt("return",this.channelP);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isLoaded",get:function(){return void 0!==this._channel}},{key:"setConnectionState",value:function(e,t){this.globallyVisible&&this.isLoaded&&this.services.value.deltaConnection.setConnectionState(e)}},{key:"processOp",value:function(e,t,r){(0,B.h)(this.globallyVisible,723),this.isLoaded?this.services.value.deltaConnection.process(e,t,r):((0,B.h)(!1===t,393),this.pending.push(e))}},{key:"reSubmit",value:function(e,t){(0,B.h)(this.isLoaded,394),(0,B.h)(this.globallyVisible,724),this.services.value.deltaConnection.reSubmit(e,t)}},{key:"rollback",value:function(e,t){(0,B.h)(this.isLoaded,750),(0,B.h)(this.globallyVisible,751),this.services.value.deltaConnection.rollback(e,t)}},{key:"applyStashedOp",value:function(){throw new Error("no stashed ops on local channel")}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i,o=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1&&void 0!==o[1]&&o[1],n=o.length>2?o[2]:void 0,e.next=5,this.getChannel();case 5:return i=e.sent,e.abrupt("return",Li(i,t,r,n));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAttachSummary",value:function(e){return(0,B.h)(void 0!==this._channel,397),Bi(this._channel,!0,!1,e)}},{key:"makeVisible",value:function(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&((0,B.h)(!!this._channel,402),this._channel.connect(this.services.value)),this.globallyVisible=!0}},{key:"getGCData",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.getChannel();case 3:return r=e.sent,e.abrupt("return",r.getGCData(t));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e){}}]),e}(),Wi=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,s,u,c,l,h,d,f,v){var p;return(0,n.Z)(this,r),(p=t.call(this,e,s,new oe.o((function(){var e=new Map,t=cn()(p.snapshotTree);return p.isSnapshotInOldFormatAndCollectBlobs(t,e)&&p.sanitizeSnapshot(t),zi(u.connected,h,p.dirtyFn,f,c,l,t,e)})),new sr.d((0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,o,c,h,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,qi(u,p.services.value,p.id,i);case 3:return t=e.sent,r=t.attributes,n=t.factory,e.next=8,Gi(s,r,n,p.services.value,l,p.id);case 8:o=e.sent,c=(0,R.Z)(p.pending);try{for(c.s();!(h=c.n()).done;)d=h.value,p.services.value.deltaConnection.process(d,!1,void 0)}catch(a){c.e(a)}finally{c.f()}return e.abrupt("return",o);case 14:throw e.prev=14,e.t0=e.catch(0),Xn.wrapIfUnrecognized(e.t0,"rehydratedLocalChannelContextFailedToLoadChannel",void 0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])})))))).snapshotTree=v,p.dirtyFn=function(){d(e)},p}return(0,i.Z)(r,[{key:"isSnapshotInOldFormatAndCollectBlobs",value:function(e,t){var r=!1,n=e.blobsContents;Object.entries(n).forEach((function(n){var i=(0,F.Z)(n,2),a=i[0],o=i[1];t.set(a,o),void 0!==e.blobs[a]&&(r=!0)}));for(var i=0,a=Object.values(e.trees);i<a.length;i++){var o=a[i];r=r||this.isSnapshotInOldFormatAndCollectBlobs(o,t)}return r}},{key:"sanitizeSnapshot",value:function(e){var t,r=new Map(Object.entries(e.blobs)),n=(0,R.Z)(r.entries());try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=i[0],o=i[1];void 0===r.get(o)&&delete e.blobs[a]}}catch(l){n.e(l)}finally{n.f()}for(var s=0,u=Object.values(e.trees);s<u.length;s++){var c=u[s];this.sanitizeSnapshot(c)}}}]),r}(Ji),Qi=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,a,o,s,u,c,l,h,d){var f;(0,n.Z)(this,r),(0,B.h)(void 0!==a,521);var v=i.get(a);if(void 0===v)throw new Error("Channel Factory ".concat(a," not registered"));var p=v.create(o,e);return(f=t.call(this,e,o,new oe.o((function(){return zi(s.connected,l,f.dirtyFn,d,u,c)})),Promise.resolve(p),p)).channel=p,f.dirtyFn=function(){h(e)},f}return(0,i.Z)(r)}(Ji),Xi=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;(0,n.Z)(this,e),this.threshold=t,this.logger=r,this.thresholdMultiple=i}return(0,i.Z)(e,[{key:"send",value:function(e,t){t<this.threshold||this.logger.sendPerformanceEvent({eventName:e,value:t})}},{key:"sendIfMultiple",value:function(e,t){t===this.thresholdMultiple&&(this.logger.sendPerformanceEvent({eventName:e,value:t}),this.thresholdMultiple=2*this.thresholdMultiple)}}]),e}(),Yi=function(){function e(t,r,i,s,u,c,l,h,d,f,v,p){var y=this;(0,n.Z)(this,e),this.id=l,this.isLoaded=!1,this.pending=[],(0,B.h)(!this.id.includes("/"),784),this.subLogger=ti.create(t.logger,"RemoteChannelContext"),this.services=zi(r.connected,s,(function(){return u(y.id)}),c,i,this.subLogger,h,f),this.channelP=new sr.d((0,o.Z)((0,a.Z)().mark((function e(){var n,i,o,s,u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,qi(r,y.services,y.id,d,p);case 2:return n=e.sent,i=n.attributes,o=n.factory,e.next=7,Gi(t,i,o,y.services,y.subLogger,y.id);case 7:s=e.sent,(0,B.h)(void 0!==y.pending,575),u=(0,R.Z)(y.pending);try{for(u.s();!(c=u.n()).done;)l=c.value,y.services.deltaConnection.process(l,!1,void 0)}catch(a){u.e(a)}finally{u.f()}return y.thresholdOpsCounter.send("ProcessPendingOps",y.pending.length),y.channel=s,y.pending=void 0,y.isLoaded=!0,y.services.deltaConnection.setConnectionState(r.connected),e.abrupt("return",y.channel);case 17:case"end":return e.stop()}}),e)}))));var g=function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.summarizeInternal(t,r,n,i));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}();this.summarizerNode=v(g,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y.getGCDataInternal(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.thresholdOpsCounter=new Xi(e.pendingOpsCountThreshold,this.subLogger)}return(0,i.Z)(e,[{key:"getChannel",value:function(){return this.channelP}},{key:"setConnectionState",value:function(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}},{key:"applyStashedOp",value:function(e){return(0,B.h)(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}},{key:"processOp",value:function(e,t,r){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,r):((0,B.h)(!t,405),(0,B.h)(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}},{key:"reSubmit",value:function(e,t){(0,B.h)(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}},{key:"rollback",value:function(e,t){(0,B.h)(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],r=!(i.length>1&&void 0!==i[1])||i[1],n=i.length>2?i[2]:void 0,e.abrupt("return",this.summarizerNode.summarize(t,r,n));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"summarizeInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r,n,i){var o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getChannel();case 2:return o=e.sent,e.next=5,Li(o,t,r,n,i);case 5:return s=e.sent,e.abrupt("return",Object.assign(Object.assign({},s),{id:this.id}));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"getGCData",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]&&r[0],e.abrupt("return",this.summarizerNode.getGCData(t));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getGCDataInternal",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.next=3,this.getChannel();case 3:return r=e.sent,e.abrupt("return",r.getGCData(t));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e){this.summarizerNode.updateUsedRoutes([""])}}]),e}();Yi.pendingOpsCountThreshold=1e3,function(e){e.Attach="attach",e.ChannelOp="op"}(Ui||(Ui={}));var $i=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,i,s,c){var l,h,d;(0,n.Z)(this,r),(l=t.call(this)).dataStoreContext=e,l.sharedObjectRegistry=i,l._disposed=!1,l.contexts=new Map,l.contextsDeferred=new Map,l.pendingAttach=new Map,l.deferredAttached=new sr.B,l.localChannelContextQueue=new Map,l.notBoundedChannelContextSet=new Set,l.pendingHandlesToMakeVisible=new Set,(0,B.h)(!e.id.includes("/"),782),l.mc=di(d=ti.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:(0,H.Z)()}}))?d:fi(d,ai.value),l.id=e.id,l.options=e.options,l.deltaManager=e.deltaManager,l.quorum=e.getQuorum(),l.audience=e.getAudience();var f=e.baseSnapshot;if(void 0!==(null===f||void 0===f?void 0:f.trees)&&Object.keys(f.trees).forEach((function(t){if("_search"!==t){var r;e.isLocalDataStore?(r=new Wi(t,l.sharedObjectRegistry,(0,z.Z)(l),l.dataStoreContext,l.dataStoreContext.storage,l.logger,(function(e,r){return l.submitChannelOp(t,e,r)}),(function(e){return l.setChannelDirty(e)}),(function(e,t){return l.addedGCOutboundReference(e,t)}),f.trees[t]),e.attachState!==ne.m.Detached?r.makeVisible():l.localChannelContextQueue.set(t,r)):r=new Yi((0,z.Z)(l),e,e.storage,(function(e,r){return l.submitChannelOp(t,e,r)}),(function(e){return l.setChannelDirty(e)}),(function(e,t){return l.addedGCOutboundReference(e,t)}),t,f.trees[t],l.sharedObjectRegistry,void 0,l.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:gi.XK.FromSummary}));var n=new sr.B;n.resolve(r),l.contexts.set(t,r),l.contextsDeferred.set(t,n)}})),c){var v=new sr.d((0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c((0,z.Z)(l)));case 1:case"end":return e.stop()}}),e)}))));l.entryPoint=new u(v,"",l.objectsRoutingContext)}return l.attachListener(),l._attachState=e.attachState,l.visibilityState=s?e.attachState===ne.m.Detached?gi.Bl.LocallyVisible:gi.Bl.GloballyVisible:gi.Bl.NotVisible,s&&l.deferredAttached.resolve(),l.localChangesTelemetryCount=null!==(h=l.mc.config.getNumber("Fluid.Telemetry.LocalChangesTelemetryCount"))&&void 0!==h?h:10,l}return(0,i.Z)(r,[{key:"IFluidRouter",get:function(){return this}},{key:"connected",get:function(){return this.dataStoreContext.connected}},{key:"clientId",get:function(){return this.dataStoreContext.clientId}},{key:"clientDetails",get:function(){return this.dataStoreContext.clientDetails}},{key:"isAttached",get:function(){return this.attachState!==ne.m.Detached}},{key:"attachState",get:function(){return this._attachState}},{key:"absolutePath",get:function(){return s(this.id,this.routeContext)}},{key:"routeContext",get:function(){return this.dataStoreContext.IFluidHandleContext}},{key:"idCompressor",get:function(){return this.dataStoreContext.idCompressor}},{key:"IFluidHandleContext",get:function(){return this}},{key:"rootRoutingContext",get:function(){return this}},{key:"channelsRoutingContext",get:function(){return this}},{key:"objectsRoutingContext",get:function(){return this}},{key:"disposed",get:function(){return this._disposed}},{key:"logger",get:function(){return this.mc.logger}},{key:"ensureNoDataModelChanges",value:function(e){return void 0===this.dataStoreContext.ensureNoDataModelChanges?e():this.dataStoreContext.ensureNoDataModelChanges(e)}},{key:"dispose",value:function(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}},{key:"resolveHandle",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.request(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=bi.create(t),"_channels"!==(n=r.pathParts[0])&&"_custom"!==n){e.next=5;break}return e.abrupt("return",this.request(r.createSubRequest(1)));case 5:if(!this.contextsDeferred.has(n)||!r.isLeaf(1)){e.next=20;break}return e.prev=6,e.next=9,this.contextsDeferred.get(n).promise;case 9:return i=e.sent,e.next=12,i.getChannel();case 12:return o=e.sent,e.abrupt("return",{mimeType:"fluid/object",status:200,value:o});case 16:return e.prev=16,e.t0=e.catch(6),this.mc.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},e.t0),e.abrupt("return",Zi(500,"Failed to get Channel: ".concat(e.t0),t));case 20:return e.abrupt("return",wi(t));case 23:return e.prev=23,e.t1=e.catch(0),e.abrupt("return",mi(e.t1));case 26:case"end":return e.stop()}}),e,this,[[0,23],[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannel",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),this.contextsDeferred.has(t)||this.contextsDeferred.set(t,new sr.B),e.next=4,this.contextsDeferred.get(t).promise;case 4:return r=e.sent,e.next=7,r.getChannel();case 7:return n=e.sent,e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,H.Z)(),r=arguments.length>1?arguments[1]:void 0;if(t.includes("/"))throw new Wn("Id cannot contain slashes: ".concat(t));this.verifyNotClosed(),(0,B.h)(!this.contexts.has(t),377),this.notBoundedChannelContextSet.add(t);var n=new Qi(t,this.sharedObjectRegistry,r,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(function(r,n){return e.submitChannelOp(t,r,n)}),(function(t){return e.setChannelDirty(t)}),(function(t,r){return e.addedGCOutboundReference(t,r)}));if(this.contexts.set(t,n),this.contextsDeferred.has(t))this.contextsDeferred.get(t).resolve(n);else{var i=new sr.B;i.resolve(n),this.contextsDeferred.set(t,i)}return this.identifyLocalChangeInSummarizer("DDSCreatedInSummarizer",t,r),n.channel}},{key:"bindChannel",value:function(e){(0,B.h)(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}},{key:"makeVisibleAndAttachGraph",value:function(){this.visibilityState===gi.Bl.NotVisible&&(this.visibilityState=gi.Bl.LocallyVisible,this.pendingHandlesToMakeVisible.forEach((function(e){e.attachGraph()})),this.pendingHandlesToMakeVisible.clear(),this.dataStoreContext.makeLocallyVisible())}},{key:"attachGraph",value:function(){this.makeVisibleAndAttachGraph()}},{key:"bindToContext",value:function(){this.makeVisibleAndAttachGraph()}},{key:"bind",value:function(e){this.visibilityState===gi.Bl.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}},{key:"setConnectionState",value:function(e,t){this.verifyNotClosed();var r,n=(0,R.Z)(this.contexts);try{for(n.s();!(r=n.n()).done;){(0,F.Z)(r.value,2)[1].setConnectionState(e,t)}}catch(i){n.e(i)}finally{n.f()}!function(e,t,r,n,i){try{r?t.emit("connected",n):t.emit("disconnected",i)}catch(V){e.sendErrorEvent({eventName:"RaiseConnectedEventError"},V)}}(this.logger,this,e,t)}},{key:"getQuorum",value:function(){return this.quorum}},{key:"getAudience",value:function(){return this.audience}},{key:"uploadBlob",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyNotClosed(),e.abrupt("return",this.dataStoreContext.uploadBlob(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"process",value:function(e,t,r){var n=this;this.verifyNotClosed();try{switch(e.type){case Ui.Attach:var i=e.contents,a=i.id;if(t)(0,B.h)(this.pendingAttach.has(a),380),this.pendingAttach.delete(a);else{(0,B.h)(!this.contexts.has(a),381);var o=new Map,s=function(e,t){var r=yi(e,t);return(0,Ir.eB)(r)}(i.snapshot.entries,o),u=new Yi(this,this.dataStoreContext,this.dataStoreContext.storage,(function(e,t){return n.submitChannelOp(a,e,t)}),(function(e){return n.setChannelDirty(e)}),(function(e,t){return n.addedGCOutboundReference(e,t)}),a,s,this.sharedObjectRegistry,o,this.dataStoreContext.getCreateChildSummarizerNodeFn(a,{type:gi.XK.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:i.snapshot}),i.type);if(this.contexts.set(a,u),this.contextsDeferred.has(a))this.contextsDeferred.get(a).resolve(u);else{var c=new sr.B;c.resolve(u),this.contextsDeferred.set(a,c)}}break;case Ui.ChannelOp:this.processChannelOp(e,t,r)}this.emit("op",e)}catch(V){throw Xn.wrapIfUnrecognized(V,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}},{key:"processSignal",value:function(e,t){this.emit("signal",e,t)}},{key:"isChannelAttached",value:function(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}},{key:"getOutboundRoutes",value:function(){var e,t=[],r=(0,R.Z)(this.contexts);try{for(r.s();!(e=r.n()).done;){var n=(0,F.Z)(e.value,1)[0];t.push("".concat(this.absolutePath,"/").concat(n))}}catch(i){r.e(i)}finally{r.f()}return t}},{key:"updateGCNodes",value:function(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}},{key:"getGCData",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n=this,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],r=new Mi,e.next=4,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,F.Z)(e,2),r=t[0];t[1];return n.isChannelAttached(r)})).map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(n){var i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,F.Z)(n,2),o=i[0],s=i[1],e.next=3,s.getGCData(t);case 3:u=e.sent,r.prefixAndAddNodes(o,u.gcNodes);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return this.updateGCNodes(r),e.abrupt("return",r.getGCData());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateUsedRoutes",value:function(e){var t,r,n=function(e){var t,r=e.filter((function(e){return""!==e&&"/"!==e})),n=new Map,i=(0,R.Z)(r);try{for(i.s();!(t=i.n()).done;){var a=t.value;(0,B.h)(a.startsWith("/"),1504);var o=a.split("/")[1],s=a.slice(o.length+1),u=n.get(o);void 0!==u?u.push(s):n.set(o,[s])}}catch(c){i.e(c)}finally{i.f()}return n}(e),i=(0,R.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,F.Z)(r.value,1)[0];(0,B.h)(this.contexts.has(a),382)}}catch(l){i.e(l)}finally{i.f()}var o,s=(0,R.Z)(this.contexts);try{for(s.s();!(o=s.n()).done;){var u=(0,F.Z)(o.value,2),c=u[0];u[1].updateUsedRoutes(null!==(t=n.get(c))&&void 0!==t?t:[])}}catch(l){s.e(l)}finally{s.f()}}},{key:"addedGCOutboundReference",value:function(e,t){var r,n;null===(n=(r=this.dataStoreContext).addedGCOutboundReference)||void 0===n||n.call(r,e,t)}},{key:"summarize",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,r,n,i,s=this,u=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]&&u[0],r=!(u.length>1&&void 0!==u[1])||u[1],n=u.length>2?u[2]:void 0,i=new Pi,e.next=6,Promise.all(Array.from(this.contexts).filter((function(e){var t=(0,F.Z)(e,2),r=t[0],n=(t[1],s.isChannelAttached(r));return(0,B.h)(n,383),n})).map(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(o){var s,u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,F.Z)(o,2),u=s[0],c=s[1],e.next=3,c.summarize(t,r,n);case 3:l=e.sent,i.addWithStats(u,l);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:return e.abrupt("return",i.getSummaryTree());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAttachSummary",value:function(e){this.attachGraph();var t,r=new Pi,n=(0,R.Z)(this.contexts);try{for(n.s();!(t=n.n()).done;){var i=(0,F.Z)(t.value,2),a=i[0],o=i[1];if(!(o instanceof Ji))throw new Kn("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(a)){var s=void 0;if(o.isLoaded){var u=o.getAttachSummary(e);(0,B.h)(u.summary.type===ut.J.Tree,384),s={stats:u.stats,summary:u.summary}}else(0,B.h)(!!this.dataStoreContext.baseSnapshot,385),s=Oi(this.dataStoreContext.baseSnapshot.trees[a]);r.addWithStats(a,s)}}}catch(c){n.e(c)}finally{n.f()}return r.getSummaryTree()}},{key:"submitMessage",value:function(e,t,r){this.submit(e,t,r)}},{key:"submitSignal",value:function(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}},{key:"waitAttached",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deferredAttached.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"attachChannel",value:function(e){if(this.verifyNotClosed(),!e.handle.isAttached){e.handle.attachGraph(),(0,B.h)(this.isAttached,386),(0,B.h)(this.visibilityState===gi.Bl.GloballyVisible,720);var t=Di(Bi(e,!0,!1).summary),r={id:e.id,snapshot:t,type:e.attributes.type};this.pendingAttach.set(e.id,r),this.submit(Ui.Attach,r),this.contexts.get(e.id).makeVisible()}}},{key:"submitChannelOp",value:function(e,t,r){var n={address:e,contents:t};this.submit(Ui.ChannelOp,n,r)}},{key:"submit",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,r)}},{key:"reSubmit",value:function(e,t,r){switch(this.verifyNotClosed(),e){case Ui.ChannelOp:var n=t,i=this.contexts.get(n.address);(0,B.h)(!!i,387),i.reSubmit(n.contents,r);break;case Ui.Attach:this.submit(e,t,r);break;default:(0,ur.U)(e)}}},{key:"rollback",value:function(e,t,r){if(this.verifyNotClosed(),e!==Ui.ChannelOp)throw new Kn("Can't rollback ".concat(e," message"));var n=t,i=this.contexts.get(n.address);(0,B.h)(!!i,749),i.rollback(n.contents,r)}},{key:"applyStashedOp",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,n=this.contexts.get(r.address),(0,B.h)(!!n,388),e.next=5,n.getChannel();case 5:return e.abrupt("return",n.applyStashedOp(r.contents));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelDirty",value:function(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}},{key:"processChannelOp",value:function(e,t,r){this.verifyNotClosed();var n=e.contents,i=Object.assign(Object.assign({},e),{contents:n.contents}),a=this.contexts.get(n.address);return(0,B.h)(!!a,389),a.processOp(i,t,r),a}},{key:"attachListener",value:function(){var e=this;this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",(function(){e.attachGraph(),e._attachState=ne.m.Attaching,(0,B.h)(e.visibilityState===gi.Bl.LocallyVisible,721),e.visibilityState=gi.Bl.GloballyVisible,e.localChannelContextQueue.forEach((function(e){e.makeVisible()})),e.localChannelContextQueue.clear(),e.deferredAttached.resolve(),e.emit("attaching")})),this.dataStoreContext.once("attached",(function(){(0,B.h)(e.visibilityState===gi.Bl.GloballyVisible,722),e._attachState=ne.m.Attached,e.emit("attached")}))}},{key:"verifyNotClosed",value:function(){if(this._disposed)throw new Kn("Runtime is closed")}},{key:"identifyLocalChangeInSummarizer",value:function(e,t,r){var n;"summarizer"!==this.clientDetails.type||this.localChangesTelemetryCount<=0||(this.mc.logger.sendTelemetryEvent({eventName:e,channelType:r,channelId:{value:t,tag:Gn.CodeArtifact},fluidDataStoreId:{value:this.id,tag:Gn.CodeArtifact},fluidDataStorePackagePath:(n=this.dataStoreContext.packagePath,n?{value:n.join("/"),tag:Gn.CodeArtifact}:void 0),stack:Rn()}),this.localChangesTelemetryCount--)}}],[{key:"load",value:function(e,t,n){return new r(e,t,n,function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ci(t,"/"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}]),r}(L.L),ea=function(){function e(t,r,i){(0,n.Z)(this,e),this.ctor=t,this.optionalProviders=r,this.contractAdapters=i,this.type="LoopObject"}return(0,i.Z)(e,[{key:"instantiateLoopComponent",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,r){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.optionalProviders&&(null===r||void 0===r?void 0:r.synthesize(this.optionalProviders,void 0))||void 0,e.abrupt("return",h(new this.ctor(t,n),this.contractAdapters));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}(),ta=function(e){(0,_.Z)(r,e);var t=(0,A.Z)(r);function r(e,s,u,c,l,h,d){var v;return(0,n.Z)(this,r),v=t.call(this,e,s,u,c,function(e){if(!e)return;var t=new Map;return e.forEach((function(e,r){"FluidObject"===e.factory.type&&t.set(r,e.factory.factory)})),t}(l),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$i,t=arguments.length>1?arguments[1]:void 0;return function(e){return function(t){(0,_.Z)(s,t);var r=(0,A.Z)(s);function s(){return(0,n.Z)(this,s),r.apply(this,arguments)}return(0,i.Z)(s,[{key:"request",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(r){var n;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,te.Z)((0,re.Z)(s.prototype),"request",this).call(this,r);case 2:if(404!==(n=t.sent).status){t.next=5;break}return t.abrupt("return",e(r,this));case 5:return t.abrupt("return",n);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),s}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:$i)}(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(r,n){var i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pn.getDataObject(n);case 2:return i=e.sent,o=f(i,t,n,""),e.abrupt("return",o.request(r));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e)}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$i;return function(e){return function(t){(0,_.Z)(s,t);var r=(0,A.Z)(s);function s(){return(0,n.Z)(this,s),r.apply(this,arguments)}return(0,i.Z)(s,[{key:"addBlob",value:function(e,t,r){var n=t.shift();if(void 0===n)throw new Kn("Path can't be empty");var i={type:ut.J.Blob,content:r};e.stats.blobNodeCount++,e.stats.totalBlobSize+=r.length;var a,o=(0,R.Z)(t.reverse());try{for(o.s();!(a=o.n()).done;){var s=a.value;i={type:ut.J.Tree,tree:(0,E.Z)({},s,i)},e.stats.treeNodeCount++}}catch(u){o.e(u)}finally{o.f()}e.summary.tree[n]=i}},{key:"summarize",value:function(){var t=(0,o.Z)((0,a.Z)().mark((function t(){var r,n,i,o,u,c,l=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=l.length,i=new Array(n),o=0;o<n;o++)i[o]=l[o];return t.next=3,(r=(0,te.Z)((0,re.Z)(s.prototype),"summarize",this)).call.apply(r,[this].concat(i));case 3:return u=t.sent,t.next=6,e(this);case 6:return void 0!==(c=t.sent)&&this.addBlob(u,c.path,c.content),t.abrupt("return",u);case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()}]),s}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:$i)}(function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){var r,n,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pn.getDataObject(t);case 2:if(r=e.sent,void 0!==(n=r.SearchContent)){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.next=8,n.getSearchContent();case 8:if(void 0!==(i=e.sent)){e.next=11;break}return e.abrupt("return",void 0);case 11:return o=i.endsWith("\n")?i:i+"\n",e.abrupt("return",{path:["_search","01"],content:o});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e)}(h),d)),v.registryEntries=l,v.contractAdapters=d,v}return(0,i.Z)(r,[{key:"getSubComponentRegistryInfo",value:function(e){var t;return null===(t=this.registryEntries)||void 0===t?void 0:t.get(e)}},{key:"SubComponentRegistryDataProvider",get:function(){return this}}]),r}(xn);var ra="data-fluid-objectid",na=0;var ia=Symbol("ownerComponent"),aa=Symbol("target"),oa=function(){function e(t){(0,n.Z)(this,e),this.ownerComponent=new WeakRef(t)}return(0,i.Z)(e,[{key:"has",value:function(e,t){return t===aa||t===ia||Reflect.has(e,t)}},{key:"get",value:function(e,t,r){var n=this;if(t===aa)return e;if(t===ia)return this.ownerComponent.deref();var i,s=Reflect.get(e,t,r);if((i=s)&&!0===i._isMockFunction)return s;switch(t){case"HTMLViewable":case"IFluidHTMLView":case"HTMLView":case"ComponentCanvasProvider":return s?ua(s,this.ownerComponent.deref()):s;case"getView":case"getCanvasComponent":if(s instanceof Function)return(0,o.Z)((0,a.Z)().mark((function t(){var r,i,o,u,c,l=arguments;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=l.length,i=new Array(r),o=0;o<r;o++)i[o]=l[o];if(!((u=s.apply.apply(s,[sa(e)].concat(i)))instanceof Promise)){t.next=7;break}return t.next=5,u;case 5:return c=t.sent,t.abrupt("return",ua(c,n.ownerComponent.deref()));case 7:return t.abrupt("return",u);case 8:case"end":return t.stop()}}),t)})));break;case"render":if(s instanceof Function)return function(t,r){var i;return function(e,t){var r=function(e){var t;if(null!==(t=e.ComponentProperties)&&void 0!==t&&t.name)return e.ComponentProperties.name;if("constructor"in e){var r=e.constructor.name;return r.startsWith("_")&&(r=r.substring(1)),r}return"[Unknown]"}(t),n=!0,i=e.getAttribute(ra);if(i){var a=function(e){var t=e.lastIndexOf("-");return t<=0?null:e.substring(0,t)}(i);a===r&&(n=!1)}if(n){na+=1;var o="".concat(r,"-").concat(na);e.setAttribute(ra,o)}"WeakRef"in window&&(e.__fluid=new WeakRef(t))}(t,null!==(i=n.ownerComponent.deref())&&void 0!==i?i:e),s.apply(sa(e),[t,r])}}return s}}]),e}();function sa(e){var t;return null!==(t=e[aa])&&void 0!==t?t:e}function ua(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return e[ia]===t?e:new Proxy(e,new oa(t))}},30621:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityState=t.FlushModeExperimental=t.FlushMode=void 0,function(e){e[e.Immediate=0]="Immediate",e[e.TurnBased=1]="TurnBased"}(t.FlushMode||(t.FlushMode={})),function(e){e[e.Async=2]="Async"}(t.FlushModeExperimental||(t.FlushModeExperimental={})),t.VisibilityState={NotVisible:"NotVisible",LocallyVisible:"LocallyVisible",GloballyVisible:"GloballyVisible"}},84976:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreFactory=void 0,t.IFluidDataStoreFactory="IFluidDataStoreFactory"},48331:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IFluidDataStoreRegistry=void 0,t.IFluidDataStoreRegistry="IFluidDataStoreRegistry"},21216:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.gcDeletedBlobKey=t.gcTombstoneBlobKey=t.gcBlobPrefix=t.gcTreeKey=void 0,t.gcTreeKey="gc",t.gcBlobPrefix="__gc",t.gcTombstoneBlobKey="__tombstones",t.gcDeletedBlobKey="__deletedNodes"},96969:function(e,t,r){"use strict";t.XK=t.Bl=void 0;var n=r(30621);Object.defineProperty(t,"Bl",{enumerable:!0,get:function(){return n.VisibilityState}});var i=r(84976);var a=r(48331);var o=r(21216);var s=r(67355);Object.defineProperty(t,"XK",{enumerable:!0,get:function(){return s.CreateSummarizerNodeSource}})},67355:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.totalBlobSizePropertyName=t.blobCountPropertyName=t.channelsTreeName=t.CreateSummarizerNodeSource=void 0,function(e){e[e.FromSummary=0]="FromSummary",e[e.FromAttach=1]="FromAttach",e[e.Local=2]="Local"}(t.CreateSummarizerNodeSource||(t.CreateSummarizerNodeSource={})),t.channelsTreeName=".channels",t.blobCountPropertyName="BlobCount",t.totalBlobSizePropertyName="TotalBlobSize"},50908:function(e,t,r){var n=r(68136)(r(97009),"DataView");e.exports=n},78319:function(e,t,r){var n=r(68136)(r(97009),"Promise");e.exports=n},23924:function(e,t,r){var n=r(68136)(r(97009),"Set");e.exports=n},7091:function(e,t,r){var n=r(68136)(r(97009),"WeakMap");e.exports=n},4550:function(e){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},84903:function(e){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}},41705:function(e){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},11855:function(e,t,r){var n=r(64503),i=r(12742);e.exports=function(e,t){return e&&n(t,i(t),e)}},95076:function(e,t,r){var n=r(64503),i=r(73961);e.exports=function(e,t){return e&&n(t,i(t),e)}},31905:function(e,t,r){var n=r(22854),i=r(4550),a=r(18463),o=r(11855),s=r(95076),u=r(94523),c=r(10291),l=r(52455),h=r(57636),d=r(38248),f=r(55341),v=r(88383),p=r(39243),y=r(39759),g=r(40548),b=r(93629),m=r(5174),k=r(60103),C=r(8092),S=r(36995),w=r(12742),Z=r(73961),x="[object Arguments]",I="[object Function]",T="[object Object]",P={};P[x]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object DataView]"]=P["[object Boolean]"]=P["[object Date]"]=P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Map]"]=P["[object Number]"]=P[T]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object Symbol]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P["[object Error]"]=P[I]=P["[object WeakMap]"]=!1,e.exports=function e(t,r,O,D,N,M){var j,_=1&r,A=2&r,E=4&r;if(O&&(j=N?O(t,D,N,M):O(t)),void 0!==j)return j;if(!C(t))return t;var F=b(t);if(F){if(j=p(t),!_)return c(t,j)}else{var R=v(t),z=R==I||"[object GeneratorFunction]"==R;if(m(t))return u(t,_);if(R==T||R==x||z&&!N){if(j=A||z?{}:g(t),!_)return A?h(t,s(j,t)):l(t,o(j,t))}else{if(!P[R])return N?t:{};j=y(t,R,_)}}M||(M=new n);var B=M.get(t);if(B)return B;M.set(t,j),S(t)?t.forEach((function(n){j.add(e(n,r,O,n,t,M))})):k(t)&&t.forEach((function(n,i){j.set(i,e(n,r,O,i,t,M))}));var L=F?void 0:(E?A?f:d:A?Z:w)(t);return i(L||t,(function(n,i){L&&(n=t[i=n]),a(j,i,e(n,r,O,i,t,M))})),j}},61986:function(e,t,r){var n=r(41705),i=r(93629);e.exports=function(e,t,r){var a=t(e);return i(e)?a:n(a,r(e))}},53085:function(e,t,r){var n=r(88383),i=r(43141);e.exports=function(e){return i(e)&&"[object Map]"==n(e)}},48680:function(e,t,r){var n=r(88383),i=r(43141);e.exports=function(e){return i(e)&&"[object Set]"==n(e)}},43654:function(e,t,r){var n=r(62936),i=r(75964),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=[];for(var r in Object(e))a.call(e,r)&&"constructor"!=r&&t.push(r);return t}},61022:function(e,t,r){var n=r(7010);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},18503:function(e){var t=/\w*$/;e.exports=function(e){var r=new e.constructor(e.source,t.exec(e));return r.lastIndex=e.lastIndex,r}},64720:function(e,t,r){var n=r(87197),i=n?n.prototype:void 0,a=i?i.valueOf:void 0;e.exports=function(e){return a?Object(a.call(e)):{}}},52455:function(e,t,r){var n=r(64503),i=r(65918);e.exports=function(e,t){return n(e,i(e),t)}},57636:function(e,t,r){var n=r(64503),i=r(38487);e.exports=function(e,t){return n(e,i(e),t)}},38248:function(e,t,r){var n=r(61986),i=r(65918),a=r(12742);e.exports=function(e){return n(e,a,i)}},55341:function(e,t,r){var n=r(61986),i=r(38487),a=r(73961);e.exports=function(e){return n(e,a,i)}},65918:function(e,t,r){var n=r(84903),i=r(68174),a=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,s=o?function(e){return null==e?[]:(e=Object(e),n(o(e),(function(t){return a.call(e,t)})))}:i;e.exports=s},38487:function(e,t,r){var n=r(41705),i=r(31137),a=r(65918),o=r(68174),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,a(e)),e=i(e);return t}:o;e.exports=s},88383:function(e,t,r){var n=r(50908),i=r(95797),a=r(78319),o=r(23924),s=r(7091),u=r(39066),c=r(27907),l="[object Map]",h="[object Promise]",d="[object Set]",f="[object WeakMap]",v="[object DataView]",p=c(n),y=c(i),g=c(a),b=c(o),m=c(s),k=u;(n&&k(new n(new ArrayBuffer(1)))!=v||i&&k(new i)!=l||a&&k(a.resolve())!=h||o&&k(new o)!=d||s&&k(new s)!=f)&&(k=function(e){var t=u(e),r="[object Object]"==t?e.constructor:void 0,n=r?c(r):"";if(n)switch(n){case p:return v;case y:return l;case g:return h;case b:return d;case m:return f}return t}),e.exports=k},39243:function(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e){var r=e.length,n=new e.constructor(r);return r&&"string"==typeof e[0]&&t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},39759:function(e,t,r){var n=r(7010),i=r(61022),a=r(18503),o=r(64720),s=r(40613);e.exports=function(e,t,r){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return n(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,r);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return a(e);case"[object Symbol]":return o(e)}}},75964:function(e,t,r){var n=r(12709)(Object.keys,Object);e.exports=n},58121:function(e,t,r){var n=r(31905);e.exports=function(e){return n(e,5)}},60103:function(e,t,r){var n=r(53085),i=r(16194),a=r(49494),o=a&&a.isMap,s=o?i(o):n;e.exports=s},36995:function(e,t,r){var n=r(48680),i=r(16194),a=r(49494),o=a&&a.isSet,s=o?i(o):n;e.exports=s},12742:function(e,t,r){var n=r(47538),i=r(43654),a=r(21473);e.exports=function(e){return a(e)?n(e):i(e)}},68174:function(e){e.exports=function(){return[]}},5982:function(e){"use strict";function t(e){if("string"!==typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,a=-1,o=0,s=0;s<=e.length;++s){if(s<e.length)r=e.charCodeAt(s);else{if(47===r)break;r=47}if(47===r){if(a===s-1||1===o);else if(a!==s-1&&2===o){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var u=n.lastIndexOf("/");if(u!==n.length-1){-1===u?(n="",i=0):i=(n=n.slice(0,u)).length-1-n.lastIndexOf("/"),a=s,o=0;continue}}else if(2===n.length||1===n.length){n="",i=0,a=s,o=0;continue}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(a+1,s):n=e.slice(a+1,s),i=s-a-1;a=s,o=0}else 46===r&&-1!==o?++o:o=-1}return n}var n={resolve:function(){for(var e,n="",i=!1,a=arguments.length-1;a>=-1&&!i;a--){var o;a>=0?o=arguments[a]:(void 0===e&&(e=process.cwd()),o=e),t(o),0!==o.length&&(n=o+"/"+n,i=47===o.charCodeAt(0))}return n=r(n,!i),i?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var i=arguments[r];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r)return"";if((e=n.resolve(e))===(r=n.resolve(r)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var a=e.length,o=a-i,s=1;s<r.length&&47===r.charCodeAt(s);++s);for(var u=r.length-s,c=o<u?o:u,l=-1,h=0;h<=c;++h){if(h===c){if(u>c){if(47===r.charCodeAt(s+h))return r.slice(s+h+1);if(0===h)return r.slice(s+h)}else o>c&&(47===e.charCodeAt(i+h)?l=h:0===h&&(l=0));break}var d=e.charCodeAt(i+h);if(d!==r.charCodeAt(s+h))break;47===d&&(l=h)}var f="";for(h=i+l+1;h<=a;++h)h!==a&&47!==e.charCodeAt(h)||(0===f.length?f+="..":f+="/..");return f.length>0?f+r.slice(s+l):(s+=l,47===r.charCodeAt(s)&&++s,r.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,a=!0,o=e.length-1;o>=1;--o)if(47===(r=e.charCodeAt(o))){if(!a){i=o;break}}else a=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!==typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,i=0,a=-1,o=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var s=r.length-1,u=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!o){i=n+1;break}}else-1===u&&(o=!1,u=n+1),s>=0&&(c===r.charCodeAt(s)?-1===--s&&(a=n):(s=-1,a=u))}return i===a?a=u:-1===a&&(a=e.length),e.slice(i,a)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){i=n+1;break}}else-1===a&&(o=!1,a=n+1);return-1===a?"":e.slice(i,a)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,a=!0,o=0,s=e.length-1;s>=0;--s){var u=e.charCodeAt(s);if(47!==u)-1===i&&(a=!1,i=s+1),46===u?-1===r?r=s:1!==o&&(o=1):-1!==r&&(o=-1);else if(!a){n=s+1;break}}return-1===r||-1===i||0===o||1===o&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!==typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+e+n:n}("/",e)},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,i=e.charCodeAt(0),a=47===i;a?(r.root="/",n=1):n=0;for(var o=-1,s=0,u=-1,c=!0,l=e.length-1,h=0;l>=n;--l)if(47!==(i=e.charCodeAt(l)))-1===u&&(c=!1,u=l+1),46===i?-1===o?o=l:1!==h&&(h=1):-1!==o&&(h=-1);else if(!c){s=l+1;break}return-1===o||-1===u||0===h||1===h&&o===u-1&&o===s+1?-1!==u&&(r.base=r.name=0===s&&a?e.slice(1,u):e.slice(s,u)):(0===s&&a?(r.name=e.slice(1,o),r.base=e.slice(1,u)):(r.name=e.slice(s,o),r.base=e.slice(s,u)),r.ext=e.slice(o,u)),s>0?r.dir=e.slice(0,s-1):a&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n}}]);
//# sourceMappingURL=6906.0af829c7.chunk.js.map