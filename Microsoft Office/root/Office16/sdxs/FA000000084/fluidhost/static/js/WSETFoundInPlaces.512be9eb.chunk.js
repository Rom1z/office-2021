"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[9369],{70932:function(e,t,r){r.r(t),r.d(t,{WSETFoundInPlaces:function(){return F},getNonOdspSharingHistory:function(){return E},getOdspWsetSharingHistory:function(){return I}});var n=r(1413),a=r(74165),s=r(15671),u=r(43144),i=r(15861),o=r(39680);function c(e){var t=window.btoa(e);return t.replace(/(\+|\/|\=)/g,(function(e){if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError("Unexpected match ".concat(e," encountered in urlEncodeBase64String. Only +/= are to be replaced."))}))}var l=r(24466);function f(e,t,r){return p.apply(this,arguments)}function p(){return(p=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var s,u,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.siteUrl,u=r.driveId,i=r.fileId,e.next=3,(0,l.zU)(t,s,u,i,n);case 3:if(o=e.sent){e.next=6;break}throw new Error("Failed to fetch file sharepoint ids");case 6:return e.abrupt("return",h(o,i));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e,t){var r=e.siteId,n=e.webId,a=e.listId;return"SPO_".concat(c("".concat(r,",").concat(n,",").concat(a)),"_").concat(t)}var d=r(12338),v=r(37762);function g(e){return b.apply(this,arguments)}function b(){return(b=(0,i.Z)((0,a.Z)().mark((function e(t){var r,n,s,u,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=t.split("://")).length<2)){e.next=3;break}return e.abrupt("return","");case 3:return n=r[1],s=(new TextEncoder).encode(n),e.next=7,x(s);case 7:return u=e.sent,i="WL_"+m(y(u)),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=(0,i.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.digest("SHA-256",t);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){var t,r="",n=(0,v.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;switch(a){case"+":r+="-";break;case"/":r+="_";break;case"=":r+="";break;default:r+=a}}}catch(s){n.e(s)}finally{n.f()}return r}function y(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a+=1)t+=String.fromCharCode(r[a]);return window.btoa(t)}var w=r(29697),Z=function(e,t){return{getToken:function(e){return t.getToken(["https://substrate.office.com/Files.Read.All"],e)},url:e,requestInit:{method:"GET",headers:{Prefer:'exchange.behavior="SubstrateFiles,OpenComplexTypeExtensions"'}},retryPolicy:o.Uj}};function I(e,t,r){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)((0,a.Z)().mark((function e(t,r,s){var u,i,o,c,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={siteUrl:t.siteUrl,driveId:t.driveId,fileId:t.itemId},e.next=3,f(r,u);case 3:if(i=e.sent,o="https://substrate.office.com/api/beta/me/workingsetfiles('SPOID:".concat(i,"')?$select=AllExtensions/SharingHistory&$filter=ItemProperties/Shared/LastSharedWithMailboxOwnerDateTime ne null and Visualization/Type eq 'Fluid'"),c=Z(o,r),!s){e.next=12;break}return e.next=9,(0,d.Y)((0,n.Z)((0,n.Z)({},c),{},{logger:s,nameForLogging:"FoundInPlaces"}));case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,(0,d.h)(c);case 14:e.t0=e.sent;case 15:return l=e.t0,e.next=18,l.result.json().catch((function(e){s&&(0,w.D)(s,{eventName:"WsetApiJsonParsingError",subErrorName:"FluidLoopComponent"},e)}));case 18:return p=e.sent,e.abrupt("return",p.AllExtensions);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,r){return P.apply(this,arguments)}function P(){return(P=(0,i.Z)((0,a.Z)().mark((function e(t,r,s){var u,i,o,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t);case 2:if(""!==(u=e.sent)){e.next=5;break}return e.abrupt("return",{});case 5:if(i="https://substrate.office.com/api/beta/me/workingsetfiles?$select=AllExtensions/SharingHistory&$filter=ItemProperties/SharedFile/ExternalResourceId eq '".concat(u,"'"),o=Z(i,r),!s){e.next=13;break}return e.next=10,(0,d.Y)((0,n.Z)((0,n.Z)({},o),{},{logger:s,nameForLogging:"FoundInPlaces"}));case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,(0,d.h)(o);case 15:e.t0=e.sent;case 16:return c=e.t0,e.next=19,c.result.json().catch((function(e){s&&(0,w.D)(s,{eventName:"WsetApiJsonParsingError",subErrorName:"FluidNonLoopComponent"},e)}));case 19:if(0!==(l=e.sent).value.length){e.next=22;break}return e.abrupt("return",{});case 22:return e.abrupt("return",l.value[0].AllExtensions);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F=function(){function e(t,r){(0,s.Z)(this,e),this.tokenProvider=t,this.logger=r}return(0,u.Z)(e,[{key:"foundInPlacesServicePromise",get:function(){return Promise.resolve(this)}},{key:"getFoundInPlaces",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.documentUrl,e.abrupt("return",this.getFoundInPlacesInfo({documentUrl:r},this.tokenProvider,this.logger));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFoundInPlacesInfo",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,r,n){var s,u,i,o,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.documentUrl,u={value:[]},void 0!==s){e.next=5;break}return n&&(0,w.D)(n,{eventName:"WsetApiUrlUndefinedError"}),e.abrupt("return",u);case 5:return e.next=7,(0,l.HJ)(s);case 7:if(!(i=e.sent)||!(0,l.tS)(i)){e.next=14;break}return e.next=11,I(i,r,n);case 11:o=e.sent,e.next=17;break;case 14:return e.next=16,E(s,r,n);case 16:o=e.sent;case 17:return c=this.parseWsetApiResponse(o),e.abrupt("return",c.value.length>0?c:u);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"parseWsetApiResponse",value:function(e){var t=[],r=new Set;try{var n;null===(n=e.SharingHistory)||void 0===n||n.Instances.forEach((function(e){var n="".concat(e.ReferenceType,",").concat(e.Subject);if(""===e.Subject||!r.has(n)){var a={SharingHistory:{Instances:[e]}};t.push({AllExtensions:a}),r.add(n)}}))}catch(a){this.logger&&(0,w.D)(this.logger,{eventName:"WsetReponseProcessingError"},a)}return{value:t}}}]),e}()}}]);
//# sourceMappingURL=WSETFoundInPlaces.512be9eb.chunk.js.map