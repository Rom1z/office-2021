"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[1546],{25021:function(e,t,r){r.r(t),r.d(t,{CacheKeys:function(){return ne},SharepointInformationProtectionService:function(){return ae}});var n=r(29439),a=r(74165),s=r(15861),i=r(15671),o=r(43144),u=r(60136),c=r(29388),l=r(11752),p=r(61120),d=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,o.Z)(r,[{key:"set",value:function(e,t){return(0,l.Z)((0,p.Z)(r.prototype),"set",this).call(this,e,t.then()),this}},{key:"get",value:function(e){var t;return null===(t=(0,l.Z)((0,p.Z)(r.prototype),"get",this).call(this,e))||void 0===t?void 0:t.then()}}]),r}((0,r(28664).Z)(Map)),h=r(24466),f=r(64058),v=r(47465);function g(e,t){var r=e.filter((function(e){return e.id===t}));return 1===r.length?r[0]:void 0}var b=r(1413),m=r(26982),y=r(42552),k=r(39680),x=r(12338),Z=r(17736),w={allowedAttributes:["term","scheme","rel","href","type","m:null","m:type"],allowedNamespaces:["http://www.w3.org/2005/Atom","http://schemas.microsoft.com/ado/2007/08/dataservices/metadata","http://schemas.microsoft.com/ado/2007/08/dataservices","http://www.georss.org/georss","http://www.opengis.net/gml"],allowedTags:["entry","id","category","link","title","updated","author","name","content","m:properties","d:AppliedActionsText","d:ComplianceUrl","d:GeneralText","d:OverrideOptions","d:LastProcessedTime","d:MatchedConditionDescriptions","d:element","d:TwoLetterISOLanguageName","d:GetDlpPolicyTip"]};function L(e,t){var r=e.getElementsByTagName(t);return 1===r.length&&r[0].textContent?r[0].textContent:""}function P(e,t){var r=e.getElementsByTagName(t),n=[];if(1===r.length)for(var a=0;a<r[0].children.length;a+=1){var s=r[0].children[a].textContent;n.push(s||"")}return n}function C(e,t){return I.apply(this,arguments)}function I(){return(I=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,i,o,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=7;break}return e.next=3,r;case 3:s=e.sent.createXML,n=s(t,w),e.next=8;break;case 7:n=t;case 8:if(i=new DOMParser,o=i.parseFromString(n,"text/xml"),!(u=o.querySelector("parsererror"))){e.next=13;break}throw new Error("parseDlpPolicyTip failed to parse : ".concat(u.textContent));case 13:if(!(c=o.querySelector("content"))){e.next=16;break}return e.abrupt("return",{generalText:L(c,"d:GeneralText"),appliedActionsText:L(c,"d:AppliedActionsText"),complianceUrl:L(c,"d:ComplianceUrl"),overrideOptions:parseInt(L(c,"d:OverrideOptions"),10),lastProcessedTime:L(c,"d:LastProcessedTime"),matchedConditionDescriptions:P(c,"d:MatchedConditionDescriptions")});case 16:return e.abrupt("return",void 0);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T={Watermark:"#microsoft.graph.security.addWatermarkAction",Metadata:"#microsoft.graph.security.metadataAction"},S=2e4;function R(e){var t,r=null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.filter((function(e){if(e["@odata.type"]===T.Watermark)return e}));return 1===r.length?r[0]:void 0}function E(e){var t,r=null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.filter((function(e){if(e["@odata.type"]===T.Metadata)return e}));return 1===r.length?r[0]:void 0}var M="https://graph.microsoft.com/beta/",A=["InformationProtectionPolicy.Read"];function D(e,t){return U.apply(this,arguments)}function U(){return(U=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=M+"me/security/informationProtection/sensitivityLabels?$filter=contentFormats/any(s:s eq 'file')",s=function(e){return t.getToken(A,e)},e.next=4,(0,m.Xo)(s,n,"GetPolicyLabels",r,void 0,void 0,m.O6,S);case 4:if((i=e.sent).ok&&200===i.status){e.next=7;break}throw new Error("getPolicyLabel failed with status : ".concat(i.status));case 7:return e.next=9,i.json();case 9:return o=e.sent,e.abrupt("return",o.value);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return{metadata:[{name:"MSIP_Label_".concat(e,"_Enabled"),value:"true"}]}}function N(e,t,r,n,a){return O.apply(this,arguments)}function O(){return(O=(0,s.Z)((0,a.Z)().mark((function e(t,r,n,s,i){var o,u,c,l,p,d,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=M+"me/security/informationProtection/sensitivityLabels/evaluateApplication",u={contentInfo:s||G(r),labelingOptions:{labelId:r,downgradeJustification:{isDowngradeJustified:!!n,justificationMessage:n||""}}},c=function(e){return t.getToken(A,e)},e.next=5,(0,m.Xo)(c,o,"EvaluateApplication",i,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)},m.O6,S);case 5:if((l=e.sent).ok&&200===l.status){e.next=8;break}throw new Error("evaluateLabelApplication failed with status : ".concat(l.status));case 8:return e.next=10,l.json();case 10:if(p=e.sent,d=R(p),null===(h=E(p))||void 0===h||!h.metadataToAdd){e.next=15;break}return e.abrupt("return",{changeLabel:!0,contentInfo:{metadata:h.metadataToAdd},watermark:d});case 15:return e.abrupt("return",{changeLabel:!1});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,t,r,n,a){return W.apply(this,arguments)}function W(){return(W=(0,s.Z)((0,a.Z)().mark((function e(t,r,n,s,i){var o,u,c,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=M+"me/security/informationProtection/sensitivityLabels/evaluateRemoval",u={contentInfo:n||G(r),downgradeJustification:{isDowngradeJustified:!!s,justificationMessage:s||""}},c=function(e){return t.getToken(A,e)},e.next=5,(0,m.Xo)(c,o,"EvaluateRemoval",i,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)},m.O6,S);case 5:if((l=e.sent).ok&&200===l.status){e.next=8;break}throw new Error("evaluateLabelRemoval failed with status : ".concat(l.status));case 8:return e.next=10,l.json();case 10:if(p=e.sent,null===(d=E(p))||void 0===d||!d.metadataToRemove){e.next=14;break}return e.abrupt("return",{changeLabel:!0});case 14:return e.abrupt("return",{changeLabel:!1});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,r,n,a){return $.apply(this,arguments)}function $(){return $=(0,s.Z)((0,a.Z)().mark((function e(t,r,n,i,o){var u,c,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=(0,y.P)(i),c={getToken:function(e){var a=(0,b.Z)((0,b.Z)({},e),{},{siteUrl:i,driveId:n,itemId:r});return t.getToken(["".concat(u,"/files.readwrite.all")],a)},url:"".concat(i,"/_api/v2.1/drives/").concat(n,"/items/").concat(r,"/opStream/capabilities?$select=canWrite,canPrint,canExtract,supportsCLP"),retryPolicy:k.Uj,timeoutMs:S},!o){e.next=8;break}return e.next=5,(0,x.Y)((0,b.Z)((0,b.Z)({},c),{},{logger:o,nameForLogging:"GetItemIrmCapabilities",getAdditionalProps:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,Z.I)(t));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}));case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,x.h)(c);case 10:e.t0=e.sent;case 11:if((l=e.t0).result.ok&&200===l.result.status){e.next=14;break}throw new Error("getItemIrmCapabilities failed with status : ".concat(l.result.status));case 14:return e.next=16,l.result.json();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function K(e,t,r,n,a,s){return J.apply(this,arguments)}function J(){return(J=(0,s.Z)((0,a.Z)().mark((function e(t,r,n,s,i,o){var u,c,l,p,d,h;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new URL(s).hostname,c="".concat(M,"sites/").concat(u,"/drives/").concat(n,"/items/").concat(r,"/extractSensitivityLabels"),l=function(e){return t.getToken(["files.readwrite.all"],e)},e.next=5,(0,m.Xo)(l,c,"extractSensitivityLabels",o,i,{method:"POST"},m.O6,S);case 5:if((p=e.sent).ok&&200===p.status){e.next=8;break}throw new Error("extractInformationProtectionContentLabels failed with status : ".concat(p.status));case 8:return e.next=10,p.json();case 10:return d=e.sent,h=d.labels.find((function(e){return e.tenantId===i})),e.abrupt("return",h);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,r,n,a,s){return X.apply(this,arguments)}function X(){return X=(0,s.Z)((0,a.Z)().mark((function e(t,r,n,i,o,u){var c,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=(0,y.P)(i),l={getToken:function(e){var a=(0,b.Z)((0,b.Z)({},e),{},{siteUrl:i,driveId:n,itemId:r});return t.getToken(["".concat(c,"/files.readwrite.all")],a)},url:"".concat(c,"/_api/v2.0/drives/").concat(n,"/items/").concat(r,"/setSensitivityLabel"),requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)},retryPolicy:k.Uj,timeoutMs:S},!u){e.next=8;break}return e.next=5,(0,x.Y)((0,b.Z)((0,b.Z)({},l),{},{logger:u,nameForLogging:"SetLabel",getAdditionalProps:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,Z.I)(t));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}));case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,(0,x.h)(l);case 10:e.t0=e.sent;case 11:return p=e.t0,e.abrupt("return",200===p.result.status);case 13:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function F(e,t,r,n,a,s){return V.apply(this,arguments)}function V(){return V=(0,s.Z)((0,a.Z)().mark((function e(t,r,n,i,o,u){var c,l,p,d,f,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(0,y.P)(i),e.next=3,(0,h.eC)(t,i,n,r,u);case 3:if(l=e.sent,p=null===l||void 0===l?void 0:l.webDavUrl.replace(c,""),d={getToken:function(e){var a=(0,b.Z)((0,b.Z)({},e),{},{siteUrl:i,driveId:n,itemId:r});return t.getToken(["".concat(c,"/files.readwrite.all")],a)},url:"".concat(i,"/_api/web/getListItem('").concat(p,"')/getdlppolicytip"),retryPolicy:k.Uj,timeoutMs:S},!u){e.next=12;break}return e.next=9,(0,x.Y)((0,b.Z)((0,b.Z)({},d),{},{logger:u,nameForLogging:"GetDlpPolicyTip",getAdditionalProps:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,Z.I)(t));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}));case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,(0,x.h)(d);case 14:e.t0=e.sent;case 15:if((f=e.t0).result.ok&&200===f.result.status){e.next=18;break}throw new Error("getDlpTooltip failed with status : ".concat(f.result.status));case 18:return e.next=20,f.result.text();case 20:return v=e.sent,e.next=23,C(v,o);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}function Y(e,t){return z.apply(this,arguments)}function z(){return(z=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=M+"me/security/informationProtection/labelPolicySettings",s=function(e){return t.getToken(A,e)},e.next=4,(0,m.Xo)(s,n,"GetPolicySettings",r,void 0,void 0,m.O6,S);case 4:if((i=e.sent).ok&&200===i.status){e.next=7;break}throw new Error("getPolicySettings failed with status : ".concat(i.status));case 7:return e.next=9,i.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var B=r(14906),H=r(80395),Q=r(99427),ee=r(11447),te=r(98846),re=r(30288),ne={AppliedLabel:"AppliedLabel",IrmCapabilities:"IrmCapabilities",IsProtectionEnabled:"IsProtectionEnabled",PolicySettings:"PolicySettings",Watermark:"Watermark",DlpPolicyTip:"DlpPolicyTip",Labels:"Labels",IsMandatoryLabelingRequired:"IsMandatoryLabelingRequired"},ae=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this)).props=e,n.PromiseCache=new d,n}return(0,o.Z)(r,[{key:"InformationProtectionService",get:function(){return this}},{key:"getCacheKey",value:function(e,t){return e+"_"+t}},{key:"getCurrentLabel",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n,i,o,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=3;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.GetAppliedLabel}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(ne.AppliedLabel,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:if(i=re.a.start("GetAppliedLabel",this.props.logger),o=(0,f.TZ)(t.siteUrl,this.props.logger)){e.next=12;break}return i.setResult(!1,{errorType:B.k.InvalidTenantId}),e.abrupt("return");case 12:return n=(0,s.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,K(u.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,o,u.props.logger);case 3:return n=e.sent,u.monitorAppliedLabel(t),u.processPolicySettings(t,n),i.setResult(!0,{appliedLabel:!!n,assignmentMethod:null===n||void 0===n?void 0:n.assignmentMethod}),e.abrupt("return",n);case 10:return e.prev=10,e.t0=e.catch(0),u.PromiseCache.delete(r),i.setResult(!1,{errorType:B.k.GetAppliedLabelError},e.t0),e.abrupt("return",void 0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))(),this.PromiseCache.set(r,n),e.abrupt("return",n.then());case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getHasProtection",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,i,o,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=3;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.GetIsProtectionEnabled}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(ne.IsProtectionEnabled,t.hashedDocumentId),!(i=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",i);case 7:return o=re.a.start("IsProtectionEnabled",this.props.logger),i=(0,s.Z)((0,a.Z)().mark((function e(){var s,i,c,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([u.getCurrentLabel(t),u.getLabels()]);case 2:if(s=e.sent,i=(0,n.Z)(s,2),c=i[0],l=i[1],!c||l){e.next=10;break}return o.setResult(!1,{hasProtection:!1,appliedLabel:!!c,allLabels:!!l}),u.PromiseCache.delete(r),e.abrupt("return",void 0);case 10:return p=!1,c&&l&&(d=g(l,c.sensitivityLabelId),p=!(null===d||void 0===d||!d.hasProtection)),o.setResult(!0,{appliedLabel:!!c,allLabels:!!l,hasProtection:p}),e.abrupt("return",p);case 14:case"end":return e.stop()}}),e)})))(),this.PromiseCache.set(r,i),e.abrupt("return",i.then());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIrmInformation",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=3;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.GetIrmCapabilities}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(ne.IrmCapabilities,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:return i=re.a.start("GetIrmCapabilities",this.props.logger),n=(0,s.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,q(o.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,o.props.logger);case 3:return n=e.sent,i.setResult(!0,{supportsCLP:n.supportsCLP,canWrite:n.canWrite,canExtract:n.canExtract,canPrint:n.canPrint}),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),o.PromiseCache.delete(r),i.setResult(!1,{errorType:B.k.GetIrmCapabilitiesError},e.t0),e.abrupt("return",void 0);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))(),this.PromiseCache.set(r,n),e.abrupt("return",n.then());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPolicySettings",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.PromiseCache.get(ne.PolicySettings.toString()))){e.next=3;break}return e.abrupt("return",t);case 3:return r=re.a.start("GetPolicySettings",this.props.logger),t=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y(n.props.tokenProvider,n.props.logger);case 3:return t=e.sent,r.setResult(!0,{infoUrl:!!t.moreInfoUrl,isMandatory:t.isMandatory,isDefault:!!t.defaultLabelId,isDowngradeJustificationRequired:t.isDowngradeJustificationRequired}),e.abrupt("return",t);case 8:return e.prev=8,e.t0=e.catch(0),n.PromiseCache.delete(ne.PolicySettings.toString()),r.setResult(!1,{errorType:B.k.GetPolicySettingsError},e.t0),e.abrupt("return",void 0);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))(),this.PromiseCache.set(ne.PolicySettings.toString(),t),e.abrupt("return",t.then());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWatermarkInformation",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=3;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.GetWatermarking}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(ne.Watermark,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:return i=re.a.start("GetWatermarking",this.props.logger),n=(0,s.Z)((0,a.Z)().mark((function e(){var n,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.getCurrentLabel(t);case 3:if(!(n=e.sent)){e.next=11;break}return e.next=7,N(o.props.tokenProvider,n.sensitivityLabelId);case 7:return s=e.sent,o.labelMetadataCache=s.contentInfo,i.setResult(!0,{appliedLabel:!0,isWatermark:!!s.watermark,isContentInfo:!!s.contentInfo}),e.abrupt("return",s.watermark);case 11:return i.setResult(!0,{appliedLabel:!!n}),e.abrupt("return",void 0);case 15:return e.prev=15,e.t0=e.catch(0),o.PromiseCache.delete(r),i.setResult(!1,{errorType:B.k.GetWatermarkingError},e.t0),e.abrupt("return",void 0);case 20:case"end":return e.stop()}}),e,null,[[0,15]])})))(),this.PromiseCache.set(r,n),e.abrupt("return",n.then());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"overrideDlpPolicyTip",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Not Implemented..");case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLabels",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t,r,n=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.PromiseCache.get(ne.Labels.toString()))){e.next=3;break}return e.abrupt("return",t);case 3:return r=re.a.start("GetLabels",this.props.logger),t=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D(n.props.tokenProvider,n.props.logger);case 3:return t=e.sent,r.setResult(!0),e.abrupt("return",t);case 8:return e.prev=8,e.t0=e.catch(0),n.PromiseCache.delete(ne.Labels.toString()),r.setResult(!1,{errorType:B.k.GetLabelsError},e.t0),e.abrupt("return",void 0);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))(),this.PromiseCache.set(ne.Labels.toString(),t),e.abrupt("return",t.then());case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeLabel",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,_(this.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,r,this.props.logger);case 4:return(n=e.sent)&&this.refreshAppliedLabel(t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"setCurrentLabel",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ee.yZ)(this.props.settingsProvider)){e.next=4;break}return re.a.start("SetLabel",this.props.logger).setResult(!1,{settingName:ee.AA,settingValue:(0,ee.yZ)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return",!1);case 4:if((0,h.tS)(t)){e.next=7;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.SetLabel}),e.abrupt("return",!1);case 7:if(null!==r.id){e.next=10;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidLabelId,scenario:Q.$.SetLabel}),e.abrupt("return",!1);case 10:return n=re.a.start("SetLabel",this.props.logger),s=!0,e.prev=12,e.next=15,N(this.props.tokenProvider,r.id,r.justificationText,this.labelMetadataCache,this.props.logger);case 15:if(!(i=e.sent).changeLabel){e.next=20;break}return e.next=19,this.changeLabel(t,r);case 19:s=e.sent;case 20:n.setResult(!0,{changeLabel:i.changeLabel,changeLabelStatus:s,assignmentMethod:r.assignmentMethod,actionSource:r.actionSource}),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(12),n.setResult(!1,{errorType:B.k.SetLabelError},e.t0),s=!1;case 27:return s||this.emit("sensitivityError"),e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,this,[[12,23]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"removeCurrentLabel",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ee.yZ)(this.props.settingsProvider)){e.next=4;break}return re.a.start("RemoveLabel",this.props.logger).setResult(!1,{settingName:ee.AA,settingValue:(0,ee.yZ)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return",!1);case 4:if((0,h.tS)(t)){e.next=7;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.RemoveLabel}),e.abrupt("return",!1);case 7:if(null!==r.id){e.next=10;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidLabelId,scenario:Q.$.SetLabel}),e.abrupt("return",!1);case 10:return n=re.a.start("RemoveLabel",this.props.logger),s=!0,e.prev=12,e.next=15,j(this.props.tokenProvider,r.id,this.labelMetadataCache,r.justificationText,this.props.logger);case 15:if(!(i=e.sent).changeLabel){e.next=22;break}return r.id=null,e.next=20,this.changeLabel(t,r);case 20:(s=e.sent)&&(this.labelMetadataCache=void 0);case 22:n.setResult(!0,{changeLabel:i.changeLabel,removeCurrentLabelStatus:s,assignmentMethod:r.assignmentMethod,actionSource:r.actionSource}),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),n.setResult(!1,{errorType:B.k.RemoveLabelError},e.t0),s=!1;case 29:return s||this.emit("sensitivityError"),e.abrupt("return",s);case 31:case"end":return e.stop()}}),e,this,[[12,25]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getDlpTooltip",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=3;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.GetDlpPolicyTip}),e.abrupt("return",void 0);case 3:if(r=this.getCacheKey(ne.DlpPolicyTip,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=7;break}return e.abrupt("return",n);case 7:return i=re.a.start("GetDlpPolicyTip",this.props.logger),n=(0,s.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F(o.props.tokenProvider,t.itemId,t.driveId,t.siteUrl,o.props.trustedTypesPolicy,o.props.logger);case 3:return(n=e.sent)&&o.emit("dlpPolicyTip",n),i.setResult(!0,{tip:!!n,moreInfoUrl:!(null===n||void 0===n||!n.complianceUrl),overrideOptions:null===n||void 0===n?void 0:n.overrideOptions}),e.abrupt("return",n);case 9:return e.prev=9,e.t0=e.catch(0),o.PromiseCache.delete(r),i.setResult(!1,{errorType:B.k.GetDlpPolicyTipError},e.t0),e.abrupt("return",void 0);case 14:case"end":return e.stop()}}),e,null,[[0,9]])})))(),this.PromiseCache.set(r,n),e.abrupt("return",n.then());case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getIsMandatoryLabeling",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,n,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ee.yZ)(this.props.settingsProvider)){e.next=4;break}return re.a.start("IsMandatoryLabelingRequired",this.props.logger).setResult(!1,{settingName:ee.AA,settingValue:(0,ee.yZ)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return",!1);case 4:if((0,h.tS)(t)){e.next=7;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.GetIsProtectionEnabled}),e.abrupt("return",void 0);case 7:if(r=this.getCacheKey(ne.IsMandatoryLabelingRequired,t.hashedDocumentId),!(n=this.PromiseCache.get(r))){e.next=11;break}return e.abrupt("return",n);case 11:return i=re.a.start("IsMandatoryLabelingRequired",this.props.logger),n=(0,s.Z)((0,a.Z)().mark((function e(){var t,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.getPolicySettings();case 2:if(t=e.sent){e.next=7;break}return i.setResult(!1,{policySettings:!!t}),o.PromiseCache.delete(r),e.abrupt("return",void 0);case 7:return n=t.isMandatory,i.setResult(!0,{isMandatoryLabelingRequired:n}),e.abrupt("return",n);case 10:case"end":return e.stop()}}),e)})))(),this.PromiseCache.set(r,n),e.abrupt("return",n.then());case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enforceMandatoryLabelExperience",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,s,i,o,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=3;break}return this.props.logger&&(0,te.ve)(this.props.logger,{eventName:B.k.InvalidResolvedUrl,scenario:Q.$.EnforceMandatoryLabelExperience}),e.abrupt("return",void 0);case 3:return r=re.a.start("EnforceMandatoryLabelExperience",this.props.logger),e.next=6,Promise.all([this.getPolicySettings(),this.getCurrentLabel(t)]);case 6:return s=e.sent,i=(0,n.Z)(s,2),o=i[0],u=i[1],null!==o&&void 0!==o&&o.isMandatory&&!u&&(o.defaultLabelId?this.delayExecuteMandatoryLabeling(t,1e4):this.executeMandatoryLabeling()),r.setResult(!0),e.abrupt("return");case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"delayExecuteMandatoryLabeling",value:function(e,t){var r=this;this.mandatoryLabelTimeout||(this.mandatoryLabelTimeout=window.setTimeout((0,s.Z)((0,a.Z)().mark((function t(){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getCurrentLabel(e);case 2:t.sent||r.executeMandatoryLabeling();case 4:case"end":return t.stop()}}),t)}))),t))}},{key:"initialize",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=re.a.start("Initialization",this.props.logger),e.next=3,Promise.all([this.getLabels(),this.getPolicySettings()]);case 3:t.setResult(!0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"monitorAppliedLabel",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window.clearInterval(this.refreshTimer),9e5,this.refreshTimer=window.setInterval((0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.props.logger&&(0,te.ve)(r.props.logger,{eventName:H.L.RefreshTimerTriggered}),e.next=3,r.refreshAppliedLabel(t);case 3:case"end":return e.stop()}}),e)}))),9e5);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAppliedLabel",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t){var r,s,i,o,u,c,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.tS)(t)){e.next=2;break}return e.abrupt("return");case 2:return r=re.a.start("RefreshAppliedLabel",this.props.logger),e.next=5,this.getCurrentLabel(t);case 5:return s=e.sent,this.PromiseCache.delete(this.getCacheKey(ne.AppliedLabel,t.hashedDocumentId)),e.next=9,this.getCurrentLabel(t);case 9:if(i=e.sent,!(o=(null===s||void 0===s?void 0:s.sensitivityLabelId)!==(null===i||void 0===i?void 0:i.sensitivityLabelId))){e.next=28;break}return this.emit("sensitivityLabelChanged",i),this.PromiseCache.delete(this.getCacheKey(ne.IrmCapabilities,t.hashedDocumentId)),this.PromiseCache.delete(this.getCacheKey(ne.Watermark,t.hashedDocumentId)),e.next=17,Promise.all([this.getIrmInformation(t),this.getWatermarkInformation(t)]);case 17:return u=e.sent,c=(0,n.Z)(u,2),l=c[0],p=c[1],this.emit("IrmCapabilitiesChanged",l),this.emit("watermarkingChanged",p),this.PromiseCache.delete(this.getCacheKey(ne.IsProtectionEnabled,t.hashedDocumentId)),e.next=26,this.getHasProtection(t);case 26:d=e.sent,this.emit("protectionChanged",d);case 28:r.setResult(!0,{isRefreshed:o});case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"processPolicySettings",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=re.a.start("ProcessPolicySettings",this.props.logger),(0,ee.yZ)(this.props.settingsProvider)){e.next=4;break}return n.setResult(!1,{settingName:ee.AA,settingValue:(0,ee.yZ)(this.props.settingsProvider),settingsProviderExists:void 0!==this.props.settingsProvider}),e.abrupt("return");case 4:return e.next=6,this.getPolicySettings();case 6:if(s=e.sent){e.next=10;break}return n.setResult(!1,{errorType:B.k.GetPolicySettingsError,scenario:Q.$.ProcessPolicySettings}),e.abrupt("return");case 10:if(i=!1,!s.defaultLabelId||null!==r&&void 0!==r&&r.sensitivityLabelId){e.next=16;break}return e.next=14,this.executeDefaultLabeling(t,s.defaultLabelId);case 14:i=e.sent,n.addAdditionalProps({defaultLabelingStatus:i});case 16:o=!1,!s.isMandatory||null!==r&&void 0!==r&&r.sensitivityLabelId||s.defaultLabelId&&i||(o=!0,this.executeMandatoryLabeling()),n.setResult(!0,{isDefault:!!s.defaultLabelId,defaultLabelingStatus:i,isMandatory:s.isMandatory,executeMandatoryLabel:o});case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeDefaultLabeling",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,r){var n,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,ee.yZ)(this.props.settingsProvider)){e.next=2;break}return e.abrupt("return",!1);case 2:return n={id:r,assignmentMethod:"standard",actionSource:"defaultLabel"},e.next=5,this.setCurrentLabel(t,n);case 5:return s=e.sent,e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeMandatoryLabeling",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(0,ee.yZ)(this.props.settingsProvider)&&this.emit("mandatoryLabelRequired"),this.mandatoryLabelTimeout&&window.clearTimeout(this.mandatoryLabelTimeout);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){window.clearInterval(this.refreshTimer),window.clearTimeout(this.mandatoryLabelTimeout),this.removeAllListeners(),this.PromiseCache.clear(),this.labelMetadataCache=void 0,this.props.logger&&(0,te.ve)(this.props.logger,{eventName:H.L.InformationProtectionServiceDisposed,protectionChangedListenerCount:this.listenerCount("protectionChanged"),watermarkChangedListenerCount:this.listenerCount("watermarkingChanged"),mandatoryLabelRequiredListenerCount:this.listenerCount("mandatoryLabelRequired"),irmCapabilitiesChangedListenerCount:this.listenerCount("IrmCapabilitiesChanged"),sensitivityLabelChangedListenerCount:this.listenerCount("sensitivityLabelChanged"),dlpPolicyTipListenerCount:this.listenerCount("dlpPolicyTip"),sensitivityErrorListenerCount:this.listenerCount("sensitivityError")})}}]),r}(v.EventEmitter)}}]);
//# sourceMappingURL=SharepointInformationProtectionService.f646713e.chunk.js.map